{"version":3,"sources":["dashboard/config.tsx","features/data/dataSlice.ts","features/year/yearSlice.ts","features/plotType/plotTypeSlice.ts","features/controls/controlsSlice.ts","app/store.ts","hooks/useTouchOutside.ts","dashboard/CustomTooltipWithBounds.tsx","dashboard/utils/misc.ts","app/hooks.ts","dashboard/utils/colors.ts","dashboard/icons/Compare.svg","dashboard/utils/domain.ts","dashboard/selectors.ts","hooks/useSelect.tsx","dashboard/BubblePlot.tsx","dashboard/MapPlot.tsx","dashboard/LinePlot.tsx","dashboard/BarPlot.tsx","dashboard/utils/url.ts","dashboard/sharing.tsx","features/year/YearSlider.tsx","dashboard/icons.tsx","features/plotType/PlotTypeSelect.tsx","features/controls/Controls.tsx","features/data/DataManager.tsx","dashboard/Url.tsx","dashboard/Legend.tsx","dashboard/Nav.tsx","dashboard/icons/logo.svg","dashboard/Dashboard.tsx"],"names":["AxisLabelSource","LegendCorner","PLOT_TYPES","name","xAxisLabelSource","VAR","fields","x","y","z","YEAR","COMPARE","hideAxisLabels","PLOT_TYPES_MAP","zipObj","map","p","SHARE_SIZES","width","height","SHARE_SIZE_MAP","formatNum","minDigits","maxDigits","num","options","maximumFractionDigits","minimumFractionDigits","Number","toLocaleString","undefined","justAddCommas","curry","removeDecimals","oneDecimalPlace","dollarsAndCents","FIELD_TYPE_FORMAT_VALUES_MAP","_","Error","value","NUMERIC_FIELDS","indexBy","prop","FIELD_CFGS","type","group","COMPARE_BY_FIELD_CFGS","PLOT_PRESETS","title","params","area","level","compare","plot","augmentField","cfg","f","id","processData","data","newData","areas","byId","a","link","allIds","Object","keys","levels","compareByFields","initialState","masterData","values","topologies","byAreaAndLevel","status","dataSlice","createSlice","reducers","setData","state","action","payload","clearDataValues","actions","selectAreas","selectFields","selectCompareByFields","selectLevels","selectYears","years","selectValues","selectAllCompareByFieldDetails","createSelector","selectNumericFields","filter","includes","yearSlice","setYear","extraReducers","last","selectYear","year","plotTypeSlice","setPlotType","selectPlotType","plotType","defaultFields","loaded","controlsSlice","setControls","newValue","equals","setLoaded","selectControlsLoaded","controls","store","configureStore","reducer","dataReducer","yearReducer","plotTypeReducer","controlsReducer","useTouchOutside","elementRef","onClick","useEffect","clickListener","event","current","contains","target","document","addEventListener","removeEventListener","withBoundingRects","initialLeft","left","initialTop","top","offsetLeft","offsetTop","rect","parentRect","children","getRects","style","otherProps","transform","useAppDispatch","useDispatch","useAppSelector","useSelector","bind","xs","flatMap","as","concat","reduceRight","allValuesNotNull","obj","every","firstAndLast","length","nestedFirstAndLast","capitalize","s","toUpperCase","slice","average","array","reduce","b","sum","DEFAULT_COLOR","h","v","HUE_PRESETS","SAT_RANGE","autoScaleColorNominal","c","nFieldValues","index","isPrioritized","n","i","autoHueScale","sStart","sStep","vStep","COMPARE_BY_COLOR_FNS","shortName","autoSatScale","COMPARE_BY_COLOR_PRIORITIES","componentToHex","hex","toString","hsvToHex","r","g","h1","Math","floor","q","t","round","hsvToRgb","rgbToHex","createKey","cbfs","k1","sk","k2","fieldToIndexMap","cbf","field","sortKeys","_getColorFromPalette","ks","getColorFromPalette","hashMap","k","createKeySet","getShortLabels","getFullLabels","fullName","iterateOverCompareGrid","fn","cbf1","cbf2","v1","v2","_defs","_rect","_rect2","_path","setupColorPalette","kahcs","forEach","kahc","color","addColorToPalette","keySets","getColor","getColorGrid","labels","rows","cols","fullNames","colors","byRowAndCol","compose","scbfs","switchToAlwaysMakeLegendHorizontal","processItemValues","vs","controlFields","divisions","colorPalette","createName","cs","div","geoid","divName","abbrev","areaName","mediumName","join","_findClearestCorner","right","y_mean","forceCorner","topLeft","max","topRight","bottomLeft","min","bottomRight","minimum","NW","corner","closestDataPoint","NE","SW","SE","chooseLegendPosition","featureRanges","_splitHalfs","pred","c1","c2","c14","c34","d","sortedData","sort","scaledY","selectControlFieldValues","cv","nfs","selectControlFields","mapObjIndexed","selectColorPalette","priorities","lowPriority","highPriority","accum","cbfi","isAccumDefault","newColors","existing","fieldValues","cbfv","vi","createColorPalette","selectCurrentDivisions","byLevel","dvsByLevel","selectTopologies","tbaal","cvs","selectArea","selectCurrentCompareDetails","cb","summaryDataForAllYears","ds","cf","cp","avs","individualDataForAllYears","selectPlotData","individualData","summaryData","individualDataIgnoringCompares","selectFeatureRanges","individualDataIgnoringComparesForAllYears","fvs","selectLegendPosition","selectPlotPresets","url","queryString","stringify","arrayFormat","isLoaded","DEFAULT_OPTIONS","selectedOpacity","unselectedOpacity","defaultOpacity","groupByKeys","keyFields","items","im","groupBy","item","tail","lookupItem","itemMap","results","lookupKeys","matchesAllKeys","keysToMatch","itemKeys","all","range","TooltipContent","FormattedValue","formatValue","className","useSelect","showLabel","disableInteraction","nKeyFields","React","useState","selectedKeys","selectKeys","useTooltip","tooltipOpen","tooltipLeft","tooltipTop","tooltipData","showTooltip","hideTooltip","select","useCallback","scaledX","deselect","getKeys","key1","Tooltip","memo","ref","useRef","defaultTooltipStyles","fontSize","padding","margin","makeSelectable","keyValues","useSpring","animOpacity","setAnim","isSelected","opacity","animate","fillOpacity","to","strokeOpacity","cloneElement","props","key","makeInteractive","callback","resolvedKeyValues","Function","onTouchStart","onMouseMove","onMouseLeave","makeSelectableAndInteractive","concreteKeys","BubblePlot","xScale","scaleLinear","domain","yScale","sizeScale","scalePower","exponent","size","animFn","animX","animY","animSize","useSprings","springs","start","circle","cx","cy","fill","stroke","projection","geoAlbersUsa","usMapOffset","opacityOptions","DumbMapPlot","scale","topoFeature","topojson","objects","featColl","features","colorScale","hcl","interpolate","interpolateHcl","path","geoPath","translate","bounds","tempItems","geoCentroid","animColor","AlbersUsa","feature","strokeWidth","MapPlot","lineOptions","pointOptions","LinePlot","hPadding","useMemo","vPadding","lines","lineKeys","circleSize","voronoiInstance","voronoi","findNearest","line","point","localPoint","find","LinePath","GlyphCircle","BarPlot","heightAdjustment","startAtZero","pctOfLowest","getHeightAdjustment","scaleBand","animHeight","bandwidth","setSearchPart","parts","window","location","hash","split","replace","BaseDialog","isOpen","setOpen","fullScreen","search","useLocation","Dialog","open","onClose","history","back","keepMounted","createPlotTitle","compares","xAxisLabel","yAxisLabel","toLowerCase","DumbImageDialog","pageInDarkMode","label","setLabel","showAxisLabels","plotTitle","defaultShareSize","sharePresetSize","setSharePresetSize","previewSize","setPreviewSize","shareSize","setShareSize","format","setFormat","imgData","setImgData","theme","useTheme","useMediaQuery","breakpoints","down","darkModeState","setDarkModeState","darkModeRef","ImagePreview","darkMode","useDarkMode","classNameDark","classNameLight","storageKey","enable","disable","canvasToPng","canvas","toDataURL","GenerateDialog","setNewSize","newSize","ratio","w","calculatePreviewSize","DialogContent","FormControl","InputLabel","variant","htmlFor","NativeSelect","onChange","getElementsByClassName","scrollTo","FormGroup","row","TextField","helperText","DialogActions","Button","el","getElementById","then","htmlToImage","getGenerateFn","canvasWidth","canvasHeight","pixelRatio","clientWidth","clientHeight","quality","zoom","dataUrl","DownloadDialog","href","download","alt","src","PinterestShareButton","media","PinterestIcon","ImageDialog","BasicShareDialog","FacebookShareButton","quote","FacebookIcon","TwitterShareButton","TwitterIcon","RedditShareButton","RedditIcon","LinkedinShareButton","LinkedinIcon","display","onCopy","text","IconButton","SharePlotDialog","PrettoSlider","styled","Slider","border","backgroundColor","boxShadow","lineHeight","background","borderRadius","transformOrigin","YearSlider","dispatch","Box","sx","flex","defaultValue","step","disabled","valueLabelDisplay","paddingTop","_extends","assign","arguments","source","prototype","hasOwnProperty","call","apply","this","_objectWithoutProperties","excluded","sourceKeys","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","SvgCompare","_ref","svgRef","titleId","xmlns","viewBox","fillRule","strokeLinecap","strokeLinejoin","strokeMiterlimit","ForwardRef","makeIcon","iconSrc","SvgIcon","component","FIELD_TYPE_ICONS_MAP","PlaceIcon","CompareIconSrc","TimelapseIcon","PaidIcon","AccessTimeFilledIcon","CalendarMonthIcon","DoDisturbIcon","TagIcon","PLOT_TYPE_ICONS_MAP","BubbleChartIcon","TimelineIcon","BarChartIcon","RoomIcon","PlotTypeSelect","ToggleButtonGroup","exclusive","pt","Icon","ToggleButton","groupFields","gs","DrawerFieldSelect","body","position","Drawer","anchor","PaperProps","ModalProps","MenuFieldSelect","anchorEl","setAnchorEl","Menu","MenuListProps","role","FieldSelect","BaseFieldSelect","currentTarget","Input","Divider","MenuItem","default","selected","ListItemIcon","ListItemText","primary","secondary","description","Controls","controlsIsReady","numericFields","numericFieldGroups","compareByGroups","used","disableUsedCompares","updateState","newState","updateCompare","newNewState","CompareByFieldSelect","BasicSelect","e","DataManager","compareFields","controlsLoaded","isValueChunk","groupByFn","compareValues","mergeFeatures","featureSet","Set","allKeys","nonFeatureSet","difference","output","featureValue","onChunksFetched","valueData","processValues","otherData","arr","flatObject","property","flattenArrayOfObjects","getState","sortCompares","computeValueChunk","_computeChunks","Promise","axios","get","responses","fcs","require","Url","storedYear","storedPlotType","updateUrl","allParams","newS","parse","nonNullControls","parseInt","configUpdated","bgAlphaHex","OrdinalStrip","fromColor","toColor","backgroundImage","OrdinalLabels","end","OrdinalLegend","NominalLegend","OrdinalByNominalLegend","colorRow","NominalByNominalLegend","cellPadding","cellSpacing","col","colorCell","disableFocusListener","OrdinalByOrdinalLegend","ls","WebkitMask","mask","bottom","Legend","LegendComponent","types","getLegendComponent","SideMenuItem","icon","ListItemButton","Collapse","in","timeout","unmountOnExit","Nav","ShareDialog","plotPresets","shareOpen","setShareOpen","drawerOpen","setDrawerOpen","drawer","List","Hidden","xlUp","xlDown","AppBar","elevation","Toolbar","edge","marginRight","xl","Typography","textDecoration","toggle","setUseWhatChange","process","LoadingPlot","CircularProgress","PlotArea","axisLabels","levelVar","DumbPlotArea","yAxisVar","loading","ParentSize","debounceTime","DumbDashboard","genImgOpen","setGenImgOpen","setShowLabel","computeXAxisLabel","Plot","Card","Dashboard","ExternalLink","rel","SiteScreenshot","file","DumbHome","LogoIcon","textAlign","whiteSpace","Home","About","DashboardApp","prefersDarkMode","createTheme","palette","mode","main","sm","md","lg","ThemeProvider","CssBaseline","boxSizing","flexDirection","paddingLeft","element"],"mappings":"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","file":"static/js/5.a13f6259.chunk.js","sourcesContent":["import {zipObj, indexBy, prop, curry} from \"ramda\";\n\nexport const DATA_DIR = process.env.REACT_APP_ENV === 'production' ?\n    'https://storage.googleapis.com/statistipedia/data' : 'data';\n\nexport enum AxisLabelSource {\n    VAR,\n    COMPARE,\n    YEAR\n}\n\nexport type PlotType = {\n    name: string,\n    xAxisLabelSource?: AxisLabelSource,\n    hideAxisLabels?: boolean,\n    fields: {\n        x?: string,\n        y?: string,\n        z?: string\n    }\n};\n\nexport const PLOT_TYPES: PlotType[] = [{\n    name: 'bubble',\n    xAxisLabelSource: AxisLabelSource.VAR,\n    fields: {\n        x: 'X-Axis',\n        y: 'Y-Axis',\n        z: 'Size'\n    }\n}, {\n    name: 'line',  // aka. time series chart\n    xAxisLabelSource: AxisLabelSource.YEAR,\n    fields: {\n        // X-Axis is always time. Existing selection is kept, only disabled\n        y: 'Y-Axis'\n    }\n}, {\n    name: 'bar',\n    xAxisLabelSource: AxisLabelSource.COMPARE,\n    fields: {\n        // compare: 'Compare by',  // Secondary grouping nested under \"Compare by\"\n        y: 'Y-Axis'\n    }\n}, {\n    name: 'map',\n    hideAxisLabels: true,\n    fields: {\n        y: 'Color'\n    }\n}];\n\nexport const PLOT_TYPES_MAP: Map<string, PlotType> =\n    zipObj(PLOT_TYPES.map(p => p.name), PLOT_TYPES);\n\nexport type FeatureRanges = {\n    x: [number, number],\n    y: [number, number],\n    z: [number, number],\n    year: [number, number]\n};\n\nexport type ShareSize = {\n  name: string,\n  width: number,\n  height: number\n};\n\nexport const SHARE_SIZES: ShareSize[] = [{\n    name: 'Instagram Square',\n    width: 1080,\n    height: 1080\n}, {\n    name: 'Twitter',\n    width: 1024,\n    height: 512\n}, {\n    name: 'Pinterest',\n    width: 800,\n    height: 1200\n}, {\n    name: 'Tumblr',\n    width: 1280,\n    height: 1920\n}];\n\nexport const SHARE_SIZE_MAP: Map<string, ShareSize> =\n    zipObj(SHARE_SIZES.map(p => p.name), SHARE_SIZES);\n\nexport type Area = {\n    id: string\n    abbrev: string\n    name: string\n    geoid: string\n    link: string\n}\n\nexport interface IDashboardProps {\n    area?: string;\n    compare?: string[]\n}\n\nconst FIELD_TYPES = [\n    'geo',\n    'numeric',\n    'percent',\n    'dollars',\n    'minutes',\n    'hours',\n    'nominal',\n    'ordinal'\n];\n\nconst formatNum = (minDigits: number, maxDigits: number, num: number) : string => {\n    const options = {maximumFractionDigits: maxDigits, minimumFractionDigits: minDigits};\n    return Number(num).toLocaleString(undefined, options);\n};\n\nconst justAddCommas = curry(formatNum)(undefined, undefined);\nconst removeDecimals = curry(formatNum)(undefined, 0);\nconst oneDecimalPlace = curry(formatNum)(undefined, 1);\nconst twoDecimalPlaces = curry(formatNum)(undefined, 2);\nconst dollarsAndCents = curry(formatNum)(2, 2);\n\nexport const FIELD_TYPE_FORMAT_VALUES_MAP: {[name: string]: (value: any) => string} = {\n    'geo': _ => { throw new Error('Should not be asked to format value') },\n    'numeric': justAddCommas,\n    'percent': (value) => oneDecimalPlace(value) + '%',\n    'dollars': (value) => '$' + (value >= 1000 ? justAddCommas(value) : dollarsAndCents(value)),\n    'minutes': (value) => removeDecimals(value) + ' minutes',\n    'hours': (value) => removeDecimals(value) + ' hours',\n    'years': (value) => removeDecimals(value) + ' years',\n};\n\nexport type FieldType = {\n    name: string\n    formatValue: (value: any) => string\n}\n\nexport type DataField = {\n    id: string,\n    name: string,\n    description: string,\n    group: string\n    type: string\n};\n\nexport type CompareByFieldValue = {\n    shortName: string\n    mediumName: string\n    fullName: string\n}\n\nexport type CompareByField = DataField & {\n    values: {[cbfvId: string]: CompareByFieldValue}\n}\n\nexport type CompareByFields = {\n    [id: string]: CompareByField\n}\n\nexport const FIELD_TYPES_MAP: {[name: string]: FieldType} =\n    indexBy(prop('name'), FIELD_TYPES);\n\nexport const NUMERIC_FIELDS = ['numeric', 'percent', 'dollars', 'minutes', 'hours', 'years'];\n\n// The processData script uses this config object,\n// so changes may not be reflected until reprocessing\nexport const FIELD_CFGS: {[id: string]: {type: string, group: string}} = {\n    'pct_total_pop': {\n        type: 'percent',\n        group: 'General'\n    },\n    'income': {\n        type: 'dollars',\n        group: 'Employment'\n    },\n    'income_per_hr': {\n        type: 'dollars',\n        group: 'Employment'\n    },\n    'work_hrs_per_wk': {\n        type: 'hours',\n        group: 'Employment'\n    },\n    'commute_time': {\n        type: 'minutes',\n        group: 'Employment'\n    },\n    'avg_age': {\n        type: 'years',\n        group: 'Demographics'\n    },\n    'wh_pct': {\n        type: 'percent',\n        group: 'Demographics'\n    },\n    'bl_pct': {\n        type: 'percent',\n        group: 'Demographics'\n    },\n    'as_pct': {\n        type: 'percent',\n        group: 'Demographics'\n    },\n    'hi_pct': {\n        type: 'percent',\n        group: 'Demographics'\n    }\n};\n\nexport type CompareByFieldCfg = {\n    type: string,\n    group: string\n}\n\nexport const COMPARE_BY_FIELD_CFGS: {[id: string]: CompareByFieldCfg} = {\n    'sex': {\n        type: 'nominal',\n        group: 'Demographic'\n    },\n    'age': {\n        type: 'ordinal',\n        group: 'Demographic'\n    },\n    'race': {\n        type: 'nominal',\n        group: 'Demographic'\n    },\n    'marital': {\n        type: 'nominal',\n        group: 'Demographic'\n    },\n    'education': {\n        type: 'nominal',\n        group: 'Demographic'\n    }\n}\n\nexport type DataValue = any & {\n    geoid: string\n    year: number\n}\n\nexport type DerivedDataValueSet = any & {\n    geoid: string\n    name: string\n    year: number\n    x: number\n    y: number\n    z: number\n}\n\nexport type ApiData = {\n    areas: {[id: string]: Area},\n    levels: {[id: string]: DataField},\n    fields: {[id: string]: DataField},\n    compareByFields: CompareByFields,\n    years: number[],\n    divisions: { byLevel: {[levelId: string]: any[]} }\n    values: DerivedDataValueSet[]\n    topologies: { byAreaAndLevel: {[areaId: string]: {[levelId: string]: any}}}\n}\n\nexport type Data = {\n    areas: { byId: {[id: string]: Area}, allIds: string[]}\n    levels: { byId: {[id: string]: DataField}, allIds: string[]}\n    fields: { byId: {[id: string]: DataField}, allIds: string[]}\n    compareByFields: { byId: CompareByFields, allIds: string[]}\n    years: number[],\n    divisions: { byLevel: {[levelId: string]: any[]} }\n    values: DerivedDataValueSet[]\n    topologies: { byAreaAndLevel: {[areaId: string]: {[levelId: string]: any}}}\n}\n\nexport interface ControlValues {\n    area: string,\n    level: string,\n    compare: string[],\n    x: string,\n    y: string,\n    z: string\n}\n\nexport type UrlParams = {\n    level?: string\n    area?: string\n    compare?: string[]\n    plot?: string\n    x?: string\n    y?: string\n    z?: string\n}\n\nexport const getOgImageUrl = (params: IDashboardProps) : string => {\n    return '';\n};\n\ntype PlotPresetCfg = {\n    title: string\n    params: UrlParams\n}\n\nexport type PlotPreset = {\n    title: string\n    area: Area\n    url: string\n}\n\nexport const PLOT_PRESETS: PlotPresetCfg[] = [{\n    title: 'Hourly income by sex / marital status',\n    params: {\n        area: 'us',\n        level: 'state',\n        compare: ['sex', 'marital'],\n        plot: 'bubble',\n        x: 'work_hrs_per_wk',\n        y: 'income_per_hr'\n    }\n}, {\n    title: 'Hourly income by education',\n    params: {\n        area: 'us',\n        level: 'state',\n        compare: ['education'],\n        plot: 'bar',\n        x: 'work_hrs_per_wk',\n        y: 'income_per_hr'\n    }\n}, {\n    title: 'NY county populations',\n    params: {\n        area: 'ny',\n        level: 'county',\n        plot: 'map',\n        y: 'pct_total_pop'\n    }\n}];\n\nexport enum LegendCorner {\n    NW = 'nw',\n    NE = 'ne',\n    SW = 'sw',\n    SE = 'se'\n}\n\nexport type LegendPosition = {\n    corner: LegendCorner\n    closestDataPoint: number\n}\n\nexport const BOTTOM_DRAWER_HEIGHT = 320;\nexport const BOTTOM_DRAWER_CORNER = 4;\nexport const PCT_V_SPACE_LEFT_FOR_LEGEND = 1/3;\n","import {createSelector, createSlice, PayloadAction} from '@reduxjs/toolkit';\nimport {RootState} from '../../app/store';\nimport {\n    ApiData, Area, COMPARE_BY_FIELD_CFGS, CompareByField, CompareByFields,\n    Data,\n    DataField, DerivedDataValueSet,\n    FIELD_CFGS,\n    NUMERIC_FIELDS\n} from \"../../dashboard/config\";\nimport {map, zipObj} from 'ramda';\nimport masterData from '../../dashboard/data/master.json'\n\nexport interface DataState {\n    value: Data,\n    status: 'idle' | 'loading' | 'failed';\n}\n\nconst augmentField = (cfg: {[id: string]: any}, f: DataField) : DataField =>\n    ({...f, ...cfg[f.id]});\n\n/**\n * Takes (partial) incoming API data and formats it for Redux store\n */\nconst processData = (data: ApiData) : Data => {\n    // @ts-ignore\n    const newData: Data = {...data};\n    if (!!data.areas) {\n        newData['areas'] = {\n            byId: map((a: Area) => ({\n                ...a,\n                link: `../places/us${a.id === 'us' ? '' : '/' + a.id}`\n            }), data.areas),\n            allIds: Object.keys(data.areas)\n        }\n    }\n    if (!!data.levels) {\n        newData['levels'] = {\n            byId: data.levels,\n            allIds: Object.keys(data.levels)\n        }\n    }\n    if (!!data.fields) {\n        newData['fields'] = {\n            byId: map(f => augmentField(FIELD_CFGS, f), data.fields),\n            allIds: Object.keys(FIELD_CFGS)\n        }\n    }\n    if (!!data.compareByFields) {\n        newData['compareByFields'] = {\n            byId: map(f => augmentField(COMPARE_BY_FIELD_CFGS, f), data.compareByFields),\n            allIds: Object.keys(data.compareByFields)\n        }\n    }\n    return newData;\n};\n\nconst initialState: DataState = {\n    value: {\n        // @ts-ignore\n        ...processData(masterData),\n        values: [],\n        topologies: {byAreaAndLevel: {}}\n    },\n    status: 'idle',\n};\n\nexport const dataSlice = createSlice({\n    name: 'data',\n    initialState,\n    reducers: {\n        setData: (state, action: PayloadAction<any>) => {\n            const newData = processData(action.payload);\n            state.value.values = [];\n            state.value = {...state.value, ...newData};\n        },\n        clearDataValues: (state) => {\n            state.value.values = [];\n        }\n    }\n});\n\nexport const { setData, clearDataValues } = dataSlice.actions;\nexport const selectData = (state: RootState) => state.data.value;\nexport const selectAreas = (state: RootState) => state.data.value?.areas;\nexport const selectFields = (state: RootState) => state.data.value?.fields;\nexport const selectCompareByFields = (state: RootState) :\n    {byId: CompareByFields, allIds: string[]} => state.data.value?.compareByFields;\nexport const selectLevels = (state: RootState) => state.data.value?.levels;\nexport const selectTopologiesByAreaAndLevel = (state: RootState) =>\n    state.data.value?.topologies.byAreaAndLevel;\nexport const selectYears = (state: RootState) => state.data.value?.years;\nexport const selectDivisionsByLevel = (state: RootState) =>\n    state.data.value?.divisions.byLevel;\nexport const selectValues = (state: RootState) : DerivedDataValueSet[] =>\n    state.data.value?.values;\n\nexport const selectAllCompareByFieldDetails = createSelector(\n    selectCompareByFields,\n    (compareByFields) : CompareByField[] => {\n        return compareByFields ? compareByFields.allIds\n            .map(id => compareByFields.byId[id])\n            : null\n    }\n);\n\nexport const selectNumericFields = createSelector(\n    selectFields,\n    (fields) : DataField[] => {\n        return fields ? fields.allIds\n            .map(id => fields.byId[id])\n            .filter(f => NUMERIC_FIELDS.includes(f.type)\n            ) : null\n    }\n);\n\nexport const selectGeoDivisionFields = createSelector(\n    selectLevels,\n    (levels) : DataField[] => {\n        return Object.values(levels.byId).map(level => ({\n            ...level,\n            group: 'Geographic',\n            type: 'geo'\n        }))\n    }\n);\n\nexport default dataSlice.reducer;\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport {last} from 'ramda';\nimport { RootState } from '../../app/store';\nimport {dataSlice} from \"../data/dataSlice\";\nimport {Data} from \"../../dashboard/config\";\n\nexport interface YearState {\n  value: number;\n  status: 'idle' | 'loading' | 'failed';\n}\n\nconst initialState: YearState = {\n  value: 2019,\n  status: 'idle',\n};\n\nexport const yearSlice = createSlice({\n  name: 'year',\n  initialState,\n  reducers: {\n    setYear: (state, action: PayloadAction<number>) => {\n      const value = action.payload;\n      if (value != null && value !== state.value) {\n          state.value = value;\n      }\n    }\n  },\n  extraReducers: {\n    // @ts-ignore\n    [dataSlice.actions.setData]: (state, action: PayloadAction<Data>) => {\n      const data = action.payload;\n      // TODO: I'd like to use the state but it's not set in the store yet.\n      // TODO: Also selectors cannot be run from reducers?\n      // TODO: That'd be the preferred way wouldn't it?\n      if (data.years) {\n        state.value = last(data.years);\n      }\n    }\n  }\n});\n\nexport const { setYear } = yearSlice.actions;\nexport const selectYear = (state: RootState) => state.year.value;\nexport default yearSlice.reducer;\n","import {PLOT_TYPES_MAP} from \"../../dashboard/config\";\nimport { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { RootState } from '../../app/store';\n\nexport interface PlotTypeState {\n    value: string;\n    status: 'idle' | 'loading' | 'failed';\n}\n\nconst initialState: PlotTypeState = {\n    value: 'map',\n    status: 'idle',\n};\n\nexport const plotTypeSlice = createSlice({\n    name: 'plotType',\n    initialState,\n    // The `reducers` field lets us define reducers and generate associated actions\n    reducers: {\n        // Use the PayloadAction type to declare the contents of `action.payload`\n        setPlotType: (state, action: PayloadAction<string>) => {\n            const value = action.payload;\n            if (value != null && value !== '' /* && state.value !== value */)\n                state.value = value;\n        },\n    }\n});\n\nexport const { setPlotType } = plotTypeSlice.actions;\nexport const selectPlotType = (state: RootState) => PLOT_TYPES_MAP[state.plotType.value];\nexport default plotTypeSlice.reducer;\n","import {createSlice, PayloadAction} from '@reduxjs/toolkit';\nimport { RootState } from '../../app/store';\nimport masterData from '../../dashboard/data/master.json';\nimport {ControlValues} from \"../../dashboard/config\";\nimport {equals} from 'ramda';\n\nexport interface ControlsState {\n    value: ControlValues,\n    loaded: boolean\n}\n\nconst defaultFields = Object.keys(masterData.fields);\n\nconst initialState: ControlsState = {\n    value: {\n        area: \"us\",\n        compare: [],\n        level: \"state\",\n        x: defaultFields[0],\n        y: defaultFields[1],\n        z: \"pct_total_pop\"\n    },\n    loaded: false\n};\n\nexport const controlsSlice = createSlice({\n    name: 'controls',\n    initialState,\n    // The `reducers` field lets us define reducers and generate associated actions\n    reducers: {\n        setControls: (state, action: PayloadAction<Object>) => {\n            const newValue = {...state.value, ...action.payload};\n            if (!equals(state.value, newValue)) {\n                state.value = newValue;\n            }\n        },\n        setLoaded: (state) => {\n            state.loaded = true;\n        }\n    }\n});\n\nexport const { setControls, setLoaded } = controlsSlice.actions;\n\nexport const selectActualControlValues = (state: RootState) : ControlValues =>\n    state.controls.value;\n\nexport const selectControlsLoaded = (state: RootState) : boolean =>\n    state.controls.loaded;\n\nexport default controlsSlice.reducer;\n","import { configureStore, ThunkAction, Action } from '@reduxjs/toolkit';\nimport yearReducer from '../features/year/yearSlice';\nimport plotTypeReducer from '../features/plotType/plotTypeSlice';\nimport dataReducer from '../features/data/dataSlice';\nimport controlsReducer from '../features/controls/controlsSlice';\n\nexport const store = configureStore({\n  reducer: {\n    data: dataReducer,\n    year: yearReducer,\n    plotType: plotTypeReducer,\n    controls: controlsReducer,\n  },\n});\n\nexport type AppDispatch = typeof store.dispatch;\nexport type RootState = ReturnType<typeof store.getState>;\nexport type AppThunk<ReturnType = void> = ThunkAction<\n  ReturnType,\n  RootState,\n  unknown,\n  Action<string>\n>;\n","import { useEffect } from \"react\"\n\nconst useTouchOutside = (elementRef, onClick) => {\n    useEffect(() => {\n        const clickListener = event => {\n            if (!elementRef.current || elementRef.current.contains(event.target)) {\n                return\n            }\n            onClick(event)\n        }\n        // const moveListener = event => {\n        //     if (!elementRef.current || elementRef.current.contains(event.target)) {\n        //         return\n        //     }\n        //     onMove(event);\n        // }\n        document.addEventListener(\"touchstart\", clickListener)\n        // document.addEventListener(\"mousemove\", moveListener)\n        return () => {\n            document.removeEventListener(\"touchstart\", clickListener)\n            // document.removeEventListener(\"mousemove\", moveListener)\n        }\n    }, [elementRef, onClick])\n}\n\nexport default useTouchOutside\n","import React from 'react';\nimport { Tooltip } from '@visx/tooltip';\nimport { withBoundingRects } from '@visx/bounds';\n\nfunction CustomTooltipWithBounds({\n                                     left: initialLeft,\n                                     top: initialTop,\n                                     offsetLeft = 20,\n                                     offsetTop = 20,\n                                     rect,\n                                     parentRect,\n                                     getRects,\n                                     children,\n                                     style,\n                                     ...otherProps\n                                 }) {\n\n    let left = initialLeft;\n    let top = initialTop;\n\n    if (parentRect) {\n        if (parentRect.width > 0) {\n            if (left + offsetLeft + rect.width > parentRect.width) {\n                left = parentRect.width - rect.width - offsetLeft;\n            }\n            if (left < 0) {\n                left = 0;\n            }\n        }\n\n        if (parentRect.height > 0) {\n            if (top + offsetTop + rect.height > parentRect.height) {\n                top = parentRect.height - rect.height - offsetTop;\n            }\n            if (top < 0) {\n                top = 0;\n            }\n        }\n    }\n\n    return (\n        <Tooltip\n            style={{ top: 0, transform: `translate(${left}px, ${top}px)`, ...style }}\n            {...otherProps}\n        >\n            {children}\n        </Tooltip>\n    );\n}\nexport default withBoundingRects(CustomTooltipWithBounds);\n","import {intersection, reduce, tail} from 'ramda';\n\n// bind ::  [a] -> (a -> [b]) -> [b]\nconst bind = xs => f => xs.flatMap(f);\n\n// foldr :: (a -> b -> b) -> b -> [a] -> b\nconst foldr = f => a => xs =>\n    xs.reduceRight((a, x) => f(x)(a), a);\n\nexport const cartProdN = foldr(\n    xs => as =>\n        bind(as)(\n            x => bind(xs)(\n                a => [\n                    [a].concat(x)\n                ]\n            )\n        )\n)([\n    []\n]);\n\n// TODO: Are these (above and below) the same?\n\nexport function cartProduct<T>(...sets: T[][]) : T[][] {\n    return sets.reduce((acc: T[][], set: T[]) =>\n            acc.flatMap((x) => set.map(y => [...x, y])),\n        [[]]);\n}\n\nexport const intersectAll = (xs) => reduce(intersection, xs[0], tail(xs));\n\nexport const allValuesNotNull = (obj: Object) : boolean =>\n    Object.values(obj).every(f => f != null);\n\nexport const flattenArrayOfObjects = (arr: Object[]) : Object => {\n    const flatObject = {};\n    for(let i = 0; i < arr.length; i++) {\n        for(const property in arr[i]){\n            flatObject[`${property}`] = arr[i][property];\n        }\n    }\n    return flatObject;\n};\n\nexport function firstAndLast<T>(values: T[]) : T[] {\n    return [values[0], values[values.length - 1]];\n}\n\nexport function nestedFirstAndLast<T>(values: T[][]) : T[][] {\n    return values.map(firstAndLast);\n}\n\nexport function capitalize(s: string) : string {\n    return s[0].toUpperCase() + s.slice(1);\n}\n\nexport const sum = (array) => array.reduce((a, b) => a + b);\nexport const average = (array) => sum(array) / array.length;\n","import { TypedUseSelectorHook, useDispatch, useSelector } from 'react-redux';\nimport type { RootState, AppDispatch } from './store';\n\n// Use throughout your app instead of plain `useDispatch` and `useSelector`\nexport const useAppDispatch = () => useDispatch<AppDispatch>();\nexport const useAppSelector: TypedUseSelectorHook<RootState> = useSelector;\n","import {\n    CompareByField,\n    CompareByFields,\n    CompareByFieldValue\n} from \"../config\";\nimport {firstAndLast, nestedFirstAndLast} from \"./misc\";\nimport {curry, compose, zipObj} from 'ramda';\n\ntype ColorHsv = {\n    h: number,\n    s: number,\n    v: number\n}\n\nconst DEFAULT_COLOR: ColorHsv = {h: 214, s: 0.8, v: 1};\n\nconst HUE_PRESETS = [\n    210,\n    350,\n    32,\n    285,\n    160\n];\n\nconst SAT_RANGE = [0.3, 1];\n\n// Generates a single color for a compare feature value\ntype ColorFn = (inputColor: ColorHsv,\n                value: CompareByFieldValue,\n                nFieldValues: number,\n                valueIndex: number,\n                isPrioritized: boolean) => ColorHsv\n\nexport const autoHueScale = (c: ColorHsv, n: number, i: number) : ColorHsv  => {\n    return {...c, h: HUE_PRESETS[i]};\n};\n\nexport const autoSatScale = (c: ColorHsv, n: number, i: number) : ColorHsv  => {\n    const s = ((SAT_RANGE[1] - SAT_RANGE[0]) / n) * i + SAT_RANGE[0];\n    return {...c, s, v: s >= 1/2 ? 1 - s/3 : 1 };\n};\n\nexport const autoScaleColorNominal = (\n    c, value, nFieldValues, index, isPrioritized\n) : ColorHsv => {\n    if (isPrioritized) {\n        return autoHueScale(c, nFieldValues, index);\n    } else {\n        // Assume ascending order\n        const sStart = SAT_RANGE[0];\n        const sEnd = 1;\n        const vStart = 1;\n        const vEnd = 0.5;\n        const sStep = (sEnd - sStart) / nFieldValues;\n        const vStep = (vEnd - vStart) / nFieldValues;\n        return {...c, s: sStart + sStep * index, v: vStart + vStep * index};\n    }\n};\n\nexport const autoScaleColorOrdinal = (\n    c, value, nFieldValues, index, isPrioritized\n) : ColorHsv => {\n    return autoSatScale(c, nFieldValues, index);\n};\n\nconst COMPARE_BY_COLOR_FNS: {[id: string]: ColorFn} = {  // Listed in priority order\n    'sex':  (c, value) =>\n        ({...c, h: value.shortName === 'M' ? 210 : 330}),\n    'race': autoScaleColorNominal,\n    'marital': autoScaleColorNominal,\n    'education': autoScaleColorNominal,\n    'age': autoScaleColorOrdinal,\n};\n\nconst COMPARE_BY_COLOR_PRIORITIES : {[key: string]: number} = {\n    'sex': 1,\n    'race': 2,\n    'marital': 2,\n    'education': 2,\n    'age': 3\n};\n\nfunction hsvToRgb(h, s, v) {\n    let r, g, b;\n    const h1 = h / 360;  // Convert hue to a value between 0 and 1\n    const i = Math.floor(h1 * 6);\n    const f = h1 * 6 - i;\n    const p = v * (1 - s);\n    const q = v * (1 - f * s);\n    const t = v * (1 - (1 - f) * s);\n    switch (i % 6) {\n        case 0: r = v; g = t; b = p; break;\n        case 1: r = q; g = v; b = p; break;\n        case 2: r = p; g = v; b = t; break;\n        case 3: r = p; g = q; b = v; break;\n        case 4: r = t; g = p; b = v; break;\n        case 5: r = v; g = p; b = q; break;\n    }\n    return [ r * 255, g * 255, b * 255 ].map(x => Math.round(x));\n}\n\nfunction componentToHex(c) {\n    // @ts-ignore\n    const hex = c.toString(16);\n    return hex.length === 1 ? \"0\" + hex : hex;\n}\n\nfunction rgbToHex(r, g, b) {\n    return \"#\" + componentToHex(r) + componentToHex(g) + componentToHex(b);\n}\n\nexport const hsvToHex = (h, s, v) : string => {\n    const [r, g, b] = hsvToRgb(h, s, v);\n    return rgbToHex(r, g, b);\n};\n\ntype FieldValueKey = {\n    field: string\n    value: string\n}\n\ntype ColorKeySet = {\n    k1?: FieldValueKey\n    k2?: FieldValueKey\n}\n\ntype KeysAndHsvColor = {\n    keys: ColorKeySet\n    color: ColorHsv\n}\n\ntype ColorPaletteHashMap = { [key: string]: string }\n\nexport type ColorPalette = {\n    hashMap: ColorPaletteHashMap\n    labels: {\n        rows: string[],\n        cols: string[]\n    },\n    fullNames: {\n        rows: string[],\n        cols: string[]\n    }\n    colors: {\n        byRowAndCol: string[][]\n    }\n}\n\nconst sortKeys = (cbfs: CompareByField[], keys: ColorKeySet) : ColorKeySet => {\n    if (keys.k2) {  // If it has 2 keys (0 or 1 and the order doesn't matter)\n        const fieldToIndexMap = zipObj(\n            cbfs.map((cbf) => cbf.id),\n            cbfs.map((_, i) => i)\n        );\n        if (fieldToIndexMap[keys.k1.field] > fieldToIndexMap[keys.k2.field]) {\n            return { k1: keys.k2, k2: keys.k1 };  // Switch order\n        }\n    }\n    return keys;  // Just return original order\n};\n\nconst createKey = (cbfs: CompareByField[], keys: ColorKeySet) : string => {\n    if (!keys.k1) {\n        return ''\n    } else {\n        const sk = sortKeys(cbfs, keys);\n        return sk.k1.field + '=' + sk.k1.value +\n        (sk.k2 ? (';' + sk.k2.field + '=' + sk.k2.value) : '')\n    }\n}\n\nconst addColorToPalette = (p: ColorPaletteHashMap,\n                           cbfs: CompareByField[],\n                           keys: ColorKeySet, color: string) => {\n    p[createKey(cbfs, keys)] = color;\n}\n\nconst createKeySet = (compareByFields: CompareByField[],\n                      value: Object) : ColorKeySet => {\n    const cbfs = Object.values(compareByFields);\n    if (cbfs.length === 0) {\n        return {};\n    }\n    const k = { k1: { field: cbfs[0].id, value: value[cbfs[0].id] }};\n    switch (cbfs.length) {\n        case 1: return k;\n        case 2: return { ...k, k2: { field: cbfs[1].id, value: value[cbfs[1].id] }};\n        default: throw new Error('Invalid compare by field length: ' + cbfs.length);\n    }\n};\n\nconst _getColorFromPalette = (p: ColorPaletteHashMap,\n                              cbfs: CompareByField[],\n                              ks: ColorKeySet) : string => {\n    return p[createKey(cbfs, ks)];\n}\n\nexport const getColorFromPalette = (p: ColorPalette,\n                                    cbfs: CompareByField[],\n                                    value: Object) : string =>\n    _getColorFromPalette(p.hashMap, cbfs, createKeySet(cbfs, value))\n\nconst getShortLabels = (compare: CompareByField) : string[] =>\n    Object.values(compare.values).map(v => v.shortName);\n\nconst getFullLabels = (compare: CompareByField) : string[] =>\n    Object.values(compare.values).map(v => v.fullName);\n\nfunction iterateOverCompareGrid<T>(fn: (ks: ColorKeySet) => T,\n                                   cbf1: CompareByField,\n                                   cbf2: CompareByField) : T[][] {\n    return Object.values(cbf1.values).map((v1) =>\n        Object.values(cbf2.values).map((v2) => fn({\n            k1: {field: cbf1.id, value: v1.shortName},\n            k2: {field: cbf2.id, value: v2.shortName}\n        })));\n}\n\nconst switchToAlwaysMakeLegendHorizontal = (cbfs: CompareByField[]) : CompareByField[] =>\n    Object.values(cbfs[1].values).length >= Object.values(cbfs[0].values).length\n        ? cbfs : [cbfs[1], cbfs[0]];\n\nconst setupColorPalette = (cbfs: CompareByField[],\n                           kahcs: KeysAndHsvColor[]) : ColorPalette => {\n    const p = { hashMap: {} };\n    kahcs.forEach((kahc) => {\n        addColorToPalette(\n            p.hashMap,\n            cbfs,\n            kahc.keys,\n            hsvToHex(kahc.color.h, kahc.color.s, kahc.color.v));\n    });\n    const keySets = kahcs.map(kahc => kahc.keys);\n    const getColor = curry(_getColorFromPalette)(p.hashMap, cbfs);\n    const getColorGrid = curry(iterateOverCompareGrid)(getColor);\n    switch (cbfs.length) {\n        case 0:\n            return {\n                ...p,\n                labels: { rows: [], cols: [] },\n                fullNames: { rows: [], cols: [] },\n                colors: { byRowAndCol: [] }\n            }\n        case 1:\n            return cbfs[0].type === 'nominal' ? {\n                ...p,\n                labels: {\n                    rows: getFullLabels(cbfs[0]),\n                    cols: []\n                },\n                fullNames: {\n                    rows: getFullLabels(cbfs[0]),\n                    cols: []\n                },\n                colors: {\n                    byRowAndCol: keySets.map(compose(x => [x], getColor))\n                }\n            } : {\n                ...p,\n                labels: {\n                    rows: [],\n                    cols: firstAndLast(getShortLabels(cbfs[0])),\n                },\n                fullNames: {\n                    rows: [],\n                    cols: firstAndLast(getFullLabels(cbfs[0])),\n                },\n                colors: {\n                    byRowAndCol: [firstAndLast(keySets.map(getColor))]\n                }\n            };\n        case 2:\n            if (cbfs[0].type === 'nominal') {  // nominal x nominal\n                const scbfs = switchToAlwaysMakeLegendHorizontal(cbfs);\n                return cbfs[1].type === 'nominal' ? {\n                    ...p,\n                    labels: {\n                        rows: getShortLabels(scbfs[0]),\n                        cols: getShortLabels(scbfs[1])\n                    },\n                    fullNames: {\n                        rows: getFullLabels(scbfs[0]),\n                        cols: getFullLabels(scbfs[1])\n                    },\n                    colors: {\n                        byRowAndCol: getColorGrid(scbfs[0], scbfs[1])\n                    }\n                } : {  // nominal x ordinal\n                    ...p,\n                    labels: {\n                        rows: getFullLabels(cbfs[0]),\n                        cols: firstAndLast(getShortLabels(cbfs[1]))\n                    },\n                    fullNames: {\n                        rows: getFullLabels(scbfs[0]),\n                        cols: firstAndLast(getFullLabels(cbfs[1]))\n                    },\n                    colors: {\n                        byRowAndCol: nestedFirstAndLast(getColorGrid(cbfs[0], cbfs[1]))\n                    }\n                }\n            } else {\n                return cbfs[1].type === 'ordinal' ? {  // ordinal x ordinal\n                    ...p,\n                    labels: {\n                        rows: firstAndLast(getShortLabels(cbfs[0])),\n                        cols: firstAndLast(getShortLabels(cbfs[1])),\n                    },\n                    fullNames: {\n                        rows: firstAndLast(getFullLabels(cbfs[0])),\n                        cols: firstAndLast(getFullLabels(cbfs[1])),\n                    },\n                    colors: {\n                        byRowAndCol: firstAndLast(nestedFirstAndLast(getColorGrid(cbfs[0], cbfs[1])))\n                    }\n                } : {  // ordinal x nominal\n                    ...p,\n                    labels: {\n                        rows: getFullLabels(cbfs[1]),\n                        cols: firstAndLast(getShortLabels(cbfs[0]))\n                    },\n                    fullNames: {\n                        rows: getFullLabels(cbfs[1]),\n                        cols: firstAndLast(getFullLabels(cbfs[0]))\n                    },\n                    colors: {\n                        byRowAndCol: nestedFirstAndLast(getColorGrid(cbfs[1], cbfs[0]))\n                    }\n                };\n            }\n        default:\n            throw new Error(`Has ${cbfs.length} compares. Must be 0-2.`)\n    }\n}\n\nexport const createColorPalette = (compareByFields: CompareByFields) : ColorPalette => {\n    const cbfs = Object.values(compareByFields);\n    const priorities = cbfs.map(cbf => COMPARE_BY_COLOR_PRIORITIES[cbf.id]);\n    const lowPriority = Math.max(...priorities);\n    const highPriority = Math.min(...priorities);\n    const isPrioritized = (cbf: CompareByField, i: number) : boolean => {\n        if (lowPriority === highPriority) {\n            return i === 0;\n        } else {\n            return COMPARE_BY_COLOR_PRIORITIES[cbf.id] === highPriority;\n        }\n    }\n    const kahcs = cbfs.reduce((\n        accum: KeysAndHsvColor[],\n        cbf: CompareByField,\n        cbfi: number\n    ) : KeysAndHsvColor[] => {\n        const isAccumDefault = !accum[0].keys.k1;\n        const fn = COMPARE_BY_COLOR_FNS[cbf.id];\n        if (!fn) {\n            throw new Error(\"Color function not found for \" + cbf.id);\n        }\n        const newColors: KeysAndHsvColor[] = accum.flatMap((\n            existing: KeysAndHsvColor\n        ) => {\n            const fieldValues = Object.values(cbf.values);\n            const nFieldValues = fieldValues.length;\n            return fieldValues.map((cbfv: CompareByFieldValue, vi) => ({\n                keys: isAccumDefault ? {\n                    k1: {\n                        field: cbf.id,\n                        value: cbfv.shortName,\n                    }\n                } : {\n                    ...existing.keys,\n                    k2: {\n                        field: cbf.id,\n                        value: cbfv.shortName\n                    }\n                },\n                color: fn(\n                    existing.color,\n                    cbfv,\n                    nFieldValues,\n                    vi,\n                    isPrioritized(cbf, cbfi))\n            }));\n        });\n        return isAccumDefault ? newColors : [...accum, ...newColors];\n    }, [{color: DEFAULT_COLOR, keys: {}}]);\n    return setupColorPalette(cbfs, kahcs);\n};\n","var _defs, _rect, _rect2, _path;\n\nvar _excluded = [\"title\", \"titleId\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nfunction SvgCompare(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    width: \"256pt\",\n    height: \"256pt\",\n    viewBox: \"0 0 256 256\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _defs || (_defs = /*#__PURE__*/React.createElement(\"defs\", null)), _rect || (_rect = /*#__PURE__*/React.createElement(\"rect\", {\n    id: \"shape0\",\n    transform: \"translate(69, 114.849943765131)\",\n    fill: \"#757575\",\n    fillRule: \"evenodd\",\n    stroke: \"#757575\",\n    strokeWidth: 1,\n    strokeLinecap: \"square\",\n    strokeLinejoin: \"bevel\",\n    width: 48,\n    height: 104.650056234869\n  })), _rect2 || (_rect2 = /*#__PURE__*/React.createElement(\"rect\", {\n    id: \"shape0\",\n    transform: \"matrix(0.999999974659999 0 0 0.999999974659999 135.620811114999 20.4867467256721)\",\n    fill: \"#757575\",\n    fillRule: \"evenodd\",\n    stroke: \"#757575\",\n    strokeWidth: 1,\n    strokeLinecap: \"square\",\n    strokeLinejoin: \"bevel\",\n    width: 48,\n    height: 199.180836768358\n  })), _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    id: \"shape1\",\n    transform: \"translate(20, 236.020978189907)\",\n    fill: \"#757575\",\n    fillRule: \"evenodd\",\n    stroke: \"#757575\",\n    strokeWidth: 10,\n    strokeLinecap: \"square\",\n    strokeLinejoin: \"miter\",\n    strokeMiterlimit: 2,\n    d: \"M0 0.0001L216 0\"\n  })));\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgCompare);\nexport default __webpack_public_path__ + \"static/media/Compare.01e7631b.svg\";\nexport { ForwardRef as ReactComponent };","import {\n    DerivedDataValueSet,\n    FeatureRanges,\n    LegendCorner,\n    LegendPosition,\n    PlotType\n} from \"../config\";\nimport {max, min} from 'd3-array';\nimport {ColorPalette, getColorFromPalette} from \"./colors\";\nimport {average} from \"./misc\";\n\nexport const processItemValues = (\n    vs: DerivedDataValueSet[],\n    controlFields,\n    divisions,\n    colorPalette: ColorPalette\n) => {\n    const createName = (v: DerivedDataValueSet) => {\n        const cs = controlFields.compare;\n        const div = divisions[v.geoid];\n        const area = controlFields.area;\n        const divName = cs.length > 0 ? div?.abbrev || div?.name : div?.name;\n        const areaName = cs.length > 0 ? area.abbrev : area.name;\n        const place = divName || areaName;\n        const getC = c => {\n            if (!c.values[v[c.id]]) {\n                // throw new Error(`Compare value '${c.id}' not found in ${place}`);\n                return [];\n            }\n            return c.values[v[c.id]].mediumName;\n        }\n        const parts = [\n            place,\n            cs.map(getC).join(', ')\n        ];\n        return parts.filter(x => x.length > 0).join(': ')\n    };\n    return vs.map(v => ({\n        ...v,\n        name: createName(v),\n        x: v[controlFields.x.id],\n        y: v[controlFields.y.id],\n        z: v[controlFields.z.id],\n        color: getColorFromPalette(colorPalette, controlFields.compare, v)\n    }));\n};\n\n/**\n * Assumes a linear scale\n */\nconst _findClearestCorner = (left: number[],\n                             right: number[],\n                             y_mean: number,\n                             forceCorner?: LegendCorner) : LegendPosition => {\n    const topLeft = (max(left) - y_mean) / y_mean;\n    const topRight = (max(right) - y_mean) / y_mean;\n    // Avoid lower corners by tipping the scale a little\n    const bottomLeft = ((y_mean * 2 - min(left)) / y_mean);\n    const bottomRight = ((y_mean * 1.5 - min(right)) / y_mean);\n    const minimum = min([topLeft, topRight, bottomLeft, bottomRight]);\n    if (forceCorner != null) {\n        if (forceCorner === LegendCorner.NW) {\n            return {corner: LegendCorner.NW, closestDataPoint: topLeft };\n        } else if (forceCorner === LegendCorner.NE) {\n            return {corner: LegendCorner.NE, closestDataPoint: topRight };\n        } else if (forceCorner === LegendCorner.SW) {\n            return {corner: LegendCorner.SW, closestDataPoint: bottomLeft };\n        } else if (forceCorner === LegendCorner.SE) {\n            return {corner: LegendCorner.SE, closestDataPoint: bottomRight };\n        }\n    }\n    if (topLeft === minimum) {\n        return {corner: LegendCorner.NW, closestDataPoint: topLeft };\n    } else if (topRight === minimum) {\n        return {corner: LegendCorner.NE, closestDataPoint: topRight };\n    } else if (bottomLeft === minimum) {\n        return {corner: LegendCorner.SW, closestDataPoint: bottomLeft };\n    } else if (bottomRight === minimum) {\n        return {corner: LegendCorner.SE, closestDataPoint: bottomRight };\n    } else {\n        return {corner: LegendCorner.NW, closestDataPoint: topLeft };\n    }\n};\n\nexport const chooseLegendPosition = (plotType: PlotType,\n                                     featureRanges: FeatureRanges,\n                                     data: any[],\n                                     forceCorner?: LegendCorner) : LegendPosition => {\n    const _splitHalfs = (pred: (any, number) => number,\n                         values: any[],\n                         c1: number,\n                         c2: number) : [number[], number[]] => {\n        return [\n            values.filter((v, i) => pred(v, i) < c1).map(v => v.y),\n            values.filter((v, i) => pred(v, i) > c2).map(v => v.y)\n        ];\n    };\n    const y_mean = average(featureRanges.y);\n    if (plotType.name === 'bubble') {\n        const c = average(featureRanges.x);\n        const x_min = featureRanges.x[0];\n        const x_max = featureRanges.x[1];\n        const c14 = (c + x_min) / 2;\n        const c34 = (c + x_max) / 2;\n        return _findClearestCorner(..._splitHalfs(d => d.x, data, c14, c34), y_mean, forceCorner);\n    } else if (plotType.name === 'line') {\n        const c = average(featureRanges.year);\n        return _findClearestCorner(..._splitHalfs(d => d.year, data, c, c), y_mean, forceCorner);\n    } else if (plotType.name === 'bar') {\n        const sortedData = data.sort((a, b) => a.scaledY - b.scaledY);\n        const c = data.length / 2;\n        return _findClearestCorner(..._splitHalfs((_, i) => i, sortedData, c, c), y_mean, forceCorner);\n    } else {\n        throw new Error('Unhandled plot type: ' + plotType.name);\n    }\n};\n","import {createSelector} from \"@reduxjs/toolkit\";\nimport {\n    selectAreas,\n    selectDivisionsByLevel,\n    selectFields,\n    selectLevels,\n    selectNumericFields,\n    selectValues,\n    selectTopologiesByAreaAndLevel,\n    selectCompareByFields,\n} from \"../features/data/dataSlice\";\nimport {selectActualControlValues} from \"../features/controls/controlsSlice\";\nimport {mapObjIndexed} from \"ramda\";\nimport {\n    Area,\n    CompareByField,\n    FeatureRanges, LegendCorner, LegendPosition,\n    PLOT_PRESETS,\n    PlotPreset\n} from \"./config\";\nimport {chooseLegendPosition, processItemValues} from \"./utils/domain\";\nimport {min, max} from 'd3-array';\nimport {selectYear} from \"../features/year/yearSlice\";\nimport {createColorPalette} from \"./utils/colors\";\nimport {selectPlotType} from \"../features/plotType/plotTypeSlice\";\nimport queryString from \"query-string\";\n\nexport const selectControlFieldValues = createSelector(\n    selectActualControlValues,\n    selectNumericFields,\n    (cv, nfs) => {\n        if (!nfs || nfs.length === 0) {\n            return cv;\n        }\n        return {\n            ...cv,\n            x: cv.x || nfs[0].id,\n            y: cv.y || nfs[1].id,\n            z: cv.z || nfs[2].id\n        }\n    }\n);\n\nexport const selectControlFields = createSelector(\n    selectAreas,\n    selectLevels,\n    selectFields,\n    selectCompareByFields,\n    selectControlFieldValues,\n    (areas, levels, fields, compareByFields, values) => {\n        return mapObjIndexed((v, k) => {\n            if (!fields || !v) {\n                return null;\n            } else if (k === 'area') {\n                return areas.byId[v];\n            } else if (k === 'compare') {\n                return v.map(cv => compareByFields.byId[cv]);\n            } else if  (k === 'level') {\n                return levels.byId[v];\n            } else {\n                return fields.byId[v];\n            }\n        }, values)\n    }\n);\n\nexport const selectColorPalette = createSelector(\n    selectControlFields,\n    (controls) => {\n        const cbfs = controls.compare;\n        return createColorPalette(cbfs);\n    }\n);\n\nexport const selectCurrentDivisions = createSelector(\n    selectDivisionsByLevel,\n    selectControlFieldValues,\n    (dvsByLevel, cv): any[] => {\n        return dvsByLevel[cv.level];\n    }\n);\n\nexport const selectTopologies = createSelector(\n    selectTopologiesByAreaAndLevel,\n    selectControlFieldValues,\n    (tbaal, cvs) => {\n        if (Object.keys(tbaal).length > 0) {\n            return tbaal[cvs.area] ? tbaal[cvs.area][cvs.level] : null;\n        } else {\n            return null;\n        }\n    }\n);\n\nexport const selectArea = createSelector(\n    selectAreas,\n    selectControlFieldValues,\n    (areas, cv) : Area => {\n        return areas.byId[cv.area];\n    }\n);\n\nexport const selectCurrentCompareDetails = createSelector(\n    selectCompareByFields,\n    selectControlFieldValues,\n    (cb, cv) : CompareByField[] => {\n        return cv.compare.map(c => cb.byId[c]);\n    }\n);\n\nconst summaryDataForAllYears = (vs, area, ds, cf, cp) => {\n    const avs = vs.filter(v => v.geoid === area.geoid);\n    return processItemValues(avs, cf, ds, cp);\n}\n\n\nconst individualDataForAllYears = (vs, area, ds, cf, cp) => {\n    const avs = vs.filter(v => v.geoid !== area.geoid);\n    return processItemValues(avs, cf, ds, cp);\n};\n\nconst individualDataIgnoringComparesForAllYears = (vs, area, ds, cf, cp) => {\n    const avs = vs.filter(v => v.geoid !== area.geoid);\n    return processItemValues(avs, {...cf, compare: []}, ds, cp);\n};\n\nexport const selectPlotData = createSelector(\n    selectPlotType,\n    selectValues,\n    selectArea,\n    selectCurrentDivisions,\n    selectControlFields,\n    selectYear,\n    selectColorPalette,\n    (plotType, vs, area, ds, cf, year, cp) => {\n        const summaryData = () => {\n            const avs = vs.filter(v => v.geoid === area.geoid && v.year === year);\n            return processItemValues(avs, cf, ds, cp);\n        };\n        const individualData = () => {\n            const avs = vs.filter(v => v.geoid !== area.geoid && v.year === year);\n            return processItemValues(avs, cf, ds, cp);\n        };\n        const individualDataIgnoringCompares = () => {\n            const avs = vs.filter(v => v.geoid !== area.geoid && v.year === year);\n            return processItemValues(avs, {...cf, compare: []}, ds, cp);\n        };\n\n        if (plotType.name === 'bubble') {\n            return individualData();\n        } else if (plotType.name === 'line') {\n            if (cf.compare.length === 0) {\n                return individualDataForAllYears(vs, area, ds, cf, cp);\n            } else {\n                return summaryDataForAllYears(vs, area, ds, cf, cp);\n            }\n        } else if (plotType.name === 'bar') {\n            if (cf.compare.length === 0) {\n                return individualData();\n            } else {\n                return summaryData();\n            }\n        } else if (plotType.name === 'map') {\n            return individualDataIgnoringCompares();\n        } else {\n            throw new Error('Unhandled plot type: ' + plotType.name);\n        }\n    }\n);\n\nexport const selectFeatureRanges = createSelector(\n    selectPlotType,\n    selectValues,\n    selectArea,\n    selectCurrentDivisions,\n    selectControlFields,\n    selectColorPalette,\n    (plotType, vs, area, ds, cf, cp) : FeatureRanges => {\n        const data = (() => {\n            if (plotType.name === 'map') {\n                return individualDataIgnoringComparesForAllYears(vs, area, ds, cf, cp);\n            } else if (plotType.name === 'bubble' || cf.compare.length === 0) {\n                return individualDataForAllYears(vs, area, ds, cf, cp);\n            } else {\n                return summaryDataForAllYears(vs, area, ds, cf, cp);\n            }\n        })();\n        const fvs = {\n            x: data.map(v => v.x),\n            y: data.map(v => v.y),\n            z: data.map(v => v.z),\n            year: data.map(v => v.year)\n        }\n        return {\n            x: [min(fvs.x), max(fvs.x)],\n            y: [min(fvs.y), max(fvs.y)],\n            z: [min(fvs.z), max(fvs.z)],\n            year: [min(fvs.year), max(fvs.year)]\n        };\n    }\n);\n\nexport const selectLegendPosition = createSelector(\n    selectPlotType,\n    selectPlotData,\n    selectFeatureRanges,\n    (plotType, data, featureRanges) : LegendPosition | undefined => {\n        if (featureRanges.y[0] == null) {\n            return undefined;\n        } else if (plotType.name === 'bubble' || plotType.name === 'line') {\n            return chooseLegendPosition(plotType, featureRanges, data);\n        } else if (plotType.name === 'bar') {\n            return chooseLegendPosition(plotType, featureRanges, data, LegendCorner.NE);\n        } else {\n            throw new Error('Unhandled plot type: ' + plotType.name);\n        }\n    }\n);\n\nexport const selectPlotPresets = createSelector(\n    selectAreas,\n    (areas) : PlotPreset[] => PLOT_PRESETS.map(p => ({\n        title: p.title,\n        area: areas.byId[p.params.area],\n        url: 'plot?' + queryString.stringify(p.params, {arrayFormat: 'bracket'})\n    })));\n\nexport const isLoaded = createSelector(\n    selectValues,\n    (values) => {\n        return values.length > 0;\n    }\n);\n","import React from \"react\";\nimport {defaultStyles as defaultTooltipStyles, useTooltip} from \"@visx/tooltip\";\nimport {\n    all,\n    curry,\n    groupBy,\n    keys,\n    last,\n    map,\n    range,\n    reduce,\n    tail,\n    values\n} from \"ramda\";\nimport useTouchOutside from \"./useTouchOutside\";\nimport TooltipWithBounds from '../dashboard/CustomTooltipWithBounds';\nimport {animated, useSpring} from \"react-spring\";\nimport {useAppSelector} from \"../app/hooks\";\nimport {selectPlotType} from \"../features/plotType/plotTypeSlice\";\nimport {selectControlFields} from \"../dashboard/selectors\";\nimport {FIELD_TYPE_FORMAT_VALUES_MAP} from \"../dashboard/config\";\n\nconst DEFAULT_OPTIONS = {\n    selectedOpacity: 0.8,\n    unselectedOpacity: 0.15,\n    defaultOpacity: 0.6\n};\n\ntype ItemMap = Map<string, any[] | ItemMap>;\ntype KeyValue = any | ((event: Event) => any)\n\nconst groupByKeys = (keyFields: string[], items: any[]) : ItemMap => {\n    const im = groupBy(item => item[keyFields[0]], values(items));\n    if (keyFields.length === 1) {\n        return im;\n    } else {\n        return map(curry(groupByKeys)(tail(keyFields)), im);\n    }\n};\n\nconst lookupKeys = (keys: string[], itemMap: ItemMap) => {\n    return reduce((im, k) => im[k], itemMap, keys);\n};\n\nconst lookupItem = (keys: string[], itemMap: ItemMap) => {\n    const results = lookupKeys(keys, itemMap);\n    if (results.length === 1) {\n        return results[0];\n    } else {\n        throw new Error(`Found ${results.length} results for lookup of ${keys}`);\n    }\n};\n\nconst matchesAllKeys = (keysToMatch: string[], itemKeys: string[]) : boolean => {\n    const n = Math.min(keysToMatch.length, itemKeys.length);\n    // Keys will be coerced into strings, but they might be originally numbers\n    // eslint-disable-next-line eqeqeq\n    return all(i => keysToMatch[i] == itemKeys[i], range(0, n));\n};\n\nconst TooltipContent = ({item}) => {\n    const controls = useAppSelector(selectControlFields);\n    const plotType = useAppSelector(selectPlotType);\n\n    const FormattedValue = ({field}: {field: string}) => {\n        const formatValue = FIELD_TYPE_FORMAT_VALUES_MAP[controls[field].type];\n        return (\n            plotType.fields[field] && controls[field] && (\n                <div>\n                    {controls[field].name}:{' '}\n                    {formatValue(item[field])}\n                </div>\n            )\n        );\n    };\n\n    return (\n        <div className='tooltip-content'>\n            <div className='tooltip-title'>\n                <h3>{item.name}</h3>\n                <div className='year'>{item.year}</div>\n            </div>\n            <div className='tooltip-body'>\n                <FormattedValue field='y' />\n                <FormattedValue field='x' />\n            </div>\n        </div>\n    );\n};\n\nconst useSelect = (items: any[], keyFields: string[],\n                   showLabel, disableInteraction = false) => {\n    const nKeyFields = keyFields.length;\n    const itemMap = groupByKeys(keyFields, items);\n    const [selectedKeys, selectKeys] = React.useState<string[]>(null);\n    const {\n        tooltipOpen,\n        tooltipLeft,\n        tooltipTop,\n        tooltipData,\n        showTooltip,\n        hideTooltip\n    } = useTooltip();\n\n    const select = React.useCallback(\n        (itemKeys: string[]) => {\n            if (!selectedKeys || !matchesAllKeys(selectedKeys, itemKeys)) {\n                selectKeys(itemKeys);\n                const item = lookupItem(itemKeys, itemMap);\n                showTooltip({\n                    tooltipData: <TooltipContent item={item} />,\n                    tooltipLeft: item.scaledX,\n                    tooltipTop: item.scaledY,\n                });\n            }\n        },\n        [showTooltip, itemMap, selectedKeys]\n    );\n\n    const deselect = React.useCallback(() => {\n        selectKeys(null);\n        hideTooltip();\n    }, [hideTooltip]);\n\n    const getKeys = (key1) : string[] => {\n        switch (nKeyFields) {\n            case 1: return [key1];\n            case 2: return [key1, last(keys(itemMap[key1]))];\n            default: throw new Error(\"Unsupported # of keys: \" + nKeyFields);\n        }\n    };\n\n    React.useEffect(() => {\n        if (showLabel) {\n            select(getKeys(showLabel));\n        }\n    });\n\n    const Tooltip = React.memo(() => {\n        const ref = React.useRef(null);\n        // On touch outside isn't needed for closing the tooltip,\n        // but actually to be able to select the next point (on touchscreen)\n        useTouchOutside(ref, deselect);\n        return tooltipData ? (\n            <>\n                {tooltipOpen && tooltipData && (\n                    // @ts-ignore\n                    <TooltipWithBounds\n                        top={tooltipTop}\n                        left={tooltipLeft}\n                        style={{\n                            ...defaultTooltipStyles,\n                            fontSize: '1em',\n                            padding: '0.6em',\n                            margin: '0.75em'\n                        }}\n                        className='tooltip MuiPaper-elevation5'\n                    >\n                        <div ref={ref}>\n                            {tooltipData}\n                        </div>\n                    </TooltipWithBounds>\n                )}\n            </>\n        ) : null;\n    });\n\n    const makeSelectable = React.useCallback((keyValues: any[], c, options= DEFAULT_OPTIONS) => {\n        // eslint-disable-next-line react-hooks/rules-of-hooks\n        const [{ animOpacity }, setAnim] = useSpring(() => ({\n            animOpacity: options.defaultOpacity,\n        }));\n        const isSelected = selectedKeys && matchesAllKeys(selectedKeys, keyValues);\n        const opacity = isSelected ? options.selectedOpacity : selectedKeys ? options.unselectedOpacity : options.defaultOpacity;\n        const animate = options.animate == null || options.animate === true;\n        if (animate) {\n            setAnim({animOpacity: opacity});\n            // return React.cloneElement(c, {\n            //     key: keyValues.join('_'),\n            //     fillOpacity: animOpacity.to(x => x),\n            //     strokeOpacity:  animOpacity.to(x => x)\n            // });\n            return (\n                <animated.g\n                    fillOpacity={animOpacity.to(x => x)}\n                    strokeOpacity={animOpacity.to(x => x)}\n                    key={keyValues.join('_')}\n                >\n                    {c}\n                </animated.g>\n            );\n        } else {\n            return React.cloneElement(c, {\n                ...c.props,\n                key: keyValues.join('_'),\n                fillOpacity: opacity,\n                strokeOpacity: opacity\n            });\n        }\n    }, [selectedKeys]);\n\n    const makeInteractive = React.useCallback((keyValues: KeyValue[], c) => {\n        if (disableInteraction) {\n            return c;\n        } else {\n            const callback = (event) => {\n                const resolvedKeyValues = keyValues.map(k => k instanceof Function ? k(event) : k);\n                select(resolvedKeyValues);\n            }\n            return React.cloneElement(c, {\n                ...c.props,\n                onTouchStart: callback,\n                onMouseMove: callback,\n                onMouseLeave: deselect\n            });\n        }\n    }, [select, deselect, disableInteraction]);\n\n    const makeSelectableAndInteractive = React.useCallback(\n        (keyValues: KeyValue[], c, options= DEFAULT_OPTIONS) => {\n            const concreteKeys = keyValues.filter(k => !(k instanceof Function))\n            return makeInteractive(keyValues, makeSelectable(concreteKeys, c, options));\n        }, [makeSelectable, makeInteractive]);\n\n    return {makeSelectable, makeInteractive, makeSelectableAndInteractive, Tooltip};\n};\n\nexport default useSelect;\n","import React from \"react\";\nimport {animated, useSprings} from 'react-spring';\nimport {scaleLinear, scalePower} from \"@visx/scale\";\nimport useSelect from \"../hooks/useSelect\";\nimport {FeatureRanges} from \"./config\";\n\nconst paddingPct = 0.1;\n\nexport type BubblePlotProps = {\n    data: any[],\n    featureRanges: FeatureRanges\n    showLabel?: string\n    disableInteraction?: boolean\n    width: number\n    height: number\n};\n\nconst BubblePlot = ({\n    data,\n    featureRanges,\n    showLabel = null,\n    disableInteraction = false,\n    width,\n    height\n}: BubblePlotProps) => {\n    const padding = Math.min(width, height) * paddingPct;\n    const xScale = scaleLinear<number>({\n        domain: featureRanges.x,\n        range: [padding, width - padding],\n        round: true\n    });\n    const yScale = scaleLinear<number>({\n        domain: featureRanges.y,\n        range: [height - padding / 2, padding],\n        round: true\n    });\n\n    const sizeScale = scalePower<number>({\n        domain: [featureRanges.z[0] * 80, featureRanges.z[1] * 120],\n        range: [0.01 * height, 0.06 * height],\n        exponent: 0.5\n    });\n    const items = data\n        .filter(v => v.x != null && v.y != null && v.z != null)\n        .map(v => ({\n            ...v,\n            scaledX: xScale(v.x),\n            scaledY: yScale(v.y),\n            size: sizeScale(v.z * 100)\n        }));\n\n    const {makeSelectableAndInteractive, Tooltip} =\n        useSelect(items, ['name'], showLabel, disableInteraction);\n    const animFn = index => ({\n        animX: items[index].scaledX,\n        animY: items[index].scaledY,\n        animSize: items[index].size\n    });\n    const [springs, api] = useSprings(items.length, animFn);\n    api.start(animFn);\n    return (\n        <>\n            <svg width={width} height={height}>\n                {items.map((item, i) => {\n                    return makeSelectableAndInteractive([item.name],\n                        <animated.circle\n                            cx={springs[i].animX}\n                            cy={springs[i].animY}\n                            r={springs[i].animSize}\n                            fill={item.color + 'EE'}\n                            stroke={item.color}\n                        />\n                    );\n                })}\n            </svg>\n            <Tooltip />\n        </>\n    );\n};\n\nexport default BubblePlot;\n","import React from 'react';\nimport { geoPath, geoAlbersUsa, geoCentroid } from 'd3-geo';\nimport {animated, useSprings} from 'react-spring';\nimport { AlbersUsa } from '@visx/geo';\nimport * as topojson from 'topojson-client';\nimport {zipObj} from \"ramda\";\nimport { hcl } from 'd3-color';\nimport { scaleLinear } from 'd3-scale';\nimport { interpolateHcl } from 'd3-interpolate';\nimport {useAppSelector} from \"../app/hooks\";\nimport useSelect from \"../hooks/useSelect\";\nimport {DataField, FeatureRanges} from \"./config\";\nimport {\n    selectArea, selectCurrentDivisions,\n    selectTopologies\n} from \"./selectors\";\n\nexport type MapPlotProps = {\n    data: any[]\n    featureRanges: FeatureRanges\n    width: number\n    height: number\n    yAxisVar: DataField\n    showLabel?: string\n    disableInteraction?: boolean\n};\n\ninterface FeatureShape {\n    type: 'Feature';\n    id: string;\n    geometry: { coordinates: topojson.Position[][]; type: 'MultiPolygon' };\n    properties: { };\n}\nconst projection = geoAlbersUsa();\nconst usMapOffset: [number, number] = [0.025, 0];\n\nconst opacityOptions = {\n    selectedOpacity: 1,\n    unselectedOpacity: 0.2,\n    defaultOpacity: 0.8\n};\n\nconst strokeFactor = 0.002;\n\nconst DumbMapPlot = ({ data, featureRanges, width, height, area, divisions, topologies,\n                         showLabel = null, disableInteraction = false }) => {\n    const scale = Math.round(Math.min(width, height) * 1.4);\n    const topoFeature = topojson.feature(topologies, topologies.objects.data);\n    const { features: featColl } = topoFeature as {\n        type: 'FeatureCollection';\n        features: FeatureShape[];\n    };\n    const colorScale = scaleLinear()\n        .domain(featureRanges.y)\n        // @ts-ignore\n        .range([\n            hcl('rgba(41,122,204,0.1)'),\n            hcl('#0265c9')])\n        // @ts-ignore\n        .interpolate(interpolateHcl)\n\n    const path = geoPath().projection(projection);\n    projection.scale(1).translate(area.id === 'us' ? usMapOffset : [0, 0]);\n    const b = path.bounds(topoFeature);\n    const s = .95 / Math.max((b[1][0] - b[0][0]) / width, (b[1][1] - b[0][1]) / height);\n    const t = [(width - s * (b[1][0] + b[0][0])) / 2, (height - s * (b[1][1] + b[0][1])) / 2];\n    projection.scale(s).translate([t[0], t[1]]);\n\n    const tempItems = data.map(v => ({\n        ...v,\n        ...divisions[v.geoid],\n        color: colorScale(v.y),\n    }));\n    const itemMap = zipObj(tempItems.map(d => d.geoid), tempItems);\n    const items = featColl.map(f => {\n        const c = projection(geoCentroid(f));\n        return {\n            ...itemMap[f.id],\n            scaledX: c[0],\n            scaledY: c[1]\n        };\n    });\n\n    const {makeSelectableAndInteractive, Tooltip} =\n        useSelect(items, ['name'], showLabel, disableInteraction);\n    const animFn = index => ({ animColor: items[index].color });\n    const [springs, api] = useSprings(items.length, animFn);\n    api.start(animFn);\n    return width < 10 ? null : (\n        <>\n            <svg width={width} height={height}>\n                <AlbersUsa<FeatureShape>\n                    data={featColl}\n                    scale={s}\n                    translate={[t[0], t[1]]}\n                >\n                    {({ features}) =>\n                        features\n                            .map(({ feature, path }, i) => {\n                                const item = itemMap[feature.id];\n                                if (!item) {\n                                    return null;\n                                }\n                                return makeSelectableAndInteractive([item.name],\n                                    <animated.path\n                                        className='map-poly'\n                                        d={path || ''}\n                                        fill={springs[i].animColor}\n                                        strokeWidth={item.name === 'Alaska' ? 0 : scale * strokeFactor}\n                                    />, opacityOptions\n                                )\n                            })\n                    }\n                </AlbersUsa>\n            </svg>\n            <Tooltip />\n        </>\n    );\n};\n\nconst MapPlot = (props: MapPlotProps) => {\n    const area = useAppSelector(selectArea);\n    const topologies = useAppSelector(selectTopologies);\n    const divisions = useAppSelector(selectCurrentDivisions);\n    return topologies &&\n      <DumbMapPlot {...props}\n                   area={area}\n                   divisions={divisions}\n                   topologies={topologies} />\n}\n\nexport default MapPlot;\n","import React from 'react';\nimport { LinePath } from '@visx/shape';\nimport {scaleLinear} from \"@visx/scale\";\nimport {GlyphCircle} from '@visx/glyph';\nimport { localPoint } from '@visx/event';\nimport { voronoi } from '@visx/voronoi';\nimport {groupBy, curry} from \"ramda\";\nimport useSelect from \"../hooks/useSelect\";\nimport {FeatureRanges} from \"./config\";\n\nconst hPaddingPct = 0.015;\nconst vPaddingPct = 0.1\n\nexport type LinePlotProps = {\n    data: any[]\n    featureRanges: FeatureRanges\n    showLabel?: string\n    disableInteraction?: boolean\n    width: number\n    height: number\n};\n\nconst lineOptions = {\n    selectedOpacity: 0.9,\n    unselectedOpacity: 0.15,\n    defaultOpacity: 0.6\n};\n\nconst pointOptions = {\n    selectedOpacity: 1,\n    unselectedOpacity: 0,\n    defaultOpacity: 0,\n    animate: false\n};\n\nconst LinePlot = ({\n    data,\n    featureRanges,\n    showLabel = null,\n    disableInteraction = false,\n    width,\n    height\n}: LinePlotProps) => {\n    const hPadding = React.useMemo(() =>\n            height * hPaddingPct,\n        [height]\n    );\n    const vPadding = React.useMemo(() =>\n            width * vPaddingPct,\n        [width]\n    );\n    const xScale = scaleLinear<number>({\n        domain: featureRanges.year,\n        range: [hPadding, width - hPadding],\n        round: true\n    });\n    const yScale = scaleLinear<number>({\n        domain: featureRanges.y,\n        range: [height - vPadding, vPadding],\n        round: true\n    });\n    const items = data\n        .map(d => ({\n            ...d,\n            scaledX: xScale(d.year),\n            scaledY: yScale(d.y),\n        }));\n\n    const lines = groupBy(d => d.name, items);\n    const lineKeys = Object.keys(lines);\n    const {makeSelectable, makeSelectableAndInteractive, Tooltip} =\n        useSelect(items, ['name', 'year'], showLabel, disableInteraction);\n    const scaledX = (d) => d.scaledX;\n    const scaledY = (d) => d.scaledY;\n    const strokeWidth = Math.max(Math.round(width / 150), 1);\n    const circleSize = Math.round(strokeWidth * 16);\n\n    const voronoiInstance = voronoi({\n        x: scaledX,\n        y: scaledY,\n        width,\n        height\n    });\n\n    const findNearest = (line, event) => {\n        const point = localPoint(event);\n        const nearest = voronoiInstance(line).find(point.x, point.y).data;\n        return nearest.year;\n    };\n\n    return (\n        <>\n            <svg width={width} height={height}>\n                <>\n                    {lineKeys.map((key) => {\n                        const line = lines[key];\n                        return (\n                            <g key={key}>\n                                {makeSelectableAndInteractive([line[0].name, curry(findNearest)(line)],\n                                    <LinePath\n                                    data={line}\n                                    x={(point: any) => point.scaledX}\n                                    y={(point: any) => point.scaledY}\n                                    stroke={line[0].color}\n                                    strokeWidth={strokeWidth}\n                                    />, lineOptions\n                                )}\n                                {line.map(point => makeSelectable([point.name, point.year],\n                                    <GlyphCircle\n                                    left={point.scaledX}\n                                    top={point.scaledY}\n                                    fill={point.color}\n                                    stroke='#FFFFFF'\n                                    size={circleSize}\n                                    strokeWidth={Math.max(strokeWidth / 3, 1)}\n                                    />, pointOptions\n                                ))}\n                            </g>\n                        );\n                    })}\n                </>\n            </svg>\n            <Tooltip />\n        </>\n    );\n};\n\nexport default LinePlot;\n","import React from \"react\";\nimport {scaleBand, scaleLinear} from \"@visx/scale\";\nimport useSelect from \"../hooks/useSelect\";\nimport {animated, useSprings} from 'react-spring';\nimport {range} from 'ramda';\nimport {FeatureRanges, PCT_V_SPACE_LEFT_FOR_LEGEND} from \"./config\";\n\nconst hPaddingPct = 0.015;\nconst vPaddingPct = 0.02\n\nexport type BarPlotProps = {\n    data: any[]\n    featureRanges: FeatureRanges\n    showLabel?: string\n    disableInteraction?: boolean\n    width: number\n    height: number\n};\n\nconst getHeightAdjustment = (featureRanges: FeatureRanges, height: number, startAtZero: boolean = true) : number => {\n    const domain = featureRanges.y[1] - (startAtZero ? 0 : featureRanges.y[0]);\n    const pctOfLowest = featureRanges.y[0] / domain;\n    const range = 1 - PCT_V_SPACE_LEFT_FOR_LEGEND;\n    return height - Math.min(height, height * (range / pctOfLowest));\n};\n\nconst BarPlot = ({\n    data,\n    featureRanges,\n    showLabel = null,\n    disableInteraction = false,\n    width,\n    height\n}: BarPlotProps) => {\n    const hPadding = React.useMemo(() =>\n        Math.min(width, height) * hPaddingPct,\n        [width, height]\n    );\n    const vPadding = React.useMemo(() =>\n        Math.min(width, height) * vPaddingPct,\n        [width, height]\n    );\n    const heightAdjustment = getHeightAdjustment (featureRanges, height);\n    const yScale = React.useMemo(() => scaleLinear<number>({\n        domain: [0, featureRanges.y[1]],\n        range: [height - vPadding, heightAdjustment + vPadding],\n        round: true\n    }), [height, heightAdjustment, vPadding, featureRanges]);\n    const tempItems: any[] = data\n        .map(v => ({\n            ...v,\n            scaledY: yScale(v.y)\n        }))\n        .sort((a, b) => a.scaledY - b.scaledY);\n    const xScale = React.useMemo(() => scaleBand<number>({\n        range: [hPadding, width - hPadding],\n        round: false,\n        domain: range(0, tempItems.length),\n        padding: 0.25,\n    }), [tempItems, hPadding, width]);\n    const items = tempItems.map((item, i) => ({\n        ...item,\n        scaledX: xScale(i)\n    }))\n    const {makeSelectableAndInteractive, Tooltip} =\n        useSelect(items, ['name'], showLabel, disableInteraction);\n    const animFn = index => ({\n        animY: items[index].scaledY,\n        animHeight: height - items[index].scaledY\n    });\n    const [springs, api] = useSprings(items.length, animFn);\n    api.start(animFn);\n    return (\n        <>\n            <svg width={width} height={height - vPadding}>\n                {items.map((item, i) => {\n                    return makeSelectableAndInteractive([item.name],\n                        <animated.rect\n                            y={springs[i].animY}\n                            height={springs[i].animHeight}\n                            x={item.scaledX}\n                            width={xScale.bandwidth()}\n                            fill={item.color}\n                        />\n                    )\n                })}\n            </svg>\n            <Tooltip />\n        </>\n    );\n};\n\nexport default BarPlot;\n","\n\nexport const setSearchPart = (s: string) => {\n    const parts = window.location.hash.split('?');\n    window.location.hash = [parts[0], s.replace('?', '')].join('?');\n};\n","import React from \"react\";\nimport useMediaQuery from '@mui/material/useMediaQuery';\nimport useDarkMode from 'use-dark-mode';\n// import {TransitionProps} from \"@mui/material/transitions\";\nimport {\n    Button,\n    // Collapse,\n    Dialog,\n    DialogActions,\n    DialogContent,\n    FormControl,\n    FormGroup,\n    IconButton,\n    InputLabel,\n    NativeSelect,\n    TextField\n} from \"@mui/material\";\nimport {\n    FacebookIcon,\n    FacebookShareButton,\n    LinkedinIcon,\n    LinkedinShareButton,\n    PinterestIcon,\n    PinterestShareButton,\n    RedditIcon,\n    RedditShareButton,\n    TwitterIcon,\n    TwitterShareButton,\n} from \"react-share\";\nimport FileCopyOutlinedIcon from '@mui/icons-material/FileCopyOutlined';\nimport * as htmlToImage from 'html-to-image';\nimport {\n    Area,\n    AxisLabelSource, PlotType,\n    SHARE_SIZE_MAP,\n    SHARE_SIZES\n} from \"./config\";\nimport {CopyToClipboard} from 'react-copy-to-clipboard';\nimport {useAppSelector} from \"../app/hooks\";\nimport {selectPlotType} from \"../features/plotType/plotTypeSlice\";\nimport {selectYear} from \"../features/year/yearSlice\";\nimport {selectArea} from \"./selectors\";\nimport './sharing.scss';\nimport {useTheme} from \"@mui/system\";\nimport {compose} from 'ramda';\nimport {useLocation} from \"react-router-dom\";\nimport {setSearchPart} from \"./utils/url\";\n\nconst ZOOM = 1;\nconst MAX_PREVIEW_WIDTH = 208 / ZOOM;\nconst MAX_PREVIEW_HEIGHT = 208 / ZOOM;\n\nconst calculatePreviewSize = ({width, height}) => {\n    const ratio = height / width;\n    const h1 = Math.min(ratio * MAX_PREVIEW_WIDTH, MAX_PREVIEW_HEIGHT);\n    const w = Math.min(h1 / ratio, MAX_PREVIEW_WIDTH);\n    const h = Math.min(w * ratio);\n    return {width: w, height: h};\n};\n\n// const ShareTransition = React.forwardRef(function Transition(\n//     props: TransitionProps & { children?: React.ReactElement<any, any> },\n//     ref: React.Ref<unknown>,\n// ) {\n//     return <Collapse ref={ref} {...props} timeout={500} />;\n// });\n\nconst BaseDialog = ({isOpen, setOpen, children, fullScreen=false}) => {\n    const {search} = useLocation();\n\n    React.useEffect(() => {\n        if (isOpen) {\n            if (!search.includes('dialog=open')) {\n                setSearchPart([search, 'dialog=open'].join('&'));\n            }\n        }\n    }, [search, setOpen]);\n\n    return (\n        <Dialog\n            className='share-dialog'\n            open={isOpen}\n            onClose={() => {\n                setOpen(false);\n                window.history.back();\n            }}\n            fullScreen={fullScreen}\n            keepMounted\n        >\n            {children}\n        </Dialog>\n    );\n};\n\nconst createPlotTitle = (plotType: PlotType,\n                         area: Area,\n                         year: number,\n                         compares: { name: string }[],\n                         xAxisLabel: string,\n                         yAxisLabel: string) => {\n    const cs = compares.length > 0 ? ' by ' + compares.map(c => c.name).join('/') : ''\n    return (!plotType.xAxisLabelSource || plotType.xAxisLabelSource === AxisLabelSource.COMPARE ?\n        yAxisLabel + cs :\n        yAxisLabel + ' / ' + xAxisLabel.toLowerCase() + cs) +\n        (plotType.name === 'line' ? '' : ` (${area.abbrev}, ${year})`)\n};\n\nexport const DumbImageDialog = ({plot, isOpen, setOpen, label, setLabel, pageInDarkMode,\n                                compares, xAxisLabel, yAxisLabel, showAxisLabels,\n                                plotType, area, year, items}) => {\n    const plotTitle = createPlotTitle(plotType, area, year, compares, xAxisLabel, yAxisLabel);\n    const defaultShareSize = SHARE_SIZES[0];\n    const [sharePresetSize, setSharePresetSize] = React.useState(defaultShareSize);\n    const [previewSize, setPreviewSize] = React.useState({\n        width: MAX_PREVIEW_WIDTH,\n        height: MAX_PREVIEW_HEIGHT\n    });\n    const [shareSize, setShareSize] = React.useState({\n        width: defaultShareSize.width,\n        height: defaultShareSize.height\n    });\n    const [format, setFormat] = React.useState('PNG');\n    const [imgData, setImgData] = React.useState<string>(null);\n    const fontSize = Math.round(previewSize.width / 40);\n    const theme = useTheme();\n    const fullScreen = useMediaQuery(theme.breakpoints.down('sm'));\n    const [darkModeState, setDarkModeState] = React.useState(pageInDarkMode);\n    const darkModeRef = React.useRef({});\n    darkModeRef.current = darkModeState;\n\n    const ImagePreview = () => {\n        const darkMode = useDarkMode(pageInDarkMode, {\n            classNameDark: 'preview-dark-mode',\n            classNameLight: 'preview-light-mode',\n            storageKey: 'previewDarkMode'\n        });\n        React.useEffect(() => {\n            darkModeRef.current ? darkMode.enable() : darkMode.disable();\n        }, [darkMode]);\n        return (\n            <div className='gen-target'>\n                <div className='plot-frame'>\n                    <div className='title'>{plotTitle}</div>\n                    <div className='subtitle'>\n                        Statistipedia: statistipedia.org/explore\n                    </div>\n                    {plot}\n                </div>\n                { showAxisLabels && xAxisLabel &&\n                  <div className='x-axis'>\n                      {xAxisLabel || 'Year'}\n                  </div>\n                }\n                { showAxisLabels && yAxisLabel &&\n                  <div className='y-axis'>\n                      {yAxisLabel}\n                  </div>\n                }\n            </div>\n        );\n    };\n\n    const canvasToPng = (canvas) => {\n        return canvas.toDataURL(\"image/png\", 1.0);\n    };\n\n    const getGenerateFn = () => {\n        switch (format) {\n            case 'PNG': return compose(p => p.then(canvasToPng), htmlToImage.toCanvas);\n            case 'SVG': return htmlToImage.toSvg;\n            default: throw Error('Unhandled format: ' + format);\n        }\n    };\n\n    const GenerateDialog = ({setImgData}) => {\n        const generate = () => {\n            const el: any = document\n                .getElementById('preview')\n                .getElementsByClassName('gen-target')[0];\n            getGenerateFn()(el, {\n                canvasWidth: shareSize.width,\n                canvasHeight: shareSize.height,\n                pixelRatio: 1,\n                width: el.clientWidth * 4,\n                height: el.clientHeight * 4,\n                quality: 1.0,\n                style: {\n                    zoom: 4\n                }\n            }).then((dataUrl) => {\n                setImgData(dataUrl);\n            });\n        };\n\n        const setNewSize = (newSize) => {\n            setShareSize(newSize);\n            setPreviewSize(calculatePreviewSize(newSize));\n        };\n\n        const onPresetSizeSelect = (event) => {\n            const name = event.target.value;\n            if (name === 'Custom') {\n                setSharePresetSize(null);\n                document\n                    .getElementsByClassName('MuiDialog-container')[0]\n                    .getElementsByClassName('MuiPaper-root')[0]\n                    .scrollTo(0, 9999);\n            } else {\n                const s = SHARE_SIZE_MAP[name];\n                setSharePresetSize(s);\n                setNewSize(s);\n            }\n        };\n\n        const onSizeChange = (newSize) => {\n            setSharePresetSize(null);\n            setNewSize(newSize);\n        };\n\n        // const onLabelChange = (event) => {\n        //     const value = event.target.value;\n        //     setLabel(value === ' ' ? null : value);\n        // };\n\n        const onFormatChange = (event) => {\n            const value = event.target.value;\n            setFormat(value);\n        };\n\n        const onModeChange = (event) => {\n            const value = event.target.value;\n            const b = value === 'Dark'\n            setDarkModeState(b);\n        };\n\n        return (\n            <>\n                <div className='dialog-title'>Generate image</div>\n                <DialogContent className='dialog-content'>\n                    <div id='preview-container'>\n                        <div id='preview' style={{...previewSize, fontSize}}>\n                            <ImagePreview />\n                        </div>\n                        <div className=\"MuiFormLabel-root caption\">\n                            Preview\n                        </div>\n                    </div>\n                    <div className='share-controls'>\n                        <div className='size-inputs'>\n                            <FormControl>\n                                <InputLabel variant=\"standard\" htmlFor=\"preset-size\">Size</InputLabel>\n                                <NativeSelect id=\"preset-size\"\n                                              onChange={onPresetSizeSelect}\n                                              value={sharePresetSize ? sharePresetSize.name : 'Custom'}>\n                                    <optgroup label=\"Presets\">\n                                        {SHARE_SIZES.map((s) => (\n                                            <option key={s.name}>{s.name}</option>\n                                        ))}\n                                    </optgroup>\n                                    <option>Custom</option>\n                                </NativeSelect>\n                            </FormControl>\n                            <FormGroup row className='custom-size-inputs top-padded row'>\n                                {['width', 'height'].map((s) => (\n                                    <FormControl key={s} className='top-padded custom-size-input'>\n                                        <TextField helperText={s}\n                                                   variant=\"standard\"\n                                                   onChange={(event) =>\n                                                       onSizeChange({...shareSize, [s]: event.target.value})}\n                                                   value={shareSize[s]} />\n                                    </FormControl>\n                                ))}\n                            </FormGroup>\n                            {/*<FormGroup row className='row'>*/}\n                            {/*    <FormControl className=\"form-control\">*/}\n                            {/*        <InputLabel variant=\"standard\" htmlFor=\"label\">Labeled item</InputLabel>*/}\n                            {/*        <NativeSelect id=\"label\"*/}\n                            {/*                      value={label ? label : ' '}*/}\n                            {/*                      onChange={onLabelChange}>*/}\n                            {/*            <option value=' ' />*/}\n                            {/*            {items.map(({name}) => (*/}\n                            {/*                <option key={name}>{name}</option>*/}\n                            {/*            ))}*/}\n                            {/*        </NativeSelect>*/}\n                            {/*    </FormControl>*/}\n                            {/*</FormGroup>*/}\n                            <FormGroup row className='top-padded row'>\n                                <FormControl className=\"form-control\">\n                                    <InputLabel variant=\"standard\" htmlFor=\"format\">Format</InputLabel>\n                                    <NativeSelect id=\"format\"\n                                                  value={format}\n                                                  onChange={onFormatChange}\n                                    >\n                                        <option>PNG</option>\n                                        <option>SVG</option>\n                                    </NativeSelect>\n                                </FormControl>\n                                <FormControl className=\"form-control\">\n                                    <InputLabel variant=\"standard\" htmlFor=\"light_dark\">\n                                        Mode\n                                    </InputLabel>\n                                    <NativeSelect id=\"light_dark\"\n                                                  value={darkModeRef.current ? 'Dark' : 'Light'}\n                                                  onChange={onModeChange}>\n                                        <option>Light</option>\n                                        <option>Dark</option>\n                                    </NativeSelect>\n                                </FormControl>\n                            </FormGroup>\n                            {/*<FormControl className=\"form-control\">*/}\n                            {/*    <FormControlLabel*/}\n                            {/*        control={*/}\n                            {/*            <Switch*/}\n                            {/*                color=\"primary\"*/}\n                            {/*            />*/}\n                            {/*        }*/}\n                            {/*        label=\"Add QR code\"*/}\n                            {/*    />*/}\n                            {/*</FormControl>*/}\n                        </div>\n                    </div>\n                </DialogContent>\n                <DialogActions className='dialog-actions'>\n                    <Button onClick={() => window.history.back()}>Close</Button>\n                    <Button onClick={generate}>Generate</Button>\n                </DialogActions>\n            </>\n        );\n    };\n\n    const DownloadDialog = ({imgData, setImgData}) => {\n        const url = window.location.href;\n\n        // const share = () => {\n        //     if (navigator.share) {\n        //         navigator.share({\n        //             title: 'web.dev',\n        //             text: 'Check out web.dev.',\n        //             // url: 'https://web.dev/',\n        //             files: [image]\n        //         })\n        //             .then(() => alert('Successful share'))\n        //             .catch((error) => alert(error));\n        //     }\n        // };\n        return (\n            <>\n                <div className='dialog-title'>Download image</div>\n                <DialogContent className='dialog-content'>\n                    <div className='generated-image'>\n                        <a download={plotTitle} href={imgData}>\n                            <img alt=\"Generated\" src={imgData} />\n                        </a>\n                    </div>\n                    <div className='share-controls'>\n                        <div className='image-share-btns'>\n                            <div className='image-share-btn'>\n                                <PinterestShareButton\n                                    url={url}\n                                    media={imgData}\n                                >\n                                    <PinterestIcon round />\n                                    <div style={{color: '#C9242E'}}>\n                                        Share on Pinterest\n                                    </div>\n                                </PinterestShareButton>\n                            </div>\n                        </div>\n                    </div>\n                </DialogContent>\n                <DialogActions className='dialog-actions'>\n                    <Button onClick={() => setImgData(null)}>Back</Button>\n                    <Button onClick={() => window.history.back()}>Close</Button>\n                    <Button href={imgData} download={plotTitle}>Download</Button>\n                </DialogActions>\n            </>\n        )\n    };\n    return (\n        <BaseDialog isOpen={isOpen} setOpen={setOpen} fullScreen={fullScreen}>\n            {imgData\n                ? <DownloadDialog imgData={imgData} setImgData={setImgData} />\n                : <GenerateDialog setImgData={setImgData} />\n            }\n        </BaseDialog>\n    )\n}\n\nexport const ImageDialog = (props) => {\n    const plotType = useAppSelector(selectPlotType);\n    const area = useAppSelector(selectArea);\n    const year = useAppSelector(selectYear);\n    const items = [];  // TODO: Needs to provide the same items provided to the specific plot type\n    return <DumbImageDialog {...props}\n                            plotType={plotType}\n                            area={area}\n                            year={year}\n                            items={items} />\n};\n\nexport const BasicShareDialog = ({isOpen, setOpen, title='Statistipedia Explore'}) => {\n    const url = window.location.href;\n    return (\n        <BaseDialog isOpen={isOpen} setOpen={setOpen}>\n            <>\n                <div className='dialog-header'>\n                    <div className='dialog-title'>Share</div>\n                </div>\n                <DialogContent className='dialog-content'>\n                    <div className='social-btns'>\n                        <FacebookShareButton\n                            url={url}\n                            quote={title}\n                        >\n                            <FacebookIcon round />\n                        </FacebookShareButton>\n                        <TwitterShareButton\n                            url={url}\n                            title={title}\n                        >\n                            <TwitterIcon round />\n                        </TwitterShareButton>\n                        <RedditShareButton\n                            url={url}\n                            title={title}\n                        >\n                            <RedditIcon round />\n                        </RedditShareButton>\n                        <LinkedinShareButton url={url}>\n                            <LinkedinIcon round />\n                        </LinkedinShareButton>\n                    </div>\n                    <div style={{display: 'flex'}}>\n                        <TextField value={url} />\n                        <CopyToClipboard onCopy={() => {}} text={url}>\n                            <IconButton aria-label=\"copy\"\n                                        className='copy-btn'\n                                        title='Copy to clipboard'>\n                                <FileCopyOutlinedIcon />\n                            </IconButton>\n                        </CopyToClipboard>\n                    </div>\n                </DialogContent>\n                <DialogActions className='dialog-actions'>\n                    <Button onClick={() => window.history.back()}>Close</Button>\n                </DialogActions>\n            </>\n        </BaseDialog>\n    );\n};\n\nexport const SharePlotDialog  = ({isOpen, setOpen, compares, xAxisLabel, yAxisLabel}) => {\n    const plotType = useAppSelector(selectPlotType);\n    const area = useAppSelector(selectArea);\n    const year = useAppSelector(selectYear);\n    const plotTitle = createPlotTitle(plotType, area, year, compares, xAxisLabel, yAxisLabel);\n    return <BasicShareDialog isOpen={isOpen} setOpen={setOpen} title={plotTitle} />;\n};\n","import React from 'react';\nimport { useAppSelector, useAppDispatch } from '../../app/hooks';\nimport { setYear, selectYear } from './yearSlice';\nimport {Box, Slider} from \"@mui/material\";\nimport {styled} from \"@mui/system\";\nimport {selectPlotType} from \"../plotType/plotTypeSlice\";\nimport {last} from 'ramda';\nimport './YearSlider.scss';\nimport {selectYears} from \"../data/dataSlice\";\n\nconst PrettoSlider = styled(Slider)({\n    color: '#318Cf6',\n    height: 8,\n    '& .MuiSlider-track': {\n        border: 'none',\n    },\n    '& .MuiSlider-thumb': {\n        height: 24,\n        width: 24,\n        backgroundColor: '#fff',\n        border: '2px solid currentColor',\n        '&:focus, &:hover, &.Mui-active, &.Mui-focusVisible': {\n            boxShadow: 'inherit',\n        },\n        '&:before': {\n            display: 'none',\n        },\n    },\n    '& .MuiSlider-valueLabel': {\n        lineHeight: 1.2,\n        fontSize: 12,\n        background: 'unset',\n        padding: 0,\n        width: 32,\n        height: 32,\n        borderRadius: '50% 50% 50% 0',\n        backgroundColor: '#318Cf6',\n        transformOrigin: 'bottom left',\n        transform: 'translate(50%, -100%) rotate(-45deg) scale(0)',\n        '&:before': { display: 'none' },\n        '&.MuiSlider-valueLabelOpen': {\n            transform: 'translate(50%, -100%) rotate(-45deg) scale(1)',\n        },\n        '& > *': {\n            transform: 'rotate(45deg)',\n        },\n    },\n    '& .Mui-disabled .MuiSlider-valueLabel': {\n        display: 'none'\n    }\n});\n\nconst YearSlider = () => {\n    const year = useAppSelector(selectYear);\n    const plotType = useAppSelector(selectPlotType);\n    const years = useAppSelector(selectYears);\n    const dispatch = useAppDispatch();\n\n    return plotType && years && year && (\n        <Box sx={{\n            flex: '1 1'\n        }}>\n            <PrettoSlider\n                className='custom-slider'\n                defaultValue={last(years)}\n                min={years[0]}\n                max={last(years)}\n                step={1}\n                disabled={plotType.name === 'line'}\n                valueLabelDisplay=\"on\"\n                onChange={(event, y: number) => {\n                    if (year !== y) {\n                        dispatch(setYear(y))\n                    }\n                }}\n                sx={{\n                    paddingTop: '20px',\n                    '& .MuiSlider-markLabel': {\n                        top: '40px'\n                    }\n                }}\n            />\n        </Box>\n    );\n}\n\nexport default YearSlider;\n","import PlaceIcon from \"@mui/icons-material/Place\";\nimport {ReactComponent as CompareIconSrc} from \"./icons/Compare.svg\";\nimport {ReactComponent as CompareDiffIconSrc} from \"./icons/CompareDiff.svg\";\nimport TagIcon from \"@mui/icons-material/Tag\";\nimport AccessTimeFilledIcon from '@mui/icons-material/AccessTimeFilled';\nimport CalendarMonthIcon from '@mui/icons-material/CalendarMonth';\nimport TimelapseIcon from '@mui/icons-material/Timelapse';\nimport PaidIcon from '@mui/icons-material/Paid';\nimport {SvgIcon} from \"@mui/material\";\nimport BubbleChartIcon from \"@mui/icons-material/BubbleChart\";\nimport DoDisturbIcon from '@mui/icons-material/DoDisturb';\nimport TimelineIcon from \"@mui/icons-material/Timeline\";\nimport BarChartIcon from \"@mui/icons-material/BarChart\";\nimport RoomIcon from \"@mui/icons-material/Room\";\n\nconst makeIcon = (iconSrc) => () => (\n    <SvgIcon component={iconSrc} viewBox=\"0 0 256 256\" />\n);\n\nexport const FIELD_TYPE_ICONS_MAP: {[name: string]: any} = {\n    'geo': PlaceIcon,\n    'numeric': makeIcon(CompareIconSrc),\n    'nominal': makeIcon(CompareIconSrc),\n    'ordinal': makeIcon(CompareIconSrc),\n    'percent': TimelapseIcon,\n    'dollars': PaidIcon,\n    'minutes': AccessTimeFilledIcon,\n    'hours': AccessTimeFilledIcon,\n    'years': CalendarMonthIcon,\n    'none': DoDisturbIcon,\n    'default': TagIcon\n};\n\nexport const PLOT_TYPE_ICONS_MAP: {[name: string]: typeof SvgIcon} = {\n    'bubble': BubbleChartIcon,\n    'line': TimelineIcon,\n    'bar': BarChartIcon,\n    'map': RoomIcon\n};\n","import {ToggleButton, ToggleButtonGroup} from \"@mui/material\";\nimport {PLOT_TYPES} from \"../../dashboard/config\";\nimport React from \"react\";\nimport {useAppDispatch, useAppSelector} from \"../../app/hooks\";\nimport {selectPlotType, setPlotType} from \"./plotTypeSlice\";\nimport {PLOT_TYPE_ICONS_MAP} from \"../../dashboard/icons\";\n\n\nconst PlotTypeSelect = () => {\n    const plotType = useAppSelector(selectPlotType);\n    const dispatch = useAppDispatch();\n\n    const changePlotType = (event, name) => {\n        dispatch(setPlotType(name));\n    }\n\n    return (\n        <div className='plot-type'>\n            <ToggleButtonGroup size='small'\n                               value={plotType.name}\n                               exclusive\n                               onChange={changePlotType}>\n                {PLOT_TYPES.map((pt) => {\n                    const Icon = PLOT_TYPE_ICONS_MAP[pt.name];\n                    return (\n                        <ToggleButton key={pt.name} value={pt.name}>\n                            {<Icon />}\n                        </ToggleButton>\n                    );\n                })}\n            </ToggleButtonGroup>\n        </div>\n    );\n};\n\nexport default PlotTypeSelect;\n","import PlotTypeSelect from \"../plotType/PlotTypeSelect\";\nimport {\n    Autocomplete, Button,\n    Divider, Drawer,\n    FormControl, Input, InputAdornment,\n    InputLabel, List, ListItem, ListItemText, Menu, MenuItem, MenuList,\n    NativeSelect, Select, ListItemIcon,\n    TextField, IconButton\n} from \"@mui/material\";\nimport React, {ChangeEvent, useEffect} from \"react\";\nimport {useAppDispatch, useAppSelector} from \"../../app/hooks\";\nimport {setControls} from \"./controlsSlice\";\nimport {selectPlotType} from \"../plotType/plotTypeSlice\";\nimport {\n    selectAreas,\n    selectAllCompareByFieldDetails,\n    selectNumericFields, selectLevels\n} from \"../data/dataSlice\";\nimport {selectControlFields} from \"../../dashboard/selectors\";\nimport {allValuesNotNull, capitalize} from \"../../dashboard/utils/misc\";\nimport {groupBy, curry, zipObj} from \"ramda\";\nimport {\n    BOTTOM_DRAWER_CORNER,\n    BOTTOM_DRAWER_HEIGHT, CompareByField,\n    DataField\n} from \"../../dashboard/config\";\nimport useMediaQuery from \"@mui/material/useMediaQuery\";\nimport {useTheme} from \"@mui/system\";\nimport ArrowDropDownIcon from '@mui/icons-material/ArrowDropDown';\nimport './Controls.scss';\nimport {FIELD_TYPE_ICONS_MAP} from \"../../dashboard/icons\";\nimport Cached from \"@mui/icons-material/Cached\";\n\ntype FieldOption = DataField & {\n    disabled: boolean\n}\n\ntype FieldGroup = {\n    name: string,\n    fields: FieldOption[]\n};\n\nconst groupFields = (fields: any[]) : FieldGroup[] => {\n    const gs = groupBy(f => f.group, fields);\n    return Object.keys(gs).map(k => ({ name: k, fields: gs[k] }));\n};\n\nconst DrawerFieldSelect = ({children, title, open, setOpen}) => {\n    useEffect(() => {\n        document.body.style.position = open ? 'fixed' : 'initial';\n    }, [open]);\n\n    return (\n        <Drawer\n            anchor='bottom'\n            PaperProps={{\n                style: {\n                    height: BOTTOM_DRAWER_HEIGHT,\n                    borderRadius: `${BOTTOM_DRAWER_CORNER}px ${BOTTOM_DRAWER_CORNER}px 0 0`\n                }\n            }}\n            ModalProps={{\n                keepMounted: true\n            }}\n            open={open}\n            onClose={() => setOpen(false)}\n        >\n            <div>\n                <div className='select-drawer-bar'>\n                    <div className='title'>{title}</div>\n                    <div className='actions'>\n                        <Button onClick={() => setOpen(false)}>Close</Button>\n                    </div>\n                </div>\n                <div className='select-drawer-content'>\n                    {children}\n                </div>\n            </div>\n        </Drawer>\n    );\n};\n\nconst MenuFieldSelect = ({children, anchorEl, setAnchorEl}) => (\n    <Menu\n        variant=\"menu\"\n        anchorEl={anchorEl}\n        open={anchorEl != null}\n        onClose={() => setAnchorEl(null)}\n        MenuListProps={{\n            role: 'listbox',\n        }}\n    >\n        {children}\n    </Menu>\n);\n\nconst FieldSelect = ({children, title, anchorEl, setAnchorEl}) => {\n    const theme = useTheme();\n    const useDrawer = useMediaQuery(theme.breakpoints.down('md'));\n    return useDrawer ? (\n        <DrawerFieldSelect title={title}\n                           open={anchorEl != null}\n                           setOpen={() => setAnchorEl(null)}>\n            {children}\n        </DrawerFieldSelect>\n    ) : (\n        <MenuFieldSelect anchorEl={anchorEl}\n                         setAnchorEl={setAnchorEl}>\n            {children}\n        </MenuFieldSelect>\n    )\n};\n\nconst BaseFieldSelect = ({field, options, onChange, disabled=false, label,\n                             value, className=undefined} :\n                             {field: string, options: FieldGroup[], onChange,\n                                 disabled?: boolean, label: string,\n                                 value: string, className?: string}) => {\n    const [anchorEl, setAnchorEl] = React.useState(null);\n    const handleClickListItem = (event) => {\n        !disabled && setAnchorEl(event.currentTarget);\n    };\n    return (\n        <div>\n            <FormControl className=\"form-control\" disabled={disabled}>\n                <InputLabel variant=\"standard\" htmlFor={`field-${field}`}>\n                    {label}\n                </InputLabel>\n                <div className={`${disabled ? 'Mui-disabled ': ''}${className ? className + ' ' : ''}custom-select MuiInput-root MuiInput-underline MuiInputBase-root MuiInputBase-colorPrimary MuiInputBase-formControl MuiSelect-root`}\n                     onClick={handleClickListItem}>\n                    <div role=\"button\" aria-expanded=\"false\"\n                         aria-haspopup=\"listbox\" aria-labelledby=\"compare-by-1\"\n                         id=\"compare-by-1\"\n                         className=\"MuiSelect-select MuiSelect-standard MuiInput-input MuiInputBase-input\">\n                        {value}\n                    </div>\n                    <ArrowDropDownIcon className='adornment' />\n                    <Input id={`field-${field}`}\n                           className=\"MuiSelect-nativeInput css-yf8vq0-MuiSelect-nativeInput\"\n                           type='hidden'\n                           value={value}\n                           aria-hidden=\"true\"\n                    />\n                </div>\n            </FormControl>\n            <FieldSelect title={label} anchorEl={anchorEl} setAnchorEl={setAnchorEl}>\n                {options.flatMap((g, i) => [\n                    i > 0 ? <Divider key={`${g.name}_divider`} /> : null,\n                    <MenuItem disabled={true}\n                              key={`${g.name}_header`}\n                              className='menu-group-header'>\n                        {g.name}\n                    </MenuItem>,\n                    ...g.fields.map(f => {\n                        const Icon = FIELD_TYPE_ICONS_MAP[f.type] || FIELD_TYPE_ICONS_MAP.default;\n                        return (\n                            <MenuItem key={f.id}\n                                      value={f.id}\n                                      selected={f.name === value}\n                                      disabled={f.disabled}\n                                      onClick={() => onChange({[field]: f.id})}>\n                                <ListItemIcon>\n                                    <Icon/>\n                                </ListItemIcon>\n                                <ListItemText primary={f.name}\n                                              secondary={f.description}/>\n                            </MenuItem>\n                        )\n                    })\n                ])}\n            </FieldSelect>\n        </div>\n    );\n};\n\nconst Controls = () => {\n    const plotType = useAppSelector(selectPlotType);\n    const controls = useAppSelector(selectControlFields);\n    const controlsIsReady = allValuesNotNull(controls);\n    const numericFields = useAppSelector(selectNumericFields);\n    const compareByFields = useAppSelector(selectAllCompareByFieldDetails);\n    const areas = useAppSelector(selectAreas);\n    const levels = useAppSelector(selectLevels);\n    const dispatch = useAppDispatch();\n\n    const disableUsedCompares = (fields: CompareByField[]) : CompareByField[] => {\n        const used = controls.compare.map(c => c.id);\n        return fields.map(f => ({\n            ...f,\n            disabled: used.includes(f.id)\n        }));\n    };\n\n    const addRecents = (fields: CompareByField[]) : CompareByField[] => {\n        const none = {\n            id: 'none',\n            type: 'none',\n            name: 'None',\n            description: 'Clear field',\n            group: 'Recently used',\n            values: {}\n        };\n        return [none, ...fields];\n    }\n\n    const numericFieldGroups = groupFields(numericFields);\n    const compareByGroups = groupFields(addRecents(disableUsedCompares(compareByFields)));\n\n    const updateState = (newState: {[key: string]: any}) => {\n        return dispatch(setControls(zipObj(Object.keys(newState), Object.values(newState))));\n    };\n\n    const updateCompare = (i: number, newState: {[key: string]: any}) => {\n        const newNewState = newState;\n        const k = Object.keys(newState)[0];\n        const v = Object.values(newState)[0];\n        if (v === 'none') {\n            switch (i) {\n                case 0: newNewState[k] = controls.compare.length === 2 ?\n                    [controls.compare[1].id] : []; break;\n                case 1: newNewState[k] = [controls.compare[0].id]; break;\n                default: throw new Error('Unexpected compare index: ' + i)\n            }\n        } else {\n            switch (i) {\n                case 0: newNewState[k] = controls.compare.length === 2 ?\n                    [v, controls.compare[1].id] : [v]; break;\n                case 1: newNewState[k] = [controls.compare[0].id, v]; break;\n                default: throw new Error('Unexpected compare index: ' + i)\n            }\n        }\n        return updateState(newNewState);\n    };\n\n    const switchCompares = () => {\n        const newState = {\n            'compare': [controls.compare[1].id, [controls.compare[0].id]]\n        };\n        return(updateState(newState));\n    };\n\n    const CompareByFieldSelect = ({i}: {i: number}) => (\n        <BaseFieldSelect field={`compare`}\n                         className='compare-by'\n                         options={compareByGroups}\n                         onChange={curry(updateCompare)(i)}\n                         disabled={plotType.name === 'map' || i > controls.compare.length}\n                         label='Compare by'\n                         value={controls.compare[i]?.name || ' '}\n        />\n    );\n\n    const FieldSelect = ({field} : {field: string}) => (\n        <BaseFieldSelect field={field}\n                         options={numericFieldGroups}\n                         onChange={updateState}\n                         disabled={!plotType.fields[field]}\n                         label={plotType.fields[field] || `${field.toUpperCase()}-Axis`}\n                         value={controls[field].name}\n        />\n    );\n\n    const BasicSelect =\n        ({field, options, disabled=false,\n             onChange=(e) => updateState({[field]: e.target.value})} :\n             {field: string, options: {allIds: string[], byId}, disabled?: boolean,\n             onChange?: (e: ChangeEvent<HTMLSelectElement>) => void}) => (\n        <FormControl className=\"form-control\" disabled={disabled}>\n            <InputLabel variant=\"standard\" htmlFor={`field-${field}`}>\n                {capitalize(field)}\n            </InputLabel>\n            <NativeSelect id={field}\n                          onChange={onChange}\n                          value={controls[field].id}>\n                {options.allIds.map(id => (\n                    <option key={id} value={id}>{options.byId[id].name}</option>\n                ))}\n            </NativeSelect>\n        </FormControl>\n    )\n\n    // Not working\n    const AutocompleteSelect =\n        ({field, options, disabled=false} :\n             {field: string, options: {allIds: string[], byId}, disabled?: boolean}) => (\n        <Autocomplete\n            freeSolo\n            disabled={disabled}\n            id={field}\n            className=\"form-control\"\n            options={options.allIds}\n            value={controls[field].id}\n            getOptionLabel={(option) => options.byId[option].name}\n            renderInput={(params) =>\n                <TextField {...params} variant=\"standard\" label={capitalize(field)} />}\n        />\n    )\n\n    return controlsIsReady && areas.allIds.length > 0 && (\n        <div className='controls'>\n            <PlotTypeSelect />\n            <BasicSelect field='area'\n                         options={areas}\n                         onChange={(e) => {\n                             const v = e.target.value;\n                             updateState({\n                                 'area': v,\n                                 'level': v === 'us' ? 'state' : 'county'\n                             });\n                         }} />\n            <BasicSelect field='level' options={levels} disabled={true} />\n            <div className='compare-by-fieldset'>\n                <div className='fields'>\n                    <CompareByFieldSelect i={0} />\n                    <CompareByFieldSelect i={1} />\n                </div>\n\n                <div className='switch'>\n                    <IconButton size='small'\n                                disabled={controls.compare.length < 2}\n                                onClick={switchCompares}>\n                        <Cached />\n                    </IconButton>\n                </div>\n            </div>\n            <FieldSelect field='x' />\n            <FieldSelect field='y' />\n            <FieldSelect field='z' />\n        </div>\n    );\n};\n\nexport default Controls;\n","import React from 'react';\nimport {useAppDispatch, useAppSelector} from \"../../app/hooks\";\nimport {\n    clearDataValues,\n    selectCompareByFields,\n    setData\n} from \"./dataSlice\";\nimport {DATA_DIR, DataValue, DerivedDataValueSet} from \"../../dashboard/config\";\nimport {groupBy, difference} from 'ramda';\nimport axios from \"axios\";\nimport {flattenArrayOfObjects} from \"../../dashboard/utils/misc\";\nimport {\n    selectControlFields,\n    selectControlFieldValues\n} from \"../../dashboard/selectors\";\nimport {selectControlsLoaded} from \"../controls/controlsSlice\";\nimport {selectPlotType} from \"../plotType/plotTypeSlice\";\n\ntype ChunkParams = {\n    level: string\n    area: string\n}\n\ntype ValueChunkParams = ChunkParams & {\n    compare: string[]\n    feature: string\n}\n\ntype TopologyChunkParams = {\n\n}\n\ntype ChunkToFetch<P> = {\n    url: string,\n    params: P\n}\n\ntype FetchedChunk<P> = {\n    data: DataValue[],\n    params: P\n}\n\ntype FlattenedValueChunk = {\n    data: DataValue,\n    params: ValueChunkParams\n}\n\nexport const computeValueChunk = (\n    area: string,\n    level: string,\n    feature: string,\n    compare: string[],\n    plotType: string\n) : ChunkToFetch<ValueChunkParams> => {\n    const c = compare.length === 0 || plotType === 'map' ? 'all' : compare.join('_');\n    return {\n        url: `/pums/${area}/${level}/${feature}/${c}.json`,\n        params: {\n            area,\n            level,\n            compare,\n            feature,\n        }\n    };\n};\n\nexport const computeTopologyChunk = (\n    area: string,\n    level: string\n) : ChunkToFetch<TopologyChunkParams> => {\n    return {\n        url: `/topologies/${area}.json`,\n        params: {\n            area,\n            level\n        }\n    };\n}\n\nconst sortCompares = (compareFields, compares) => {\n    return compareFields.allIds.filter(c => compares.includes(c));\n};\n\nconst DataManager = () => {\n    const plotType = useAppSelector(selectPlotType);\n    const controls = useAppSelector(selectControlFieldValues);\n    const compareFields = useAppSelector(selectCompareByFields);\n    const controlsLoaded = useAppSelector(selectControlsLoaded);\n    const dispatch = useAppDispatch();\n\n    React.useEffect(() => {\n        const _computeChunks = () : ChunkToFetch<ValueChunkParams|TopologyChunkParams>[] => {\n            const compares = sortCompares(compareFields, controls.compare);\n            const {x, y, z} = controls;\n            return [\n                ...[x, y, z].map(f =>\n                    computeValueChunk(\n                        controls.area, controls.level, f, compares, plotType.name)),\n                computeTopologyChunk(controls.area, controls.level)\n            ];\n        }\n\n        const isValueChunk = (c: FetchedChunk<ValueChunkParams|TopologyChunkParams>) : boolean => {\n            // @ts-ignore\n            return !!c.params.compare;\n        }\n\n        const groupByFn = (v: FlattenedValueChunk) => {\n            const compareValues = v.params.compare.map(c => v.data[c]);\n            return v.data.geoid + \"_\" + v.data.year + \"_\" + compareValues.join(\"_\");\n        }\n\n        const mergeFeatures = (vs: FlattenedValueChunk[]) : DerivedDataValueSet => {\n            const featureSet = [...new Set(vs.flatMap(v => v.params.feature))];\n            const allKeys = [...new Set(vs.flatMap(v => Object.keys(v.data)))];\n            const nonFeatureSet = difference(allKeys, featureSet);\n            const output = {};\n            vs.forEach(v => {\n                featureSet.forEach(feature => {\n                    const featureValue = v.data[feature];\n                    if (featureValue != null) {\n                        output[feature] = featureValue\n                    }\n                });\n            });\n            nonFeatureSet.forEach(key => {      // All non-feature values\n                output[key] = vs[0].data[key];  // should be the same\n            });\n            return output;\n        };\n\n        const processValues = (cs: FetchedChunk<ValueChunkParams>[]) : DerivedDataValueSet[] => {\n            const vs: FlattenedValueChunk[] = cs.flatMap(\n                c => c.data.map(d => ({data: d, params: c.params})));\n            const groups: FlattenedValueChunk[][] = Object.values(groupBy(groupByFn, vs));\n            return groups.map(mergeFeatures);\n        };\n\n        const onChunksFetched = (cs: FetchedChunk<ValueChunkParams|TopologyChunkParams>[]): void => {\n            const valueDataArray = cs.filter(isValueChunk) as FetchedChunk<ValueChunkParams>[];\n            const valueData = processValues(valueDataArray);\n            const otherData = cs.filter(c => !isValueChunk(c)).map(c => c.data);\n            const data = { values: valueData, ...flattenArrayOfObjects(otherData) };\n            dispatch(setData(data));\n        };\n\n        const _fetchChunks = (cs: ChunkToFetch<ValueChunkParams|TopologyChunkParams>[]) => {\n            Promise.all(cs.map(c => axios.get(DATA_DIR + c.url))).then((responses) => {\n                const fcs = responses.map((r, i) =>\n                    ({data: r.data, params: cs[i].params}));\n                onChunksFetched(fcs);\n            });\n        };\n\n        const update = () => {\n            return (dispatch, getState) => {\n                dispatch(clearDataValues());\n                _fetchChunks(_computeChunks());\n            }\n        };\n\n        if (controlsLoaded)\n            dispatch(update());\n    }, [dispatch, plotType, controls, controlsLoaded]);  // data left out of deps to prevent infinite loop\n\n    return null;\n}\n\nexport default DataManager;\n","import React from 'react';\nimport {useLocation} from 'react-router-dom';\nimport {useAppDispatch, useAppSelector} from \"../app/hooks\";\nimport {selectControlFields, selectControlFieldValues} from \"./selectors\";\nimport {selectYear, setYear} from \"../features/year/yearSlice\";\nimport {map, filter,} from 'ramda';\nimport {selectPlotType, setPlotType} from \"../features/plotType/plotTypeSlice\";\nimport {setControls, setLoaded} from \"../features/controls/controlsSlice\";\nimport {setSearchPart} from \"./utils/url\";\nconst queryString = require('query-string');\n\nconst Url = () => {\n    const controls = useAppSelector(selectControlFieldValues);\n    const storedYear = useAppSelector(selectYear);\n    const storedPlotType = useAppSelector(selectPlotType);\n    const dispatch = useAppDispatch();\n    const {search} = useLocation();\n\n    // Don't think we need the thunk stuff anymore, but just leave it for now.\n\n    const updateUrl = () => {\n        return (dispatch, getState) => {\n            const state = getState();\n            const controls = selectControlFields(state);\n            const storedYear = selectYear(state);\n            const storedPlotType = selectPlotType(state);\n            if (state.controls.loaded) {\n                const allParams = {\n                    plot: storedPlotType.name,\n                    ...map(f => f ? f.id : null, controls),\n                    compare: controls.compare.map(c => c.id),\n                    year: storedYear\n                };\n                const params = filter(p => !!p, allParams);\n                const newS = queryString.stringify(params, {arrayFormat: 'bracket'});\n                if (newS !== search) {\n                    setSearchPart(newS);\n                    // TODO: Should we really clobber all the history?\n                    // window.history.replaceState({}, null, '?' + s);\n                }\n            }\n        }\n    }\n\n    const configUpdated = () => {\n        const { x, y, z, area, level, compare, plot, year } =\n            queryString.parse(search, {arrayFormat: 'bracket'});\n        const nonNullControls = filter(v => !!v, {x, y, z, area, level, compare});\n        dispatch(setControls(nonNullControls));\n        if (!!plot)\n            dispatch(setPlotType(plot));\n        if (!!year)\n            dispatch(setYear(parseInt(year)));\n    }\n\n    const loadState = () => {\n        return (dispatch, getState) => {\n            dispatch(updateUrl());\n            dispatch(setLoaded());\n        }\n    }\n\n    React.useEffect(() => {  // Only first load\n        dispatch(loadState());\n    }, []);\n\n    React.useEffect(() => {   // On URL change\n        configUpdated();\n    }, [search]);\n\n    React.useEffect(() => {   // On controls change\n        dispatch(updateUrl());\n    }, [dispatch, controls, storedYear, storedPlotType]);\n\n    return null\n};\n\nexport default Url\n","import {FC} from 'react';\nimport './Legend.scss';\nimport {useAppSelector} from \"../app/hooks\";\nimport {\n    selectColorPalette,\n    selectCurrentCompareDetails,\n    selectLegendPosition,\n} from \"./selectors\";\nimport {ColorPalette} from \"./utils/colors\";\nimport {CompareByField, LegendCorner, LegendPosition} from \"./config\";\nimport Tooltip from '@mui/material/Tooltip';\nimport ClickAwayListener from '@mui/material/ClickAwayListener';\nimport {tooltipClasses} from \"@mui/material\";\n\ntype LegendComponentProps = {\n    compares: CompareByField[]\n    colorPalette: ColorPalette\n}\n\nconst bgAlphaHex = 'CC';\n\nconst OrdinalStrip = ({fromColor, toColor, label=null}) => {\n    return (\n        <>\n            <div className='strip'\n                 style={{\n                     backgroundImage: `linear-gradient(to right, ${fromColor + bgAlphaHex}, ${toColor + bgAlphaHex})`\n                 }}>\n                {label}\n            </div>\n        </>\n    )\n}\n\nconst OrdinalLabels = ({start, end}) => (\n    <div className='labels strip'>\n        <div className='label' style={{ top: 0, left: 0 }}>{start}</div>\n        <div className='label' style={{ top: 0, right: 0 }}>{end}</div>\n    </div>\n)\n\nconst OrdinalLegend = ({colorPalette}: LegendComponentProps) => {\n    return (\n        <div className='ordinal'>\n            <OrdinalLabels start={colorPalette.labels.cols[0]}\n                           end={colorPalette.labels.cols[1]} />\n            <OrdinalStrip fromColor={colorPalette.colors.byRowAndCol[0][0]}\n                          toColor={colorPalette.colors.byRowAndCol[0][1]}\n            />\n        </div>\n    );\n};\n\nconst NominalLegend = ({colorPalette}: LegendComponentProps) => {\n    // const cols = [\n    //     {name: 'Wh', hue: 200},\n    //     {name: 'Bl', hue: 340},\n    //     {name: 'Hs', hue: 150},\n    //     {name: 'As', hue: 40},\n    // ];\n\n    return (\n        <div className='nominal'>\n            {colorPalette.colors.byRowAndCol.map((row, r) =>\n                <div key={'row-' + r}\n                     className='strip'\n                     style={{ backgroundColor: row[0] + bgAlphaHex }}>\n                    {colorPalette.labels.rows[r]}\n                </div>\n            )}\n        </div>\n    );\n};\n\nconst OrdinalByNominalLegend = ({colorPalette}: LegendComponentProps) => (\n    <div className='ordinal'>\n        <OrdinalLabels start={colorPalette.labels.cols[0]}\n                       end={colorPalette.labels.cols[1]} />\n        {colorPalette.colors.byRowAndCol.map((colorRow, r) => (\n            <OrdinalStrip key={'row-' + r}\n                          fromColor={colorRow[0]}\n                          toColor={colorRow[1]}\n                          label={colorPalette.labels.rows[r]}\n            />\n        ))}\n    </div>\n);\n\nconst NominalByNominalLegend = ({colorPalette}: LegendComponentProps) => (\n    <table className='nominal-grid' cellPadding={0} cellSpacing={0}>\n        <tbody>\n            <tr>\n                <th />\n                {colorPalette.labels.cols.map((col, c) => (\n                    <th key={'col-header-' + c} className='col-header'>\n                        {col}\n                    </th>\n                ))}\n            </tr>\n            {colorPalette.colors.byRowAndCol.map((colorRow, r) => (\n                <tr key={'row-' + r} >\n                    <th className='row-header'>\n                        {colorPalette.labels.rows[r]}\n                    </th>\n                    {colorRow.map((colorCell, c) => (\n                        <Tooltip disableFocusListener\n                                 title={\n                                     colorPalette.fullNames.rows[r] + ', ' +\n                                     colorPalette.fullNames.cols[c]}>\n                            <td key={`cell-${c}-${r}`}\n                                className='cell'\n                                style={{\n                                    backgroundColor: colorCell + bgAlphaHex\n                                }} />\n                        </Tooltip>\n                    ))}\n                </tr>\n            ))}\n        </tbody>\n    </table>\n);\n\nconst OrdinalByOrdinalLegend = ({colorPalette}: LegendComponentProps) => {\n    const cs = colorPalette.colors.byRowAndCol;\n    const ls = colorPalette.labels;\n    return (\n        <div  className='ordinal'>\n            <div className='layer'\n                 style={{\n                     backgroundImage: `linear-gradient(to right, ${cs[0][0] + bgAlphaHex}, ${cs[0][1] + bgAlphaHex})`,\n                }}\n            >\n            </div>\n            <div className='layer'\n                 style={{\n                     backgroundImage: `linear-gradient(to right, ${cs[1][0] + bgAlphaHex}, ${cs[1][1] + bgAlphaHex}`,\n                     WebkitMask: 'linear-gradient(to bottom, #0000, #00000080 50%, #000D 80%, #000 100%)',\n                     mask: 'linear-gradient(to bottom, #0000, #00000080 50%, #000D 80%, #000 100%)',\n                 }}\n            >\n            </div>\n            <div className='label' style={{ top: 4, left: 16}}>${ls.cols[0]}</div>\n            <div className='label' style={{ top: 4, right: 10}}>${ls.cols[1]}</div>\n            <div className='label' style={{ top: 16, left: 6 }}>${ls.rows[0]}</div>\n            <div className='label' style={{ bottom: 10, left: 6 }}>${ls.rows[1]}</div>\n        </div>\n    );\n};\n\nconst getLegendComponent = (compares: CompareByField[]) : FC<LegendComponentProps> => {\n    const types = compares.map(c => c.type);\n    switch (compares.length) {\n        case 0:\n            return null;\n        case 1:\n            return types[0] === 'nominal' ? NominalLegend : OrdinalLegend;\n        case 2:\n            if (types[0] === 'nominal') {\n                return types[1] === 'nominal' ? NominalByNominalLegend : OrdinalByNominalLegend;\n            } else {\n                return types[1] === 'ordinal' ? OrdinalByOrdinalLegend : OrdinalByNominalLegend;\n            }\n        default:\n            throw new Error(`Has ${compares.length} compares. Must be 0-2.`)\n    }\n};\n\nconst Legend = () => {\n    const colorPalette = useAppSelector(selectColorPalette);\n    const compares = useAppSelector(selectCurrentCompareDetails);\n    const position = useAppSelector(selectLegendPosition);\n    const LegendComponent = getLegendComponent(compares);\n    if (!position || compares.length === 0) {\n        return null;\n    }\n    return(\n        <div className={`legend ${position.corner}`}>\n            <LegendComponent colorPalette={colorPalette} compares={compares} />\n        </div>\n    );\n}\n\nexport default Legend;\n","import React from 'react';\nimport {Link} from 'react-router-dom';\nimport {\n    AppBar, Collapse,\n    Divider, Drawer,\n    Hidden, IconButton,\n    List,\n    ListItemButton, ListItemIcon,\n    ListItemText, Toolbar, Typography\n} from \"@mui/material\";\nimport HomeIcon from \"@mui/icons-material/Home\";\nimport DataIcon from \"@mui/icons-material/Storage\";\nimport MenuIcon from \"@mui/icons-material/Menu\";\nimport LightModeIcon from \"@mui/icons-material/LightMode\";\nimport DarkModeIcon from \"@mui/icons-material/DarkMode\";\nimport ExpandLess from \"@mui/icons-material/ExpandLess\";\nimport ExpandMore from \"@mui/icons-material/ExpandMore\";\nimport './Nav.scss';\nimport ShareIcon from \"@mui/icons-material/Share\";\nimport {useAppSelector} from \"../app/hooks\";\nimport {selectPlotPresets} from \"./selectors\";\n\nconst SideMenuItem = ({text, icon, children=null}) => {\n    const [open, setOpen] = React.useState(false);\n    return (\n        <>\n            <ListItemButton onClick={() => setOpen(!open)}>\n                <ListItemIcon className='menu-item-icon'>{icon}</ListItemIcon>\n                <ListItemText primary={text} />\n                {children && (open ? <ExpandLess /> : <ExpandMore />)}\n            </ListItemButton>\n            {children && (\n                <Collapse in={open} timeout=\"auto\" unmountOnExit className='nested-menu'>\n                    {children}\n                </Collapse>\n            )}\n        </>\n    );\n};\n\nconst Nav = ({darkMode, ShareDialog, children=null}) => {\n    const plotPresets = useAppSelector(selectPlotPresets);\n    const [shareOpen, setShareOpen] = React.useState(false);\n    const [drawerOpen, setDrawerOpen] = React.useState(false);\n    const drawer = (\n        <div className='side-menu'>\n            <Divider />\n            <List>\n                <a href='/'>\n                    <SideMenuItem text='Statistpedia' icon={<HomeIcon />} />\n                </a>\n                {/*<SideMenuItem text='Datasets' icon={<DataIcon />} />*/}\n                <SideMenuItem text='Presets' icon={<DataIcon />}>\n                    <List>\n                        { plotPresets.map((p) => (\n                            <Link to={'/' + p.url} key={p.title}>\n                                <ListItemButton>\n                                    <ListItemText>{p.title}</ListItemText>\n                                </ListItemButton>\n                            </Link>\n                        ))}\n                    </List>\n                </SideMenuItem>\n            </List>\n            <Divider />\n        </div>\n    );\n    return (\n        <>\n            <nav>\n                <Hidden xlUp>\n                    <Drawer\n                        variant=\"temporary\"\n                        open={drawerOpen}\n                        onClose={() => setDrawerOpen(false)}\n                        ModalProps={{\n                            keepMounted: true, // Better open performance on mobile.\n                        }}\n                    >\n                        {drawer}\n                    </Drawer>\n                </Hidden>\n                <Hidden xlDown>\n                    <Drawer\n                        variant=\"permanent\"\n                        open\n                    >\n                        {drawer}\n                    </Drawer>\n                </Hidden>\n            </nav>\n            <AppBar className='top-bar'\n                    position=\"static\"\n                    elevation={darkMode.value ? 0 : 1}>\n                <Toolbar variant=\"dense\">\n                    <IconButton edge=\"start\"\n                                sx={{\n                                    marginRight: '0.5em',\n                                    display: { xs: 'inline-flex', xl: 'none' }\n                                }}\n                                onClick={() => setDrawerOpen(!drawerOpen)}\n                                color=\"inherit\"\n                                aria-label=\"menu\">\n                        <MenuIcon />\n                    </IconButton>\n                    <Typography\n                        id='site-title'\n                        variant=\"h1\"\n                        sx={{\n                            display: ['none', 'block']\n                        }}\n                    >\n                        <Link to='/' style={{\n                            color: 'inherit',\n                            textDecoration: 'none'\n                        }}>\n                            Statistipedia <sub><small><i>EXPLORE</i></small></sub>\n                        </Link>\n                    </Typography>\n                    <Typography\n                        id='site-title'\n                        variant=\"h1\"\n                        sx={{\n                            display: ['block', 'none']\n                        }}\n                    >\n                        <Link to='/' style={{\n                            color: 'inherit',\n                            textDecoration: 'none'\n                        }}>\n                            S<sub><small><i>E</i></small></sub>\n                        </Link>\n                    </Typography>\n                    <div className=\"grow\" />\n                    {children}\n                    <IconButton className='menu-btn'\n                                onClick={() => setShareOpen(true)}\n                                color=\"inherit\">\n                        <ShareIcon />\n                    </IconButton>\n                    <IconButton edge=\"end\"\n                                className='menu-btn'\n                                onClick={darkMode.toggle}\n                                color=\"inherit\">\n                        {darkMode.value ? <LightModeIcon /> : <DarkModeIcon />}\n                    </IconButton>\n                    {shareOpen && <ShareDialog isOpen={shareOpen} setOpen={setShareOpen} />}\n                </Toolbar>\n            </AppBar>\n\n        </>\n    );\n};\n\nexport default Nav;\n","export default __webpack_public_path__ + \"static/media/logo.7b743608.svg\";","import React from 'react';\nimport {Provider} from 'react-redux';\nimport {HashRouter, Link, Route, Routes} from \"react-router-dom\";\nimport useDarkMode from 'use-dark-mode';\nimport {store} from '../app/store';\nimport {\n    Box,\n    Button,\n    Card,\n    CircularProgress,\n    CssBaseline,\n    IconButton,\n    ThemeProvider,\n    useMediaQuery\n} from '@mui/material';\nimport {createTheme} from '@mui/material/styles';\nimport BubblePlot from \"./BubblePlot\";\nimport {ParentSize} from \"@visx/responsive\";\nimport './Dashboard.scss';\nimport PlayIcon from '@mui/icons-material/PlayArrow';\nimport PhotoCameraIcon from '@mui/icons-material/PhotoCamera';\nimport {AxisLabelSource} from \"./config\";\nimport {setUseWhatChange} from '@simbathesailor/use-what-changed';\nimport MapPlot from \"./MapPlot\";\nimport LinePlot from \"./LinePlot\";\nimport BarPlot from \"./BarPlot\";\nimport {BasicShareDialog, ImageDialog, SharePlotDialog} from \"./sharing\";\nimport YearSlider from \"../features/year/YearSlider\";\nimport {useAppSelector} from \"../app/hooks\";\nimport {selectPlotType} from \"../features/plotType/plotTypeSlice\";\nimport Controls from \"../features/controls/Controls\";\nimport DataManager from \"../features/data/DataManager\";\nimport Url from './Url';\nimport {\n    isLoaded,\n    selectControlFields,\n    selectFeatureRanges, selectLegendPosition, selectPlotData,\n    selectPlotPresets\n} from \"./selectors\";\nimport {allValuesNotNull} from \"./utils/misc\";\nimport Legend from \"./Legend\";\nimport Nav from \"./Nav\";\nimport LogoIcon from \"./icons/logo.svg\";\n\nsetUseWhatChange(process.env.NODE_ENV === 'development');\nrequire('typeface-roboto');\n\nconst LoadingPlot = ({width, height}) => (\n    <div className='loading-plot' style={{width, height}}>\n        <CircularProgress variant='indeterminate'\n                          size={Math.min(Math.round(width / 7), 80)} />\n    </div>\n);\n\nconst PlotArea = ({plotType,\n                      axisLabels, xAxisLabel=null, yAxisLabel=null,\n                      disableInteraction = false, showLabel,\n                      x, y, levelVar}) => {\n    const DumbPlotArea = ({width, height}) => {\n        const data = useAppSelector(selectPlotData);\n        const featureRanges = useAppSelector(selectFeatureRanges);\n        const props = {\n            data,\n            featureRanges,\n            showLabel,\n            disableInteraction,\n            width,\n            height\n        };\n        switch (plotType.name) {\n            case 'bubble': return <BubblePlot {...props} />;\n            case 'line': return <LinePlot {...props}  />;\n            case 'bar': return <BarPlot {...props}  />;\n            default: return <MapPlot {...props} yAxisVar={y} />;\n        }\n    }\n    const loading = !useAppSelector(isLoaded);\n    return (\n        <ParentSize debounceTime={10} className='bg'>\n            {({ width, height }) => {\n                return (width + height) > 0 && (\n                    <div className='plot' style={{width, height}}>\n                        {loading ?\n                        <LoadingPlot width={width} height={height} /> :\n                        <DumbPlotArea width={width} height={height} /> }\n                        {axisLabels && !plotType.hideAxisLabels && (\n                            <>\n                                <div className='x-axis'>\n                                    {xAxisLabel || levelVar}\n                                </div>\n                                <div className='y-axis' style={{width: height}}>\n                                    {yAxisLabel}\n                                </div>\n                            </>\n                        )}\n                        {plotType.name !== 'map' && <Legend />}\n                    </div>\n                )\n            }}\n        </ParentSize>\n    );\n};\n\ntype DumbDashboardProps = {\n    darkMode: any\n    plotType: any\n    controls: any\n}\n\nconst DumbDashboard = ({darkMode, plotType, controls}: DumbDashboardProps) => {\n    const [genImgOpen, setGenImgOpen] = React.useState(false);\n    const [showLabel, setShowLabel] = React.useState(null);\n\n    const computeXAxisLabel = () : string => {\n        switch (plotType.xAxisLabelSource) {\n            case AxisLabelSource.VAR: return controls.x.name;\n            case AxisLabelSource.COMPARE: return controls.compare.map(c => c.name).join('/');\n            case AxisLabelSource.YEAR: return 'Year'\n            default: return null;\n        }\n    };\n\n    const xAxisLabel = computeXAxisLabel();\n    const yAxisLabel = controls.y?.name;\n\n    const Plot = ({axisLabels, showLabel = null, disableInteraction = false}) => {\n        return (\n            <PlotArea plotType={plotType}\n                      axisLabels={axisLabels}\n                      disableInteraction={disableInteraction}\n                      showLabel={showLabel}\n                      x={controls.x}\n                      y={controls.y}\n                      xAxisLabel={xAxisLabel}\n                      yAxisLabel={yAxisLabel}\n                      levelVar={controls.level.name}\n            />\n        );\n    };\n\n    // useWhatChanged([plotType, controls]);\n\n    return (\n        <>\n            <Nav darkMode={darkMode} ShareDialog={\n                ({isOpen, setOpen}) => <SharePlotDialog\n                    compares={controls.compare}\n                    xAxisLabel={xAxisLabel}\n                    yAxisLabel={yAxisLabel}\n                    isOpen={isOpen}\n                    setOpen={setOpen} />\n            }>\n                <IconButton className='menu-btn'\n                            onClick={() => setGenImgOpen(true)}\n                            color=\"inherit\">\n                    <PhotoCameraIcon />\n                </IconButton>\n            </Nav>\n\n            {genImgOpen && <ImageDialog\n              isOpen={genImgOpen}\n              setOpen={setGenImgOpen}\n              label={showLabel}\n              setLabel={setShowLabel}\n              compares={controls.compare}\n              xAxisLabel={xAxisLabel}\n              yAxisLabel={yAxisLabel}\n              showAxisLabels={!plotType.hideAxisLabels}\n              pageInDarkMode={darkMode.value}\n              plot={<Plot axisLabels={false}\n                          disableInteraction={true}\n                          showLabel={showLabel} />} />}\n            <div id=\"dashboard\">\n                <main>\n                    <div className='plot-area'>\n                        <Card className='section'>\n                            <div id='inner-plot-container'>\n                                <Plot axisLabels={true} />\n                            </div>\n                        </Card>\n                    </div>\n                    <div className='timeline'>\n                        <IconButton className='play' disabled={plotType.name === 'line'}>\n                            <PlayIcon />\n                        </IconButton>\n                        <YearSlider />\n                    </div>\n                </main>\n                <aside>\n                    <Controls />\n                </aside>\n            </div>\n        </>\n    );\n};\n\nconst Dashboard = ({darkMode}) => {\n    const plotType = useAppSelector(selectPlotType);\n    const controls = useAppSelector(selectControlFields);\n    const controlsIsReady = allValuesNotNull(controls);\n    return (\n        <>\n            {\n                controlsIsReady && plotType &&\n                <DumbDashboard darkMode={darkMode}\n                               plotType={plotType}\n                               controls={controls} />\n            }\n            <Url />\n            <DataManager />\n        </>\n    );\n};\n\nconst ExternalLink = ({to, style={}, children}) => (\n    <a href={to}\n          target='_blank'\n          rel='noreferrer'\n          className='external'\n          style={style}\n    >\n        {children}\n    </a>\n);\n\nconst SiteScreenshot = ({file}: {file: string}) => (\n    <a href={'/explore/img/' + file} className='screenshot' target='screenshot'>\n        <img src={'/explore/img/' + file} width='100%' alt='screenshot' />\n    </a>\n);\n\nconst DumbHome = ({darkMode, plotPresets}) => (\n    <>\n        <Nav darkMode={darkMode} ShareDialog={BasicShareDialog} />\n        <div id='home'>\n            <main>\n                <Card className='section'>\n                    <img className='logo' src={LogoIcon} alt='Statistipedia logo' />\n                    <h2>Welcome to Statistipedia <i>Explore!</i></h2>\n                    <p>\n                        This is an interactive dashboard.\n                    </p>\n                    <p style={{textAlign: 'center', margin: '1.5em 0'}}>\n                        <Link to='plot' className='btn'>\n                            <Button variant=\"contained\">Enter dashboard here</Button>\n                        </Link>\n                    </p>\n                    <p>Or you can try these presets:</p>\n                    <table id='presets-table'>\n                        <tbody>\n                        <tr>\n                            <th>Area</th>\n                            <th>Description</th>\n                        </tr>\n                        { plotPresets.map((p) => (\n                            <tr key={p.title}>\n                                <td>\n                                    <ExternalLink to={p.area.link}\n                                          style={{whiteSpace: 'nowrap'}}>\n                                        {p.area.name}\n                                    </ExternalLink>\n                                </td>\n                                <td>\n                                    <Link to={'/' + p.url}>{p.title}</Link>\n                                </td>\n                            </tr>\n                        ))}\n                        </tbody>\n                    </table>\n                </Card>\n            </main>\n            <aside>\n                <SiteScreenshot file='screenshot1.png' />\n                <SiteScreenshot file='screenshot3.png' />\n                <SiteScreenshot file='screenshot2.png' />\n                <SiteScreenshot file='screenshot4.png' />\n            </aside>\n        </div>\n    </>\n);\n\nconst Home = ({darkMode}) => {\n    const plotPresets = useAppSelector(selectPlotPresets);\n    return <DumbHome darkMode={darkMode} plotPresets={plotPresets} />;\n};\n\nconst About = ({darkMode}) => (\n    <>\n        <Nav darkMode={darkMode} ShareDialog={BasicShareDialog} />\n        <div id='about'>\n            Sun God Ra\n        </div>\n    </>\n);\n\nconst DashboardApp = () => {\n    const prefersDarkMode = useMediaQuery('(prefers-color-scheme: dark)');\n    const darkMode = useDarkMode(prefersDarkMode);\n    const theme = React.useMemo(\n        () =>\n            createTheme({\n                palette: {\n                    mode: darkMode.value ? 'dark' : 'light',\n                    primary: {\n                        main: darkMode.value ? '#175391' : '#2278CF'\n                    }\n                },\n                breakpoints: {\n                    values: {\n                        xs: 1,\n                        sm: 360,\n                        md: 640,\n                        lg: 960,\n                        xl: 1080,\n                    },\n                }\n            }),\n        [darkMode],\n    );\n    return (\n        <Provider store={store}>\n            <ThemeProvider theme={theme}>\n                <CssBaseline />\n                <Box sx={{\n                    boxSizing: 'border-box',\n                    width: '100%',\n                    height: '100%',\n                    display: 'flex',\n                    flexDirection: 'column',\n                    paddingLeft: { xs: 0, xl: '270px' }\n                }}>\n                    <HashRouter>\n                        <Routes>\n                            <Route path=\"\" element={<Home darkMode={darkMode} />}/>\n                            <Route path=\"about\" element={<About darkMode={darkMode} />}/>\n                            <Route path=\"plot\" element={<Dashboard darkMode={darkMode} />}/>\n                        </Routes>\n                    </HashRouter>\n                </Box>\n            </ThemeProvider>\n        </Provider>\n    );\n};\n\nexport default DashboardApp;\n"],"sourceRoot":""}