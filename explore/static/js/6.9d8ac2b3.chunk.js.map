{"version":3,"sources":["dashboard/config.ts","dashboard/utils/misc.ts","features/data/dataSlice.ts","features/year/yearSlice.ts","features/plotType/plotTypeSlice.ts","features/controls/controlsSlice.ts","app/store.ts","hooks/useTouchOutside.ts","dashboard/CustomTooltipWithBounds.tsx","app/hooks.ts","dashboard/selectors.ts","hooks/useSelect.tsx","dashboard/utils/domain.ts","dashboard/BubblePlot.tsx","dashboard/MapPlot.tsx","dashboard/LinePlot.tsx","dashboard/BarPlot.tsx","dashboard/sharing.tsx","features/year/YearSlider.tsx","features/plotType/PlotTypeSelect.tsx","features/controls/Controls.tsx","dashboard/utils/dataSplitting.ts","features/data/DataManager.tsx","dashboard/Url.tsx","dashboard/Dashboard.tsx","utils.ts"],"names":["AxisLabelSource","FieldType","PLOT_TYPES","name","icon","BubbleChartIcon","xAxisLabelSource","VAR","fields","x","y","z","TimelineIcon","YEAR","BarChartIcon","COMPARE","RoomIcon","hideAxisLabels","PLOT_TYPES_MAP","zipObj","map","p","SHARE_SIZES","width","height","SHARE_SIZE_MAP","f","fieldCfgs","type","CURRENCY","NUMERIC","bind","xs","flatMap","as","a","concat","reduceRight","mergeDeepWithConcat","mergeDeepWith","Array","isArray","getNestedValues","obj","level","vals","Object","values","v","invertNestedObject","entries","reduce","acc","innerKey","forEach","outerKey","val","augmentField","id","dataSlice","createSlice","initialState","value","levels","areas","years","byLevelAndField","divisions","byLevel","byFieldAndDivision","status","reducers","setData","state","action","data","processData","payload","actions","selectData","selectAreas","selectNumericFields","filter","yearSlice","setYear","extraReducers","last","selectYear","year","plotTypeSlice","setPlotType","selectPlotType","plotType","urlParams","getUrlParams","area","compare","controlsSlice","setControl","key","setControls","store","configureStore","reducer","dataReducer","yearReducer","plotTypeReducer","controls","controlsReducer","useTouchOutside","elementRef","onClick","useEffect","clickListener","event","current","contains","target","document","addEventListener","removeEventListener","withBoundingRects","initialLeft","left","initialTop","top","offsetLeft","offsetTop","rect","parentRect","children","getRects","style","otherProps","transform","useAppDispatch","useDispatch","useAppSelector","useSelector","selectControlValues","createSelector","cv","nfs","length","selectXyzControlValues","selectNonNullXyzControlArray","selectControlFields","mapObjIndexed","k","selectCurrentDivisions","dvsByLevel","selectYears","yblaf","cvs","xyz","intersection","tail","processDatasetItem","vbfad","field","selectCurrentDataset","byField","byYear","DEFAULT_OPTIONS","selectedOpacity","unselectedOpacity","defaultOpacity","groupByKeys","keyFields","items","im","groupBy","item","curry","lookupItem","keys","itemMap","results","lookupKeys","Error","matchesAllKeys","keysToMatch","itemKeys","n","Math","min","all","i","range","formatValue","Number","toLocaleString","TooltipContent","className","useSelect","showLabel","disableInteraction","nKeyFields","React","useState","selectedKeys","selectKeys","useTooltip","tooltipOpen","tooltipLeft","tooltipTop","tooltipData","showTooltip","hideTooltip","select","useCallback","scaledX","scaledY","deselect","getKeys","key1","Tooltip","memo","ref","useRef","defaultTooltipStyles","fontSize","padding","margin","makeSelectable","keyValues","c","options","useSpring","animOpacity","setAnim","isSelected","opacity","animate","g","fillOpacity","to","strokeOpacity","join","cloneElement","props","makeInteractive","callback","resolvedKeyValues","Function","onTouchStart","onMouseMove","onMouseLeave","makeSelectableAndInteractive","concreteKeys","prepareData","dataByYear","dataArray","outerKeys","arrayLength","r","innerKeys","invertMapOfMaps","toPairs","allValuesNotNull","every","DumbBubblePlot","scaleFactor","xScale","scaleLinear","domain","extent","round","yScale","sizeScale","size","animX","animY","animSize","circle","cx","cy","fill","stroke","BubblePlot","unitedStates","topojson","topology","objects","states","features","projection","geoAlbersUsa","opacityOptions","DumbMapPlot","centerX","centerY","scale","colorScale","hcl","interpolate","interpolateHcl","slice","color","includeIds","d","ifs","includes","geoCentroid","AlbersUsa","translate","feature","path","animColor","strokeWidth","MapPlot","lineOptions","pointOptions","DumbLinePlot","useMemo","ds","yvs","a2","convertData","lines","lineKeys","max","circleSize","voronoiInstance","voronoi","findNearest","line","point","localPoint","find","LinePath","GlyphCircle","LinePlot","DumbBarPlot","hPadding","vPadding","tempItems","scaleBand","bandwidth","BarPlot","ShareTransition","forwardRef","Collapse","timeout","BaseDialog","setOpen","fullScreen","Dialog","open","onClose","TransitionComponent","keepMounted","createPlotTitle","compareByVar","xAxisLabel","yAxisLabel","toLowerCase","DumbImageDialog","plot","label","setLabel","showAxisLabels","theme","useTheme","useMediaQuery","breakpoints","down","plotTitle","defaultShareSize","sharePresetSize","setSharePresetSize","previewSize","setPreviewSize","shareSize","setShareSize","format","setFormat","imgData","setImgData","GenerateDialog","setNewSize","newSize","ratio","h1","w","calculatePreviewSize","DialogContent","FormControl","InputLabel","variant","htmlFor","NativeSelect","onChange","getElementsByClassName","scrollTo","s","FormGroup","row","TextField","helperText","FormControlLabel","control","Switch","DialogActions","Button","el","getElementById","htmlToImage","getGenerateFn","canvasWidth","canvasHeight","quality","pixelRatio","then","dataUrl","DownloadDialog","url","window","location","href","download","alt","src","PinterestShareButton","media","PinterestIcon","ImageDialog","ShareDialog","FacebookShareButton","quote","FacebookIcon","TwitterShareButton","title","TwitterIcon","RedditShareButton","RedditIcon","LinkedinShareButton","LinkedinIcon","display","onCopy","text","IconButton","PrettoSlider","styled","Slider","border","backgroundColor","boxShadow","lineHeight","background","borderRadius","transformOrigin","YearSlider","dispatch","Box","sx","flex","defaultValue","step","disabled","valueLabelDisplay","paddingTop","PlotTypeSelect","ToggleButtonGroup","exclusive","pt","ToggleButton","Controls","controlsIsReady","numericFields","updateState","newState","Autocomplete","getOptionLabel","option","renderInput","params","SplittingDataFetcher","config","_computeChunkUrls","paramsToChunkUrls","u","BASE_CHUNK_URL","_fetchChunks","urls","axios","get","spread","responses","onChunkFetch","fetchChunks","this","DataManager","chunk","Url","storedYear","useQueryParams","StringParam","createEnumParam","NumberParam","query","setQuery","nonNullControls","allParams","setUseWhatChange","process","require","LoadingPlot","CircularProgress","PlotArea","loading","axisLabels","showPlot","sizeVar","yAxisVar","ParentSize","debounceTime","SideMenuItem","ListItem","button","ListItemIcon","ListItemText","primary","in","unmountOnExit","DumbDashboard","prefersDarkMode","computeXAxisLabel","createTheme","palette","mode","main","sm","md","lg","xl","Plot","SideMenu","drawerOpen","setDrawerOpen","genImgOpen","setGenImgOpen","shareOpen","setShareOpen","setShowLabel","drawer","Divider","List","Hidden","lgUp","Drawer","ModalProps","lgDown","AppBar","position","elevation","Toolbar","edge","marginRight","spacing","Typography","ThemeProvider","CssBaseline","boxSizing","flexDirection","paddingLeft","Card","myHistory","push","history","pushState","replace","replaceState","Dashboard","DashboardApp","zipmap","arr1","arr2","decodeURI","question","indexOf","hash","substring","result","split","part","eq","substr","decodeURIComponent","from","index"],"mappings":"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","file":"static/js/6.9d8ac2b3.chunk.js","sourcesContent":["import SvgIcon from \"@mui/material/SvgIcon/SvgIcon\";\nimport BubbleChartIcon from '@mui/icons-material/BubbleChart';\nimport TimelineIcon from '@mui/icons-material/Timeline';\nimport BarChartIcon from '@mui/icons-material/BarChart';\nimport RoomIcon from '@mui/icons-material/Room';\nimport {zipObj, range} from \"ramda\";\nimport {RouteComponentProps} from \"@reach/router\";\n\nexport enum AxisLabelSource {\n    VAR,\n    COMPARE,\n    YEAR\n}\n\nexport type PlotType = {\n    name: string,\n    icon: typeof SvgIcon,\n    xAxisLabelSource?: AxisLabelSource,\n    hideAxisLabels?: boolean,\n    fields: {\n        x?: string,\n        y?: string,\n        z?: string\n    }\n};\n\nexport const PLOT_TYPES: PlotType[] = [{\n    name: 'bubble',\n    icon: BubbleChartIcon,\n    xAxisLabelSource: AxisLabelSource.VAR,\n    fields: {\n        x: 'X-Axis',\n        y: 'Y-Axis',\n        z: 'Size'\n    }\n}, {\n    name: 'line',  // aka. time series chart\n    icon: TimelineIcon,\n    xAxisLabelSource: AxisLabelSource.YEAR,\n    fields: {\n        // X-Axis is always time. Existing selection is kept, only disabled\n        y: 'Y-Axis'\n    }\n}, {\n    name: 'bar',\n    icon: BarChartIcon,\n    xAxisLabelSource: AxisLabelSource.COMPARE,\n    fields: {\n        // compare: 'Compare by',  // Secondary grouping nested under \"Compare by\"\n        y: 'Y-Axis'\n    }\n}, {\n    name: 'map',\n    icon: RoomIcon,\n    hideAxisLabels: true,\n    fields: {\n        y: 'Color'\n    }\n}];\n\nexport const PLOT_TYPES_MAP: Map<string, PlotType> =\n    zipObj(PLOT_TYPES.map(p => p.name), PLOT_TYPES);\n\nexport type ShareSize = {\n  name: string,\n  width: number,\n  height: number\n};\n\nexport const SHARE_SIZES: ShareSize[] = [{\n    name: 'Instagram Square',\n    width: 1080,\n    height: 1080\n}, {\n    name: 'Twitter',\n    width: 1024,\n    height: 512\n}, {\n    name: 'Pinterest',\n    width: 800,\n    height: 1200\n}, {\n    name: 'Tumblr',\n    width: 1280,\n    height: 1920\n}];\n\nexport const SHARE_SIZE_MAP: Map<string, ShareSize> =\n    zipObj(SHARE_SIZES.map(p => p.name), SHARE_SIZES);\n\nexport type Area = {\n    id: string\n    abbrev: string\n    name: string\n}\n\nexport const AREAS: Area[] = [{\n    id: 'us',\n    abbrev: 'us',\n    name: 'United States'\n}];\n\nexport interface IDashboardProps extends RouteComponentProps {\n    area?: string;\n    compare?: string\n}\n\nexport enum FieldType {\n    NUMERIC,\n    CURRENCY\n}\n\nexport type DataFieldCfg = {\n    id: string,\n    type?: FieldType\n};\n\nexport type DataField = {\n    id: string,\n    name: string,\n    type?: FieldType\n};\n\nexport const fieldCfgs: {[id: string]: {type: FieldType}} = {\n    'median_price': {\n        type: FieldType.CURRENCY\n    },\n    'median_rent': {\n        type: FieldType.CURRENCY\n    },\n    'total_pop': {\n        type: FieldType.NUMERIC\n    }\n};\n\nexport type Data = {\n    areas: {[id: string]: { id: string, name: string }},\n    levels: {[id: string]: { id: string, name: string }},\n    fields: {[id: string]: DataField},\n    years: { byLevelAndField: {[levelId: string]: {[fieldId: string]: any[]}}}\n    divisions: { byLevel: {[levelId: string]: any[]} }\n    values: { byFieldAndDivision: {[fieldId: string]: any[]} }\n}\n\nexport const getOgImageUrl = (params: IDashboardProps) : string => {\n    return '';\n};\n","import {zipObj, mergeDeepWith, concat, intersection, reduce, tail, all, range, map} from 'ramda';\n\n// bind ::  [a] -> (a -> [b]) -> [b]\nconst bind = xs => f => xs.flatMap(f);\n\n// foldr :: (a -> b -> b) -> b -> [a] -> b\nconst foldr = f => a => xs =>\n    xs.reduceRight((a, x) => f(x)(a), a);\n\nexport const cartProdN = foldr(\n    xs => as =>\n        bind(as)(\n            x => bind(xs)(\n                a => [\n                    [a].concat(x)\n                ]\n            )\n        )\n)([\n    []\n]);\n\nexport type ObjWithId = {id: string};\n\nexport function normalize<T extends ObjWithId>(objArray: T[]) : { [key: string]: T } {\n    return zipObj(objArray.map(item => item.id), objArray);\n}\n\nexport const mergeDeepWithConcat = mergeDeepWith((x, y) => Array.isArray(x) ? concat(x, y) : y);\n\nexport const intersectAll = (xs) => reduce(intersection, xs[0], tail(xs));\n\nexport const getNestedValues = (obj: Object, level: number = 1) : any[] => {\n    const vals = Object.values(obj);\n    if (level > 1)\n        return vals.flatMap(v => getNestedValues(level - 1, v));\n    else\n        return vals.flatMap(v => Object.values(v));\n}\n\nexport const invertMapOfMaps = (\n    obj: {[key1: string]: {[key2: string]: any[]}}\n) : {[key2: string]: {[key1: string]: any[]}} => {\n    const outerKeys = Object.keys(obj);\n    if (outerKeys.length === 0)\n        return {}\n    const arrayLength = Object.values(obj[outerKeys[0]]).length;\n    if (!all(k => Object.values(obj[k]).length === arrayLength, outerKeys))\n        throw new Error(\"All arrays must be the same length.\");\n    const r = range(0, arrayLength);\n    const innerKeys = Object.keys(obj[outerKeys[0]]);\n    const vals = r.map(i => zipObj(outerKeys, outerKeys.map(k => obj[k][innerKeys[i]])));\n    return zipObj(innerKeys, vals);\n}\n\nexport const invertNestedObject = x => {\n    return x == null || Object.values(x)[0] == null ? null :\n        Object.entries(x).reduce((acc, [innerKey, obj]) => {\n            Object.entries(obj).forEach(([outerKey, val]) => {\n                acc[outerKey] = acc[outerKey] || {}; // grab the object already stored at the `outerKey` or create a new one.\n                acc[outerKey][innerKey] = val;\n            })\n            return acc;\n        }, {});\n};\n","import {\n    createAsyncThunk,\n    createSelector,\n    createSlice,\n    PayloadAction\n} from '@reduxjs/toolkit';\nimport { RootState } from '../../app/store';\nimport {Data, DataField, fieldCfgs, FieldType} from \"../../dashboard/config\";\nimport {mergeDeepWithConcat} from \"../../dashboard/utils/misc\";\nimport {map} from 'ramda';\n\n// export const incrementAsync = createAsyncThunk(\n//     'counter/fetchCount',\n//     async (amount: number) => {\n//         const response = await dataSplitter.fetchChunks()\n//         // The value we return becomes the `fulfilled` action payload\n//         return response.data;\n//     }\n// );\n\nexport interface DataState {\n    value: Data,\n    status: 'idle' | 'loading' | 'failed';\n}\n\nconst initialState: DataState = {\n    value: {\n        levels: {},\n        areas: {},\n        fields: {},\n        years: {byLevelAndField: {}},\n        divisions: {byLevel: {}},\n        values: {byFieldAndDivision: {}}\n    },\n    status: 'idle',\n};\n\nconst augmentField = (f: DataField) : DataField =>\n    ({...f, ...fieldCfgs[f.id]});\n\nconst processData = (data: Data) : Data => {\n    if (data.fields) {\n        return {\n            ...data,\n            fields: map(augmentField, data.fields)\n        }\n    } else {\n        return data;\n    }\n};\n\nexport const dataSlice = createSlice({\n    name: 'data',\n    initialState,\n    // The `reducers` field lets us define reducers and generate associated actions\n    reducers: {\n        // Use the PayloadAction type to declare the contents of `action.payload`\n        setData: (state, action: PayloadAction<Data>) => {\n            const data = processData(action.payload);\n            state.value = mergeDeepWithConcat(state.value, data);\n        },\n    }\n});\n\nconst getNumericFields = (data: Data) : DataField[] => {\n    return data.fields ? Object.values(data.fields)\n        .filter(f =>\n            f.type === FieldType.NUMERIC ||\n            f.type === FieldType.CURRENCY\n        ) : null\n}\n\nexport const { setData } = dataSlice.actions;\nexport const selectData = (state: RootState) => state.data.value;\nexport const selectAreas = (state: RootState) => state.data.value?.areas;\nexport const selectFields = (state: RootState) => state.data.value?.fields;\nexport const selectNumericFields = (state: RootState) => getNumericFields(state.data.value);\nexport const selectLevels = (state: RootState) => state.data.value?.levels;\nexport const selectYearsByLevelAndField = (state: RootState) =>\n    state.data.value?.years.byLevelAndField;\nexport const selectDivisionsByLevel = (state: RootState) =>\n    state.data.value?.divisions.byLevel;\nexport const selectValuesByFieldAndDivision = (state: RootState) =>\n    state.data.value?.values.byFieldAndDivision;\n\nexport default dataSlice.reducer;\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport {last} from 'ramda';\nimport { RootState } from '../../app/store';\nimport {dataSlice} from \"../data/dataSlice\";\nimport {Data} from \"../../dashboard/config\";\n\nexport interface YearState {\n  value: number;\n  status: 'idle' | 'loading' | 'failed';\n}\n\nconst initialState: YearState = {\n  value: null,\n  status: 'idle',\n};\n\nexport const yearSlice = createSlice({\n  name: 'year',\n  initialState,\n  reducers: {\n    setYear: (state, action: PayloadAction<number>) => {\n      const value = action.payload;\n      if (value != null && value !== state.value) {\n          state.value = value;\n      }\n    }\n  },\n  extraReducers: {\n    // @ts-ignore\n    [dataSlice.actions.setData]: (state, action: PayloadAction<Data>) => {\n      const data = action.payload;\n      // TODO: I'd like to use the state but it's not set in the store yet.\n      // TODO: Also selectors cannot be run from reducers?\n      // TODO: That'd be the preferred way wouldn't it?\n      if (data.years) {\n        // TODO: We need to know what level and field it actually has\n        // TODO: which might pose a problem because we don't know that\n        // TODO: this reducer runs after the one in controlsSlice.\n        const level = \"state\";\n        const field = \"total_pop\";\n        state.value = last(data.years.byLevelAndField[level][field]);\n      }\n    }\n  }\n});\n\nexport const { setYear } = yearSlice.actions;\nexport const selectYear = (state: RootState) => state.year.value;\nexport default yearSlice.reducer;\n","import {PLOT_TYPES_MAP} from \"../../dashboard/config\";\nimport { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { RootState } from '../../app/store';\n\nexport interface PlotTypeState {\n    value: string;\n    status: 'idle' | 'loading' | 'failed';\n}\n\nconst initialState: PlotTypeState = {\n    value: 'bar',\n    status: 'idle',\n};\n\nexport const plotTypeSlice = createSlice({\n    name: 'plotType',\n    initialState,\n    // The `reducers` field lets us define reducers and generate associated actions\n    reducers: {\n        // Use the PayloadAction type to declare the contents of `action.payload`\n        setPlotType: (state, action: PayloadAction<string>) => {\n            const value = action.payload;\n            if (value != null && value !== '')\n                state.value = value;\n        },\n    }\n});\n\nexport const { setPlotType } = plotTypeSlice.actions;\nexport const selectPlotType = (state: RootState) => PLOT_TYPES_MAP[state.plotType.value];\nexport default plotTypeSlice.reducer;\n","import {createSlice, PayloadAction} from '@reduxjs/toolkit';\nimport { RootState } from '../../app/store';\nimport {getUrlParams} from \"../../utils\";\n\nexport interface ControlValues {\n    area: string,\n    compare: string,\n    x: string,\n    y: string,\n    z: string\n}\n\nexport interface ControlsState {\n    value: ControlValues\n}\n\nexport interface ControlsStateItem {\n    key: string\n    value: string\n}\n\nconst urlParams = getUrlParams();\n\nconst initialState: ControlsState = {\n    value: {\n        area: \"us\",\n        compare: \"state\",\n        x: urlParams.x,\n        y: urlParams.y,\n        z: urlParams.z\n    }\n};\n\nexport const controlsSlice = createSlice({\n    name: 'controls',\n    initialState,\n    // The `reducers` field lets us define reducers and generate associated actions\n    reducers: {\n        // Use the PayloadAction type to declare the contents of `action.payload`\n        setControl: (state, action: PayloadAction<ControlsStateItem>) => {\n            state.value[action.payload.key] = action.payload.value;\n        },\n        setControls: (state, action: PayloadAction<Object>) => {\n            state.value = {...state.value, ...action.payload};\n        }\n    }\n});\n\nexport const { setControl, setControls } = controlsSlice.actions;\n\nexport const selectActualControlValues = (state: RootState) : ControlValues => {\n    return state.controls.value;\n};\n\nexport default controlsSlice.reducer;\n","import { configureStore, ThunkAction, Action } from '@reduxjs/toolkit';\nimport yearReducer from '../features/year/yearSlice';\nimport plotTypeReducer from '../features/plotType/plotTypeSlice';\nimport dataReducer from '../features/data/dataSlice';\nimport controlsReducer from '../features/controls/controlsSlice';\n\nexport const store = configureStore({\n  reducer: {\n    data: dataReducer,\n    year: yearReducer,\n    plotType: plotTypeReducer,\n    controls: controlsReducer,\n  },\n});\n\nexport type AppDispatch = typeof store.dispatch;\nexport type RootState = ReturnType<typeof store.getState>;\nexport type AppThunk<ReturnType = void> = ThunkAction<\n  ReturnType,\n  RootState,\n  unknown,\n  Action<string>\n>;\n","import { useEffect } from \"react\"\n\nconst useTouchOutside = (elementRef, onClick) => {\n    useEffect(() => {\n        const clickListener = event => {\n            if (!elementRef.current || elementRef.current.contains(event.target)) {\n                return\n            }\n            onClick(event)\n        }\n        // const moveListener = event => {\n        //     if (!elementRef.current || elementRef.current.contains(event.target)) {\n        //         return\n        //     }\n        //     onMove(event);\n        // }\n        document.addEventListener(\"touchstart\", clickListener)\n        // document.addEventListener(\"mousemove\", moveListener)\n        return () => {\n            document.removeEventListener(\"touchstart\", clickListener)\n            // document.removeEventListener(\"mousemove\", moveListener)\n        }\n    }, [elementRef, onClick])\n}\n\nexport default useTouchOutside\n","import React from 'react';\nimport { Tooltip } from '@visx/tooltip';\nimport { withBoundingRects } from '@visx/bounds';\n\nfunction CustomTooltipWithBounds({\n                                     left: initialLeft,\n                                     top: initialTop,\n                                     offsetLeft = 20,\n                                     offsetTop = 20,\n                                     rect,\n                                     parentRect,\n                                     getRects,\n                                     children,\n                                     style,\n                                     ...otherProps\n                                 }) {\n\n    let left = initialLeft;\n    let top = initialTop;\n\n    if (parentRect) {\n        if (parentRect.width > 0) {\n            if (left + offsetLeft + rect.width > parentRect.width) {\n                left = parentRect.width - rect.width - offsetLeft;\n            }\n            if (left < 0) {\n                left = 0;\n            }\n        }\n\n        if (parentRect.height > 0) {\n            if (top + offsetTop + rect.height > parentRect.height) {\n                top = parentRect.height - rect.height - offsetTop;\n            }\n            if (top < 0) {\n                top = 0;\n            }\n        }\n    }\n\n    return (\n        <Tooltip\n            style={{ top: 0, transform: `translate(${left}px, ${top}px)`, ...style }}\n            {...otherProps}\n        >\n            {children}\n        </Tooltip>\n    );\n}\nexport default withBoundingRects(CustomTooltipWithBounds);\n","import { TypedUseSelectorHook, useDispatch, useSelector } from 'react-redux';\nimport type { RootState, AppDispatch } from './store';\n\n// Use throughout your app instead of plain `useDispatch` and `useSelector`\nexport const useAppDispatch = () => useDispatch<AppDispatch>();\nexport const useAppSelector: TypedUseSelectorHook<RootState> = useSelector;\n","import {createSelector} from \"@reduxjs/toolkit\";\nimport {\n    selectAreas,\n    selectDivisionsByLevel,\n    selectFields,\n    selectLevels,\n    selectNumericFields,\n    selectValuesByFieldAndDivision,\n    selectYearsByLevelAndField\n} from \"../features/data/dataSlice\";\nimport {intersectAll, invertNestedObject} from \"./utils/misc\";\nimport {ControlValues, selectActualControlValues} from \"../features/controls/controlsSlice\";\nimport {mapObjIndexed} from \"ramda\";\nimport {RootState} from \"../app/store\";\n\nexport const selectControlValues = createSelector(\n    selectActualControlValues,\n    selectNumericFields,\n    (cv, nfs) => {\n        if (!nfs || nfs.length === 0) {\n            return cv;\n        }\n        return {\n            ...cv,\n            x: cv.x || nfs[0].id,\n            y: cv.y || nfs[1].id,\n            z: cv.z || nfs[2].id\n        }\n    }\n);\n\nexport const selectXyzControlValues = createSelector(\n    selectControlValues,\n    (cv) => ({\n        x: cv.x,\n        y: cv.y,\n        z: cv.z\n    }),\n)\n\nexport const selectNonNullXyzControlArray = createSelector(\n    selectXyzControlValues,\n    (cv) => Object.values(cv).filter(v => !!v)\n);\n\nexport const selectControlFields = createSelector(\n    selectAreas,\n    selectLevels,\n    selectFields,\n    selectControlValues,\n    (areas, levels, fields, values) => {\n        return mapObjIndexed((v, k) => {\n            if (!fields || !v) {\n                return null;\n            }\n            if (k === 'area') {\n                return areas[v];\n            }\n            if (k === 'compare') {\n                return levels[v];\n            } else {\n                return fields[v];\n            }\n        }, values)\n    }\n);\n\nexport const selectCurrentDivisions = createSelector(\n    selectDivisionsByLevel,\n    selectControlValues,\n    (dvsByLevel, cv): any[] =>\n        dvsByLevel[cv.compare]\n);\n\nexport const selectYears = createSelector(\n    selectYearsByLevelAndField,\n    selectControlValues,\n    selectNonNullXyzControlArray,\n    (yblaf, cvs, xyz) =>\n        intersectAll(xyz.map(cv => yblaf[cvs.compare][cv]))\n);\n\n\nconst processDatasetItem = (vbfad, field) => {\n    return field ? invertNestedObject(vbfad[field]) : null\n};\n\nexport const selectCurrentDataset = createSelector(\n    selectValuesByFieldAndDivision,\n    selectControlValues,\n    (vbfad, cv) => ({\n        byField: {\n            x: vbfad[cv.x],\n            y: vbfad[cv.y],\n            z: vbfad[cv.z]\n        },\n        byYear: invertNestedObject({\n                x: processDatasetItem(vbfad, cv.x),\n                y: processDatasetItem(vbfad, cv.y),\n                z: processDatasetItem(vbfad, cv.z)\n\n        })\n    })\n);\n","import React from \"react\";\nimport {defaultStyles as defaultTooltipStyles, useTooltip} from \"@visx/tooltip\";\nimport {\n    all,\n    curry,\n    groupBy,\n    keys,\n    last,\n    map,\n    range,\n    reduce,\n    tail,\n    values\n} from \"ramda\";\nimport useTouchOutside from \"./useTouchOutside\";\nimport TooltipWithBounds from '../dashboard/CustomTooltipWithBounds';\nimport {animated, useSpring} from \"react-spring\";\nimport {useAppSelector} from \"../app/hooks\";\nimport {selectPlotType} from \"../features/plotType/plotTypeSlice\";\nimport {DataField, FieldType} from \"../dashboard/config\";\nimport {selectControlFields} from \"../dashboard/selectors\";\n\nconst DEFAULT_OPTIONS = {\n    selectedOpacity: 0.8,\n    unselectedOpacity: 0.15,\n    defaultOpacity: 0.6\n};\n\ntype ItemMap = Map<string, any[] | ItemMap>;\ntype KeyValue = any | ((event: Event) => any)\n\nconst groupByKeys = (keyFields: string[], items: any[]) : ItemMap => {\n    const im = groupBy(item => item[keyFields[0]], values(items));\n    if (keyFields.length === 1) {\n        return im;\n    } else {\n        return map(curry(groupByKeys)(tail(keyFields)), im);\n    }\n};\n\nconst lookupKeys = (keys: string[], itemMap: ItemMap) => {\n    return reduce((im, k) => im[k], itemMap, keys);\n};\n\nconst lookupItem = (keys: string[], itemMap: ItemMap) => {\n    const results = lookupKeys(keys, itemMap);\n    if (results.length === 1) {\n        return results[0];\n    } else {\n        throw new Error(`Found ${results.length} results for lookup of ${keys}`);\n    }\n};\n\nconst matchesAllKeys = (keysToMatch: string[], itemKeys: string[]) : boolean => {\n    const n = Math.min(keysToMatch.length, itemKeys.length);\n    // Keys will be coerced into strings, but they might be originally numbers\n    // eslint-disable-next-line eqeqeq\n    return all(i => keysToMatch[i] == itemKeys[i], range(0, n));\n};\n\nconst formatValue = (field: DataField, value) => {\n    if (field.type === FieldType.CURRENCY) {\n        return '$' + Number(value).toLocaleString();\n    } else {\n        return Number(value).toLocaleString();\n    }\n};\n\nconst TooltipContent = ({item}) => {\n    const controls = useAppSelector(selectControlFields);\n    const plotType = useAppSelector(selectPlotType);\n    return (\n        <div className='tooltip-content'>\n            <div className='tooltip-title'>\n                <h3>{item.name}</h3>\n                <div className='year'>{item.year}</div>\n            </div>\n            <div className='tooltip-body'>\n                <div>{controls.y.name}: {formatValue(controls.y, item.y)}</div>\n                {plotType.fields.x && (\n                    <div>{controls.x.name}: {formatValue(controls.x, item.x)}</div>\n                )}\n            </div>\n        </div>\n    );\n};\n\nconst useSelect = (items: any[], keyFields: string[],\n                   showLabel, disableInteraction = false) => {\n    const nKeyFields = keyFields.length;\n    const itemMap = groupByKeys(keyFields, items);\n    const [selectedKeys, selectKeys] = React.useState<string[]>(null);\n    const {\n        tooltipOpen,\n        tooltipLeft,\n        tooltipTop,\n        tooltipData,\n        showTooltip,\n        hideTooltip\n    } = useTooltip();\n\n    const select = React.useCallback(\n        (itemKeys: string[]) => {\n            if (!selectedKeys || !matchesAllKeys(selectedKeys, itemKeys)) {\n                selectKeys(itemKeys);\n                const item = lookupItem(itemKeys, itemMap);\n                showTooltip({\n                    tooltipData: <TooltipContent item={item} />,\n                    tooltipLeft: item.scaledX,\n                    tooltipTop: item.scaledY,\n                });\n            }\n        },\n        [showTooltip, itemMap, selectedKeys]\n    );\n\n    const deselect = React.useCallback(() => {\n        selectKeys(null);\n        hideTooltip();\n    }, [hideTooltip]);\n\n    const getKeys = (key1) : string[] => {\n        switch (nKeyFields) {\n            case 1: return [key1];\n            case 2: return [key1, last(keys(itemMap[key1]))];\n            default: throw new Error(\"Unsupported # of keys: \" + nKeyFields);\n        }\n    };\n\n    React.useEffect(() => {\n        if (showLabel) {\n            select(getKeys(showLabel));\n        }\n    });\n\n    const Tooltip = React.memo(() => {\n        const ref = React.useRef(null);\n        // On touch outside isn't needed for closing the tooltip,\n        // but actually to be able to select the next point (on touchscreen)\n        useTouchOutside(ref, deselect);\n        return tooltipData ? (\n            <>\n                {tooltipOpen && tooltipData && (\n                    // @ts-ignore\n                    <TooltipWithBounds\n                        top={tooltipTop}\n                        left={tooltipLeft}\n                        style={{\n                            ...defaultTooltipStyles,\n                            fontSize: '1em',\n                            padding: '0.6em',\n                            margin: '0.75em'\n                        }}\n                        className='tooltip MuiPaper-elevation5'\n                    >\n                        <div ref={ref}>\n                            {tooltipData}\n                        </div>\n                    </TooltipWithBounds>\n                )}\n            </>\n        ) : null;\n    });\n\n    const makeSelectable = React.useCallback((keyValues: any[], c, options= DEFAULT_OPTIONS) => {\n        // eslint-disable-next-line react-hooks/rules-of-hooks\n        const [{ animOpacity }, setAnim] = useSpring(() => ({\n            animOpacity: options.defaultOpacity,\n        }));\n        const isSelected = selectedKeys && matchesAllKeys(selectedKeys, keyValues);\n        const opacity = isSelected ? options.selectedOpacity : selectedKeys ? options.unselectedOpacity : options.defaultOpacity;\n        const animate = options.animate == null || options.animate === true;\n        if (animate) {\n            setAnim({animOpacity: opacity});\n            // return React.cloneElement(c, {\n            //     key: keyValues.join('_'),\n            //     fillOpacity: animOpacity.to(x => x),\n            //     strokeOpacity:  animOpacity.to(x => x)\n            // });\n            return (\n                <animated.g\n                    fillOpacity={animOpacity.to(x => x)}\n                    strokeOpacity={animOpacity.to(x => x)}\n                    key={keyValues.join('_')}\n                >\n                    {c}\n                </animated.g>\n            );\n        } else {\n            return React.cloneElement(c, {\n                ...c.props,\n                key: keyValues.join('_'),\n                fillOpacity: opacity,\n                strokeOpacity: opacity\n            });\n        }\n    }, [selectedKeys]);\n\n    const makeInteractive = React.useCallback((keyValues: KeyValue[], c) => {\n        if (disableInteraction) {\n            return c;\n        } else {\n            const callback = (event) => {\n                const resolvedKeyValues = keyValues.map(k => k instanceof Function ? k(event) : k);\n                select(resolvedKeyValues);\n            }\n            return React.cloneElement(c, {\n                ...c.props,\n                onTouchStart: callback,\n                onMouseMove: callback,\n                onMouseLeave: deselect\n            });\n        }\n    }, [select, deselect, disableInteraction]);\n\n    const makeSelectableAndInteractive = React.useCallback(\n            (keyValues: KeyValue[], c, options= DEFAULT_OPTIONS) => {\n                const concreteKeys = keyValues.filter(k => !(k instanceof Function))\n        return makeInteractive(keyValues, makeSelectable(concreteKeys, c, options));\n    }, [makeSelectable, makeInteractive]);\n\n    return {makeSelectable, makeInteractive, makeSelectableAndInteractive, Tooltip};\n};\n\nexport default useSelect;\n","import {invertMapOfMaps} from \"./misc\";\nimport {toPairs, map} from 'ramda';\n\nexport const prepareData = (dataByYear, year) => {\n    const dataArray = invertMapOfMaps(dataByYear[year]);\n    return toPairs(map(v => ({\n        ...v,\n        year\n    }), dataArray));\n};\n\nexport const allValuesNotNull = (obj: Object) : boolean =>\n    Object.values(obj).every(f => f != null);\n","import React from \"react\";\nimport {animated, useSpring} from 'react-spring';\nimport {extent} from 'd3-array';\nimport {scaleLinear, scalePower} from \"@visx/scale\";\nimport useSelect from \"../hooks/useSelect\";\nimport {useAppSelector} from \"../app/hooks\";\nimport {selectYear} from \"../features/year/yearSlice\";\nimport {selectCurrentDivisions} from \"./selectors\";\nimport {getNestedValues} from \"./utils/misc\";\nimport {prepareData} from \"./utils/domain\";\n\nconst paddingPct = 0.1;\n\nexport type BubblePlotProps = {\n    data: any\n    showLabel?: string\n    disableInteraction?: boolean\n    width: number\n    height: number\n};\n\nconst DumbBubblePlot = ({\n    data,\n    showLabel = null,\n    disableInteraction = false,\n    width,\n    height,\n    year,\n    divisions\n}) => {\n    const scaleFactor = Math.min(width, height) / 100;\n    const padding = Math.min(width, height) * paddingPct;\n    const xScale = scaleLinear<number>({\n        domain: extent(getNestedValues(data.byField.x)),\n        range: [padding, width - padding],\n        round: true\n    });\n    const yScale = scaleLinear<number>({\n        domain: extent(getNestedValues(data.byField.y)),\n        range: [height - padding / 2, padding],\n        round: true\n    });\n    const sizeScale = scaleLinear<number>({\n        domain: extent(getNestedValues(data.byField.z)),\n        range: [scaleFactor, scaleFactor * 10]\n    });\n    const items = prepareData(data.byYear, year)\n        .map(([k, v]) => ({\n            ...divisions[k],\n            ...v,\n            scaledX: xScale(v.x),\n            scaledY: yScale(v.y),\n            size: sizeScale(v.z)\n        }));\n\n    const {makeSelectableAndInteractive, Tooltip} =\n        useSelect(items, ['name'], showLabel, disableInteraction);\n    return (\n        <>\n            <svg width={width} height={height}>\n                {items.map(item => {\n                    // eslint-disable-next-line react-hooks/rules-of-hooks\n                    const [{animX, animY, animSize}, setAnim] = useSpring(() => ({\n                        animX: item.scaledX,\n                        animY: item.scaledY,\n                        animSize: item.size\n                    }));\n\n                    setAnim({\n                        animX: item.scaledX,\n                        animY: item.scaledY,\n                        animSize: item.size\n                    })\n\n                    return makeSelectableAndInteractive([item.name],\n                        <animated.circle\n                            cx={animX}\n                            cy={animY}\n                            r={animSize}\n                            fill={'#3188f6EE'}\n                            stroke={'#3188f6'}\n                        />\n                    );\n                })}\n            </svg>\n            <Tooltip />\n        </>\n    );\n};\n\nconst BubblePlot = (props: BubblePlotProps) => {\n    const year = useAppSelector(selectYear);\n    const divisions = useAppSelector(selectCurrentDivisions);\n    return year && divisions &&\n        <DumbBubblePlot {...props} year={year} divisions={divisions} />\n};\n\nexport default BubblePlot;\n","import React from 'react';\nimport { geoCentroid, geoAlbersUsa } from 'd3-geo';\nimport {animated, useSpring} from 'react-spring';\nimport { AlbersUsa } from '@visx/geo';\nimport * as topojson from 'topojson-client';\nimport topology from '../data/usa-topo.json';\nimport {extent} from 'd3-array';\nimport {zipObj, toPairs} from \"ramda\";\nimport { hcl } from 'd3-color';\nimport { scaleLinear } from 'd3-scale';\nimport { interpolateHcl } from 'd3-interpolate';\nimport {useAppSelector} from \"../app/hooks\";\nimport {selectYear} from \"../features/year/yearSlice\";\nimport useSelect from \"../hooks/useSelect\";\nimport {DataField} from \"./config\";\nimport {selectCurrentDivisions} from \"./selectors\";\nimport {getNestedValues} from \"./utils/misc\";\n\nexport const borderColor = '#FFF';\n\nexport type MapPlotProps = {\n    width: number\n    height: number\n    data: any\n    yAxisVar: DataField\n    showLabel?: string\n    disableInteraction?: boolean\n};\n\ninterface FeatureShape {\n    type: 'Feature';\n    id: string;\n    geometry: { coordinates: [number, number][][]; type: 'Polygon' };\n    properties: { name: string };\n}\n\n// @ts-ignore\nconst { features: unitedStates } = topojson.feature(topology, topology.objects.states) as {\n    type: 'FeatureCollection';\n    features: FeatureShape[];\n};\nconst projection = geoAlbersUsa();\n\nconst opacityOptions = {\n    selectedOpacity: 1,\n    unselectedOpacity: 0.2,\n    defaultOpacity: 1\n};\n\nconst DumbMapPlot = ({ data, width, height, year, divisions,\n                  showLabel = null, disableInteraction = false }) => {\n    const centerX = width / 2;\n    const centerY = height / 2;\n    const scale = Math.round(Math.min(width, height) * 1.4);\n\n    const colorScale = scaleLinear()\n        .domain(extent(getNestedValues(data.byField.y)))\n        // @ts-ignore\n        .range([\n            hcl('rgba(41,122,204,0.1)'),\n            hcl('#0265c9')])\n        // @ts-ignore\n        .interpolate(interpolateHcl)\n\n    const items = toPairs(data.byYear[year].y)\n        .map(([k, y]) => ({\n            ...divisions[k],\n            id: divisions[k]['geoid'].slice(-2),\n            y,\n            year,\n            color: colorScale(y),\n        }));\n    const includeIds = items.map(d => d.id);\n    const itemMap = zipObj(items.map(d => d.id), items);\n\n    const ifs = unitedStates\n        .filter(f => includeIds.includes(f.id))\n        .map((f) => {\n            const c = projection(geoCentroid(f));\n            return {\n                ...itemMap[f.id],\n                scaledX: c[0] / 1.55,\n                scaledY: c[1] / 1.55\n            };\n        });\n\n    const {makeSelectableAndInteractive, Tooltip} =\n        useSelect(ifs, ['name'], showLabel, disableInteraction);\n\n    return width < 10 ? null : (\n        <>\n            <svg width={width} height={height}>\n                <AlbersUsa<FeatureShape>\n                    data={unitedStates}\n                    scale={scale}\n                    translate={[centerX, centerY]}\n                >\n                    {({ features}) =>\n                        features\n                            .filter(f => includeIds.includes(f.feature.id))\n                            .map(({ feature, path }) => {\n                                const item = itemMap[feature.id];\n\n                                // eslint-disable-next-line react-hooks/rules-of-hooks\n                                const [{ animColor }, setAnim] = useSpring(() => ({\n                                    animColor: item.color\n                                }));\n\n                                setAnim({\n                                    animColor: item.color\n                                });\n                                return makeSelectableAndInteractive([item.name],\n                                    <animated.path\n                                        d={path || ''}\n                                        fill={animColor.to(x => x)}\n                                        stroke={borderColor}\n                                        strokeWidth={1}\n                                    />, opacityOptions\n                                )\n                            })\n                    }\n                </AlbersUsa>\n            </svg>\n            <Tooltip />\n        </>\n    );\n};\n\nconst MapPlot = (props: MapPlotProps) => {\n    const year = useAppSelector(selectYear);\n    const divisions = useAppSelector(selectCurrentDivisions);\n    return year && divisions &&\n      <DumbMapPlot {...props} year={year} divisions={divisions} />\n}\n\nexport default MapPlot;\n","import React from 'react';\nimport { LinePath } from '@visx/shape';\nimport {extent} from 'd3-array';\nimport {scaleLinear} from \"@visx/scale\";\nimport {GlyphCircle} from '@visx/glyph';\nimport { localPoint } from '@visx/event';\nimport { voronoi } from '@visx/voronoi';\nimport {groupBy, curry} from \"ramda\";\nimport useSelect from \"../hooks/useSelect\";\nimport {useAppSelector} from \"../app/hooks\";\nimport {selectCurrentDivisions} from \"./selectors\";\nimport {mapObjIndexed} from \"ramda\";\n\nconst paddingPct = 0.015;\n\nexport type ScatterPlotProps = {\n    data: any\n    showLabel?: string\n    disableInteraction?: boolean\n    width: number\n    height: number\n};\n\nconst lineOptions = {\n    selectedOpacity: 0.9,\n    unselectedOpacity: 0.15,\n    defaultOpacity: 0.6\n};\n\nconst pointOptions = {\n    selectedOpacity: 1,\n    unselectedOpacity: 0,\n    defaultOpacity: 0,\n    animate: false\n};\n\nconst convertData = (ds: Object) : any[] => {\n    const a = mapObjIndexed((yvs, id) =>\n            mapObjIndexed((y, year) => ({\n                id,\n                year,\n                y\n            }), yvs)\n        , ds);\n    return Object.values(a).flatMap(a2 => Object.values(a2));\n};\n\nconst DumbLinePlot = ({\n    data,\n    showLabel = null,\n    disableInteraction = false,\n    width,\n    height,\n    divisions\n}) => {\n    const padding = React.useMemo(() =>\n            Math.min(width, height) * paddingPct,\n        [width, height]\n    );\n    const dataArray = convertData(data.byField.y);\n\n    const xScale = scaleLinear<number>({\n        domain: extent(dataArray, d => +d.year),\n        range: [padding, width - padding],\n        round: true\n    });\n    const yScale = scaleLinear<number>({\n        domain: extent(dataArray, d => +d.y),\n        range: [height - padding, padding],\n        round: true\n    });\n    const items = dataArray\n        .map(d => ({\n            ...divisions[d.id],\n            ...d,\n            scaledX: xScale(d.year),\n            scaledY: yScale(d.y),\n        }));\n\n    const lines = groupBy(d => d.name, items);\n    const lineKeys = Object.keys(lines);\n    const {makeSelectable, makeSelectableAndInteractive, Tooltip} =\n        useSelect(items, ['name', 'year'], showLabel, disableInteraction);\n    const scaledX = (d) => d.scaledX;\n    const scaledY = (d) => d.scaledY;\n    const strokeWidth = Math.max(Math.round(width / 150), 1);\n    const circleSize = Math.round(strokeWidth * 16);\n\n    const voronoiInstance = voronoi({\n        x: scaledX,\n        y: scaledY,\n        width,\n        height\n    });\n\n    const findNearest = (line, event) => {\n        const point = localPoint(event);\n        const nearest = voronoiInstance(line).find(point.x, point.y).data;\n        return nearest.year;\n    };\n\n    return (\n        <>\n            <svg width={width} height={height}>\n                <>\n                    {lineKeys.map((key) => {\n                        const line = lines[key];\n                        return (\n                            <g key={key}>\n                                {makeSelectableAndInteractive([line[0].name, curry(findNearest)(line)],\n                                    <LinePath\n                                    data={line}\n                                    x={(point: any) => point.scaledX}\n                                    y={(point: any) => point.scaledY}\n                                    stroke='#3188f6'\n                                    strokeWidth={strokeWidth}\n                                    />, lineOptions\n                                )}\n                                {line.map(point => makeSelectable([point.name, point.year],\n                                    <GlyphCircle\n                                    left={point.scaledX}\n                                    top={point.scaledY}\n                                    fill='#3188f6'\n                                    stroke='#FFFFFF'\n                                    size={circleSize}\n                                    strokeWidth={Math.max(strokeWidth / 3, 1)}\n                                    />, pointOptions\n                                ))}\n                            </g>\n                        );\n                    })}\n                </>\n            </svg>\n            <Tooltip />\n        </>\n    );\n};\n\nconst LinePlot = (props: ScatterPlotProps) => {\n    const divisions = useAppSelector(selectCurrentDivisions);\n    return divisions && <DumbLinePlot {...props} divisions={divisions} />;\n}\n\nexport default LinePlot;\n","import React from \"react\";\nimport {max} from 'd3-array';\nimport {scaleBand, scaleLinear} from \"@visx/scale\";\nimport useSelect from \"../hooks/useSelect\";\nimport {animated, useSpring} from 'react-spring';\nimport {useAppSelector} from \"../app/hooks\";\nimport {selectYear} from \"../features/year/yearSlice\";\nimport {getNestedValues} from \"./utils/misc\";\nimport {selectCurrentDivisions} from \"./selectors\";\nimport {prepareData} from \"./utils/domain\";\n\nconst hPaddingPct = 0.015;\nconst vPaddingPct = 0.02\n\nexport type ScatterPlotProps = {\n    data: any\n    showLabel?: string\n    disableInteraction?: boolean\n    width: number\n    height: number\n};\n\nconst DumbBarPlot = ({\n    data,\n    showLabel = null,\n    disableInteraction = false,\n    width,\n    height,\n    divisions,\n    year\n}) => {\n    const hPadding = React.useMemo(() =>\n        Math.min(width, height) * hPaddingPct,\n        [width, height]\n    );\n    const vPadding = React.useMemo(() =>\n        Math.min(width, height) * vPaddingPct,\n        [width, height]\n    );\n    const tempItems = prepareData(data.byYear, year)\n        .map(([k, v]) => ({\n            ...divisions[k],\n            ...v\n        }));\n\n    const xScale = React.useMemo(() => scaleBand<string>({\n        range: [hPadding, width - hPadding],\n        round: false,\n        domain: tempItems.map(item => item.name),\n        padding: 0.25,\n    }), [tempItems, hPadding, width]);\n    const yScale = React.useMemo(() => scaleLinear<number>({\n        domain: [0, max(getNestedValues(data.byField.y))],\n        range: [height - vPadding, vPadding],\n        round: true\n    }), [data, height, vPadding]);\n\n    const items = tempItems.map(item => ({\n        ...item,\n        scaledX: xScale(item.name),\n        scaledY: yScale(item.y)\n    }));\n\n    const {makeSelectableAndInteractive, Tooltip} =\n        useSelect(items, ['name'], showLabel, disableInteraction);\n\n    return (\n        <>\n            <svg width={width} height={height - vPadding}>\n                {items.map(item => {\n                    // eslint-disable-next-line react-hooks/rules-of-hooks\n                    const [{ animY }, setAnim] = useSpring(() => ({\n                        animY: item.scaledY\n                    }));\n\n                    setAnim({\n                        animY: item.scaledY\n                    });\n\n                    return makeSelectableAndInteractive([item.name],\n                        <animated.rect\n                            y={animY.to(x => x)}\n                            height={animY.to(x => height - x)}\n                            x={item.scaledX}\n                            width={xScale.bandwidth()}\n                            fill='#318Cf6'\n                        />\n                    )\n                })}\n            </svg>\n            <Tooltip />\n        </>\n    );\n};\n\nconst BarPlot = (props: ScatterPlotProps) => {\n    const year = useAppSelector(selectYear);\n    const divisions = useAppSelector(selectCurrentDivisions);\n    return year && divisions &&\n      <DumbBarPlot {...props} year={year} divisions={divisions} />\n}\n\nexport default BarPlot;\n","import React from \"react\";\nimport useMediaQuery from '@mui/material/useMediaQuery';\nimport {TransitionProps} from \"@mui/material/transitions\";\nimport {\n    Button,\n    Collapse,\n    Dialog,\n    DialogActions,\n    DialogContent,\n    FormControl,\n    FormControlLabel,\n    FormGroup,\n    IconButton,\n    InputLabel,\n    NativeSelect,\n    Switch,\n    TextField\n} from \"@mui/material\";\nimport {\n    FacebookIcon,\n    FacebookShareButton,\n    LinkedinIcon,\n    LinkedinShareButton,\n    PinterestIcon,\n    PinterestShareButton,\n    RedditIcon,\n    RedditShareButton,\n    TwitterIcon,\n    TwitterShareButton,\n} from \"react-share\";\nimport FileCopyOutlinedIcon from '@mui/icons-material/FileCopyOutlined';\nimport * as htmlToImage from 'html-to-image';\nimport {\n    AxisLabelSource, PlotType,\n    SHARE_SIZE_MAP,\n    SHARE_SIZES,\n    ShareSize\n} from \"./config\";\nimport {CopyToClipboard} from 'react-copy-to-clipboard';\nimport {useAppSelector} from \"../app/hooks\";\nimport {selectPlotType} from \"../features/plotType/plotTypeSlice\";\nimport {selectYear} from \"../features/year/yearSlice\";\nimport {selectCurrentDivisions} from \"./selectors\";\nimport './sharing.scss';\nimport {useTheme} from \"@mui/system\";\n\nconst MAX_PREVIEW_WIDTH = 208 * 4;\nconst MAX_PREVIEW_HEIGHT = 208 * 4;\n\nconst calculatePreviewSize = ({width, height}) => {\n    const ratio = height / width;\n    const h1 = Math.min(ratio * MAX_PREVIEW_WIDTH, MAX_PREVIEW_HEIGHT);\n    const w = Math.min(h1 / ratio, MAX_PREVIEW_WIDTH);\n    const h = Math.min(w * ratio);\n    return {width: w, height: h};\n};\n\nconst ShareTransition = React.forwardRef(function Transition(\n    props: TransitionProps & { children?: React.ReactElement<any, any> },\n    ref: React.Ref<unknown>,\n) {\n    return <Collapse ref={ref} {...props} timeout={1500} />;\n});\n\nconst BaseDialog = ({setOpen, children, fullScreen=false}) => {\n    return (\n        <Dialog\n            className='share-dialog'\n            open={true}\n            onClose={() => setOpen(false)}\n            fullScreen={fullScreen}\n            TransitionComponent={ShareTransition}\n            keepMounted\n        >\n            {children}\n        </Dialog>\n    );\n}\n\nconst createPlotTitle = (plotType: PlotType, year: number, compareByVar, xAxisLabel, yAxisLabel) => {\n    return (!plotType.xAxisLabelSource || plotType.xAxisLabelSource === AxisLabelSource.COMPARE ?\n        yAxisLabel + ' by ' +\n        compareByVar.toLowerCase()\n        :\n        yAxisLabel + ' / ' +\n        xAxisLabel.toLowerCase() + ' by ' +\n        compareByVar.toLowerCase()) +\n        (plotType.name === 'line' ? '' : ` (${year})`)\n}\n\nexport const DumbImageDialog = ({plot, setOpen, label, setLabel,\n                                compareByVar, xAxisLabel, yAxisLabel, showAxisLabels,\n                                plotType, year, items}) => {\n    const theme = useTheme();\n    const fullScreen = useMediaQuery(theme.breakpoints.down('xs'));\n    const plotTitle = createPlotTitle(plotType, year, compareByVar, xAxisLabel, yAxisLabel);\n    const defaultShareSize = SHARE_SIZES[0];\n    const [sharePresetSize, setSharePresetSize] = React.useState(defaultShareSize);\n    const [previewSize, setPreviewSize] = React.useState({\n        width: MAX_PREVIEW_WIDTH,\n        height: MAX_PREVIEW_HEIGHT\n    });\n    const [shareSize, setShareSize] = React.useState({\n        width: defaultShareSize.width,\n        height: defaultShareSize.height\n    });\n    const [format, setFormat] = React.useState('PNG');\n    const [imgData, setImgData] = React.useState<string>(null);\n\n    const getGenerateFn = () => {\n        switch (format) {\n            case 'PNG': return htmlToImage.toPng;\n            case 'SVG': return htmlToImage.toSvg;\n            default: throw Error('Unhandled format: ' + format);\n        }\n    }\n\n    const GenerateDialog = ({setImgData}) => {\n        const generate = () => {\n            const el: any = document\n                .getElementById('preview')\n                .getElementsByClassName('gen-target')[0];\n            getGenerateFn()(el, {\n                canvasWidth: shareSize.width,\n                canvasHeight: shareSize.height,\n                quality: 1.0,\n                pixelRatio: 1\n            }).then((dataUrl) => {\n                setImgData(dataUrl);\n            });\n        };\n\n        const setNewSize = (newSize) => {\n            setShareSize(newSize);\n            setPreviewSize(calculatePreviewSize(newSize));\n        };\n\n        const onPresetSizeSelect = (event) => {\n            const name = event.target.value;\n            if (name === 'Custom') {\n                setSharePresetSize(null);\n                document\n                    .getElementsByClassName('MuiDialog-container')[0]\n                    .getElementsByClassName('MuiPaper-root')[0]\n                    .scrollTo(0, 9999);\n            } else {\n                const s = SHARE_SIZE_MAP[name];\n                setSharePresetSize(s);\n                setNewSize(s);\n            }\n        };\n\n        const onSizeChange = (newSize) => {\n            setSharePresetSize(null);\n            setNewSize(newSize);\n        };\n\n        const onLabelChange = (event) => {\n            const value = event.target.value;\n            setLabel(value === ' ' ? null : value);\n        };\n\n        const onFormatChange = (event) => {\n            const value = event.target.value;\n            setFormat(value);\n        }\n\n        const fontSize = Math.round(previewSize.width / 40);\n\n        return (\n            <>\n                <div className='dialog-title'>Generate image</div>\n                <DialogContent className='dialog-content'>\n                    <div id='preview-container'>\n                        <div id='preview' style={{...previewSize, fontSize}}>\n                            <div className='gen-target'>\n                                <div className='title'>{plotTitle}</div>\n                                <div className='subtitle'>\n                                    Statistipedia: statistipedia.org/explore\n                                </div>\n                                <div className='plot-frame'>\n                                    {plot}\n                                </div>\n                                { showAxisLabels && xAxisLabel &&\n                                <div className='x-axis'>\n                                    {xAxisLabel || 'Year'}\n                                </div>\n                                }\n                                { showAxisLabels && yAxisLabel &&\n                                <div className='y-axis'>\n                                    {yAxisLabel}\n                                </div>\n                                }\n                            </div>\n                        </div>\n                        <div className=\"MuiFormLabel-root caption\">\n                            Preview\n                        </div>\n                    </div>\n                    <div className='share-controls'>\n                        <div className='size-inputs'>\n                            <FormControl>\n                                <InputLabel variant=\"standard\" htmlFor=\"preset-size\">Size</InputLabel>\n                                <NativeSelect id=\"preset-size\"\n                                              onChange={onPresetSizeSelect}\n                                              value={sharePresetSize ? sharePresetSize.name : 'Custom'}>\n                                    <optgroup label=\"Presets\">\n                                        {SHARE_SIZES.map((s) => (\n                                            <option key={s.name}>{s.name}</option>\n                                        ))}\n                                    </optgroup>\n                                    <option>Custom</option>\n                                </NativeSelect>\n                            </FormControl>\n                            <FormGroup row className='custom-size-inputs top-padded row'>\n                                {['width', 'height'].map((s) => (\n                                    <FormControl key={s} className='top-padded custom-size-input'>\n                                        <TextField helperText={s}\n                                                   variant=\"standard\"\n                                                   onChange={(event) =>\n                                                       onSizeChange({...shareSize, [s]: event.target.value})}\n                                                   value={shareSize[s]} />\n                                    </FormControl>\n                                ))}\n                            </FormGroup>\n                            <FormGroup row className='row'>\n                                <FormControl className=\"form-control\">\n                                    <InputLabel variant=\"standard\" htmlFor=\"label\">Labeled item</InputLabel>\n                                    <NativeSelect id=\"label\"\n                                                  value={label ? label : ' '}\n                                                  onChange={onLabelChange}>\n                                        <option value=' ' />\n                                        {items.map(({name}) => (\n                                            <option key={name}>{name}</option>\n                                        ))}\n                                    </NativeSelect>\n                                </FormControl>\n                            </FormGroup>\n                            <FormGroup row className='top-padded row'>\n                                <FormControl className=\"form-control\">\n                                    <InputLabel variant=\"standard\" htmlFor=\"format\">Format</InputLabel>\n                                    <NativeSelect id=\"format\"\n                                                  value={format}\n                                                  onChange={onFormatChange}\n                                    >\n                                        <option>PNG</option>\n                                        <option>SVG</option>\n                                    </NativeSelect>\n                                </FormControl>\n                                <FormControl className=\"form-control\">\n                                    <InputLabel variant=\"standard\" htmlFor=\"light_dark\">\n                                        Mode\n                                    </InputLabel>\n                                    <NativeSelect id=\"light_dark\" value='Light mode'>\n                                        <option>Light</option>\n                                        <option>Dark</option>\n                                    </NativeSelect>\n                                </FormControl>\n                            </FormGroup>\n                            <FormControl className=\"form-control\">\n                                <FormControlLabel\n                                    control={\n                                        <Switch\n                                            color=\"primary\"\n                                        />\n                                    }\n                                    label=\"Add QR code\"\n                                />\n                            </FormControl>\n                        </div>\n                    </div>\n                </DialogContent>\n                <DialogActions className='dialog-actions'>\n                    <Button onClick={() => setOpen(false)}>Close</Button>\n                    <Button onClick={generate}>Generate</Button>\n                </DialogActions>\n            </>\n        );\n    };\n\n    const DownloadDialog = ({imgData, setImgData}) => {\n        const url = window.location.href;\n\n        // const share = () => {\n        //     if (navigator.share) {\n        //         navigator.share({\n        //             title: 'web.dev',\n        //             text: 'Check out web.dev.',\n        //             // url: 'https://web.dev/',\n        //             files: [image]\n        //         })\n        //             .then(() => alert('Successful share'))\n        //             .catch((error) => alert(error));\n        //     }\n        // };\n        return (\n            <>\n                <div className='dialog-title'>Download image</div>\n                <DialogContent className='dialog-content'>\n                    <div className='generated-image'>\n                        <a download={plotTitle} href={imgData}>\n                            <img alt=\"Generated\" src={imgData} />\n                        </a>\n                    </div>\n                    <div className='share-controls'>\n                        <div className='image-share-btns'>\n                            <div className='image-share-btn'>\n                                <PinterestShareButton\n                                    url={url}\n                                    media={imgData}\n                                >\n                                    <PinterestIcon round />\n                                    <div style={{color: '#C9242E'}}>\n                                        Share on Pinterest\n                                    </div>\n                                </PinterestShareButton>\n                            </div>\n                        </div>\n                    </div>\n                </DialogContent>\n                <DialogActions className='dialog-actions'>\n                    <Button onClick={() => setImgData(null)}>Back</Button>\n                    <Button onClick={() => setOpen(false)}>Close</Button>\n                    <Button href={imgData} download={plotTitle}>Download</Button>\n                </DialogActions>\n            </>\n        )\n    };\n    return (\n        <BaseDialog setOpen={setOpen} fullScreen={fullScreen}>\n            {imgData\n                ? <DownloadDialog imgData={imgData} setImgData={setImgData} />\n                : <GenerateDialog setImgData={setImgData} />\n            }\n        </BaseDialog>\n    )\n}\n\nexport const ImageDialog = (props) => {\n    const plotType = useAppSelector(selectPlotType);\n    const year = useAppSelector(selectYear);\n    const items = Object.values(useAppSelector(selectCurrentDivisions));\n    return <DumbImageDialog {...props} plotType={plotType} year={year} items={items} />\n};\n\nexport const ShareDialog = ({setOpen, compareByVar, xAxisLabel, yAxisLabel}) => {\n    const url = window.location.href;\n    const plotType = useAppSelector(selectPlotType);\n    const year = useAppSelector(selectYear);\n    const plotTitle = createPlotTitle(plotType, year, compareByVar, xAxisLabel, yAxisLabel);\n    return (\n        <BaseDialog setOpen={setOpen}>\n            <>\n                <div className='dialog-header'>\n                    <div className='dialog-title'>Share</div>\n                </div>\n                <DialogContent className='dialog-content'>\n                    <div className='social-btns'>\n                        <FacebookShareButton\n                            url={url}\n                            quote={plotTitle}\n                        >\n                            <FacebookIcon round />\n                        </FacebookShareButton>\n                        <TwitterShareButton\n                            url={url}\n                            title={plotTitle}\n                        >\n                            <TwitterIcon round />\n                        </TwitterShareButton>\n                        <RedditShareButton\n                            url={url}\n                            title={plotTitle}\n                        >\n                            <RedditIcon round />\n                        </RedditShareButton>\n                        <LinkedinShareButton url={url}>\n                            <LinkedinIcon round />\n                        </LinkedinShareButton>\n                    </div>\n                    <div style={{display: 'flex'}}>\n                        <TextField value={url} />\n                        <CopyToClipboard onCopy={() => {}} text={url}>\n                            <IconButton aria-label=\"copy\"\n                                        className='copy-btn'\n                                        title='Copy to clipboard'>\n                                <FileCopyOutlinedIcon />\n                            </IconButton>\n                        </CopyToClipboard>\n                    </div>\n                </DialogContent>\n            </>\n        </BaseDialog>\n    );\n}\n","import React from 'react';\nimport { useAppSelector, useAppDispatch } from '../../app/hooks';\nimport { setYear, selectYear } from './yearSlice';\nimport {Box, Slider} from \"@mui/material\";\nimport {styled} from \"@mui/system\";\nimport {selectPlotType} from \"../plotType/plotTypeSlice\";\nimport {last} from 'ramda';\nimport {selectYears} from \"../../dashboard/selectors\";\n\nconst PrettoSlider = styled(Slider)({\n    color: '#318Cf6',\n    height: 8,\n    '& .MuiSlider-track': {\n        border: 'none',\n    },\n    '& .MuiSlider-thumb': {\n        height: 24,\n        width: 24,\n        backgroundColor: '#fff',\n        border: '2px solid currentColor',\n        '&:focus, &:hover, &.Mui-active, &.Mui-focusVisible': {\n            boxShadow: 'inherit',\n        },\n        '&:before': {\n            display: 'none',\n        },\n    },\n    '& .MuiSlider-valueLabel': {\n        lineHeight: 1.2,\n        fontSize: 12,\n        background: 'unset',\n        padding: 0,\n        width: 32,\n        height: 32,\n        borderRadius: '50% 50% 50% 0',\n        backgroundColor: '#318Cf6',\n        transformOrigin: 'bottom left',\n        transform: 'translate(50%, -100%) rotate(-45deg) scale(0)',\n        '&:before': { display: 'none' },\n        '&.MuiSlider-valueLabelOpen': {\n            transform: 'translate(50%, -100%) rotate(-45deg) scale(1)',\n        },\n        '& > *': {\n            transform: 'rotate(45deg)',\n        },\n    },\n    '& .Mui-disabled .MuiSlider-valueLabel': {\n        display: 'none'\n    }\n});\n\nconst YearSlider = () => {\n    const year = useAppSelector(selectYear);\n    const plotType = useAppSelector(selectPlotType);\n    const years = useAppSelector(selectYears);\n    const dispatch = useAppDispatch();\n\n    return plotType && years && year && (\n        <Box sx={{\n            flex: '1 1'\n        }}>\n            <PrettoSlider\n                defaultValue={last(years)}\n                min={years[0]}\n                max={last(years)}\n                step={1}\n                disabled={plotType.name === 'line'}\n                valueLabelDisplay=\"on\"\n                onChange={(event, y: number) => {\n                    if (year !== y) {\n                        dispatch(setYear(y))\n                    }\n                }}\n                sx={{\n                    paddingTop: '20px',\n                    '& .MuiSlider-markLabel': {\n                        top: '40px'\n                    }\n                }}\n            />\n        </Box>\n    );\n}\n\nexport default YearSlider;\n","import {ToggleButton, ToggleButtonGroup} from \"@mui/lab\";\nimport {PLOT_TYPES} from \"../../dashboard/config\";\nimport React from \"react\";\nimport {useAppDispatch, useAppSelector} from \"../../app/hooks\";\nimport {selectPlotType, setPlotType} from \"./plotTypeSlice\";\n\n\nconst PlotTypeSelect = () => {\n    const plotType = useAppSelector(selectPlotType);\n    const dispatch = useAppDispatch();\n\n\n    const changePlotType = (event, name) => {\n        dispatch(setPlotType(name));\n    }\n\n    return (\n        <div className='plot-type'>\n            <ToggleButtonGroup size='small'\n                               value={plotType.name}\n                               exclusive\n                               onChange={changePlotType}>\n                {PLOT_TYPES.map((pt) => (\n                    <ToggleButton key={pt.name} value={pt.name}>\n                        {<pt.icon/>}\n                    </ToggleButton>\n                ))}\n            </ToggleButtonGroup>\n        </div>\n    );\n};\n\nexport default PlotTypeSelect;\n","import PlotTypeSelect from \"../plotType/PlotTypeSelect\";\nimport {\n    Autocomplete,\n    FormControl,\n    InputLabel,\n    NativeSelect,\n    TextField\n} from \"@mui/material\";\nimport React from \"react\";\nimport {useAppDispatch, useAppSelector} from \"../../app/hooks\";\nimport {setControl} from \"./controlsSlice\";\nimport {selectPlotType} from \"../plotType/plotTypeSlice\";\nimport {selectAreas, selectNumericFields} from \"../data/dataSlice\";\nimport {selectControlFields} from \"../../dashboard/selectors\";\nimport {allValuesNotNull} from \"../../dashboard/utils/domain\";\n\nconst Controls = () => {\n    const plotType = useAppSelector(selectPlotType);\n    const controls = useAppSelector(selectControlFields);\n    const controlsIsReady = allValuesNotNull(controls);\n    const numericFields = useAppSelector(selectNumericFields);\n    const areas = useAppSelector(selectAreas);\n    const dispatch = useAppDispatch();\n\n    const updateState = (newState: {[key: string]: string}) => {\n        const s = {\n            key: Object.keys(newState)[0],\n            value: Object.values(newState)[0]\n        };\n        return dispatch(setControl(s))\n    };\n\n    return controlsIsReady && (\n        <div className='controls'>\n            <PlotTypeSelect />\n            <Autocomplete\n                id=\"area\"\n                className=\"form-control\"\n                options={Object.keys(areas)}\n                value={controls.area.id}\n                getOptionLabel={(option) => areas[option].name}\n                renderInput={(params) =>\n                    <TextField variant=\"standard\" label='Area' {...params} />}\n            />\n            <FormControl className=\"form-control\">\n                <InputLabel variant=\"standard\" htmlFor=\"compare-by\">Compare by</InputLabel>\n                <NativeSelect id=\"compare-by\" value={controls.compare.id}\n                              onChange={(event) =>\n                                  updateState({compare: event.target.value})}\n                >\n                    <optgroup label='Area'>\n                        <option value='state'>State</option>\n                        <option>County</option>\n                        <option disabled={true}>Place</option>\n                    </optgroup>\n                    <optgroup label='Demographics'>\n                        <option>Sex</option>\n                        <option>Race</option>\n                        <option>Age</option>\n                    </optgroup>\n                </NativeSelect>\n            </FormControl>\n            <FormControl className=\"form-control\"\n                         disabled={!plotType.fields.x}>\n                <InputLabel variant=\"standard\" htmlFor=\"x-axis\">{plotType.fields.x || 'X-Axis'}</InputLabel>\n                <NativeSelect id=\"x-axis\" value={controls.x.id}\n                              onChange={(event) =>\n                                  updateState({x: event.target.value})}\n                >\n                    {numericFields.map(f => (\n                        <option key={f.id} value={f.id}>{f.name}</option>\n                    ))}\n                </NativeSelect>\n            </FormControl>\n            <FormControl className=\"form-control\"\n                         disabled={!plotType.fields.y}>\n                <InputLabel variant=\"standard\" htmlFor=\"y-axis\">{plotType.fields.y || 'Y-Axis'}</InputLabel>\n                <NativeSelect id=\"y-axis\" value={controls.y.id}\n                              onChange={(event) =>\n                                  updateState({y: event.target.value})}\n                >\n                    {numericFields.map(f => (\n                        <option key={f.id} value={f.id}>{f.name}</option>\n                    ))}\n                </NativeSelect>\n            </FormControl>\n            <FormControl className=\"form-control\"\n                         disabled={!plotType.fields.z}>\n                <InputLabel variant=\"standard\" htmlFor=\"size\">{plotType.fields.z || 'Size'}</InputLabel>\n                <NativeSelect id=\"z\" value={controls.z.id}\n                              onChange={(event) =>\n                                  updateState({z: event.target.value})}\n                >\n                    {numericFields.map(f => (\n                        <option key={f.id} value={f.id}>{f.name}</option>\n                    ))}\n                </NativeSelect>\n            </FormControl>\n        </div>\n    );\n};\n\nexport default Controls;\n","import {getUrlParams} from \"../../utils\";\nimport axios from 'axios';\n\nexport type Params = Map<string, any>\n\nexport type DataSplittingConfig = {\n    paramsToChunkUrls: (params: Params) => string[],\n    onChunkFetch: (chunk: any) => void\n}\n\nexport const MASTER_CHUNK_FILENAME = 'master.json';\nexport const CHUNK_DIR = \"public/data\";\nconst BASE_CHUNK_URL = \"/explore/data\";\n\nexport const computeChunkUrl = (level: string, feature: string) : string => {\n    return 'values.json';\n};\n\nexport class SplittingDataFetcher {\n    private config: DataSplittingConfig;\n\n    constructor(config: DataSplittingConfig) {\n        this.config = config;\n    }\n\n    private _computeChunkUrls = () : string[] => {\n        const urlParams = getUrlParams();\n        return this.config.paramsToChunkUrls(urlParams)\n            .map(u => BASE_CHUNK_URL + '/' + u);\n    };\n\n    private _fetchChunks = (urls: string[]) => {\n        axios.all(urls.map(url => axios.get(url)))\n            .then(axios.spread((...responses) =>\n                responses.map(r => this.config.onChunkFetch(r.data))\n            ));\n    };\n\n    fetchChunks = () => this._fetchChunks(this._computeChunkUrls());\n}\n\n","import React from 'react';\nimport {\n    computeChunkUrl,\n    SplittingDataFetcher,\n    MASTER_CHUNK_FILENAME\n} from \"../../dashboard/utils/dataSplitting\";\nimport {useAppDispatch, useAppSelector} from \"../../app/hooks\";\nimport {selectData, setData} from \"./dataSlice\";\n\nconst DataManager = () => {\n    const data = useAppSelector(selectData);\n    const dispatch = useAppDispatch();\n\n    React.useEffect(() => {\n        const paramsToChunkUrls = (params) : string[] => {\n            return [\n                MASTER_CHUNK_FILENAME,\n                computeChunkUrl('', '')\n            ];\n        };\n\n        const onChunkFetch = (chunk: any): void => {\n            dispatch(setData(chunk));\n        };\n\n        const dataSplitter = new SplittingDataFetcher({\n            paramsToChunkUrls,\n            onChunkFetch\n        });\n         dataSplitter.fetchChunks();\n    }, [dispatch]);\n\n    return null;\n}\n\nexport default DataManager;\n","import React from 'react';\nimport {\n    createEnumParam,\n    NumberParam,\n    StringParam,\n    useQueryParams\n} from \"use-query-params\";\nimport {useAppDispatch, useAppSelector} from \"../app/hooks\";\nimport {selectControlFields} from \"./selectors\";\nimport {selectYear, setYear} from \"../features/year/yearSlice\";\nimport {map, filter, pickBy} from 'ramda';\nimport {selectPlotType, setPlotType} from \"../features/plotType/plotTypeSlice\";\nimport {setControls} from \"../features/controls/controlsSlice\";\nimport {allValuesNotNull} from \"./utils/domain\";\n\nconst Url = () => {\n    const controls = useAppSelector(selectControlFields);\n    const storedYear = useAppSelector(selectYear);\n    const plotType = useAppSelector(selectPlotType);\n    const dispatch = useAppDispatch();\n\n    const [query, setQuery] = useQueryParams({\n        x: StringParam,\n        y: StringParam,\n        z: StringParam,\n        area: StringParam,\n        compare: StringParam,\n        plot: createEnumParam(['line', 'bubble', 'bar', 'map']),\n        year: NumberParam\n    });\n\n    React.useEffect(() => {\n        const { x, y, z, compare, plot, year } = query;\n        const nonNullControls = filter(v => !!v, {x, y, z, compare});\n        dispatch(setControls(nonNullControls));\n        dispatch(setPlotType(plot));\n        dispatch(setYear(year));\n    }, [dispatch]);  // Only run 1st time, so query isn't a dependency\n\n    React.useEffect(() => {\n        if (allValuesNotNull(controls)) {\n            const allParams = {\n                plot: plotType ? plotType.name : null,\n                ...map(f => f ? f.id : null, controls),\n                year: storedYear\n            };\n            const params = filter(p => !!p, allParams);\n            setQuery(params, 'pushIn');\n        }\n    }, [dispatch, query, setQuery, controls, storedYear, plotType]);\n\n    return null;\n};\n\nexport default Url;\n","import React from 'react';\nimport { Provider } from 'react-redux';\nimport { store } from '../app/store';\nimport {\n    AppBar,\n    Box,\n    Card,\n    CircularProgress,\n    Collapse,\n    CssBaseline,\n    Divider,\n    Drawer,\n    Hidden,\n    IconButton,\n    List,\n    ListItem,\n    ListItemIcon,\n    ListItemText,\n    ThemeProvider,\n    Toolbar,\n    Typography,\n    useMediaQuery\n} from '@mui/material';\nimport { createTheme } from '@mui/material/styles';\nimport BubblePlot from \"./BubblePlot\";\nimport {ParentSize} from \"@visx/responsive\";\nimport './Dashboard.scss';\nimport MenuIcon from \"@mui/icons-material/Menu\";\nimport HomeIcon from \"@mui/icons-material/Home\";\nimport DataIcon from \"@mui/icons-material/Storage\";\nimport ChartIcon from \"@mui/icons-material/InsertChart\";\nimport PlayIcon from '@mui/icons-material/PlayArrow';\nimport ShareIcon from '@mui/icons-material/Share';\nimport PhotoCameraIcon from '@mui/icons-material/PhotoCamera';\nimport ExpandLess from '@mui/icons-material/ExpandLess';\nimport ExpandMore from '@mui/icons-material/ExpandMore';\nimport {AxisLabelSource, IDashboardProps} from \"./config\";\nimport {setUseWhatChange, useWhatChanged} from '@simbathesailor/use-what-changed';\nimport MapPlot from \"./MapPlot\";\nimport LinePlot from \"./LinePlot\";\nimport BarPlot from \"./BarPlot\";\nimport {ImageDialog, ShareDialog} from \"./sharing\";\nimport YearSlider from \"../features/year/YearSlider\";\nimport {useAppDispatch, useAppSelector} from \"../app/hooks\";\nimport {selectPlotType} from \"../features/plotType/plotTypeSlice\";\nimport Controls from \"../features/controls/Controls\";\nimport DataManager from \"../features/data/DataManager\";\nimport Url from './Url';\nimport {setControl} from \"../features/controls/controlsSlice\";\nimport {selectControlFields, selectCurrentDataset} from \"./selectors\";\nimport { QueryParamProvider } from 'use-query-params';\nimport {allValuesNotNull} from \"./utils/domain\";\n\nsetUseWhatChange(process.env.NODE_ENV === 'development');\nrequire('typeface-roboto');\n\nconst LoadingPlot = ({width, height}) => (\n    <div className='loading-plot' style={{width, height}}>\n        <CircularProgress variant='indeterminate'\n                          size={Math.min(Math.round(width / 7), 80)} />\n    </div>\n);\n\nconst PlotArea = ({data, loading, plotType,\n                      axisLabels, xAxisLabel=null, yAxisLabel=null,\n                      disableInteraction = false, showLabel,\n                      x, y, sizeVar}) => {\n    const showPlot = (width: number, height: number) => {\n        if (!data)\n            return null;\n        switch (plotType.name) {\n            case 'bubble': return <BubblePlot data={data}\n                                              showLabel={showLabel}\n                                              disableInteraction={disableInteraction}\n                                              width={width}\n                                              height={height} />;\n            case 'line': return <LinePlot data={data}\n                                          showLabel={showLabel}\n                                          disableInteraction={disableInteraction}\n                                          width={width}\n                                          height={height} />;\n            case 'bar': return <BarPlot data={data}\n                                        showLabel={showLabel}\n                                        disableInteraction={disableInteraction}\n                                        width={width}\n                                        height={height} />;\n            default: return <MapPlot data={data}\n                                     showLabel={showLabel}\n                                     disableInteraction={disableInteraction}\n                                     width={width}\n                                     height={height}\n                                     yAxisVar={y} />;\n        }\n    };\n    return (\n        <ParentSize debounceTime={10} className='bg'>\n            {({ width, height }) => {\n                const fontSize = Math.min(Math.round(width / 18), 16);\n                return (width + height) > 0 && (\n                    <div className='plot' style={{width, height, fontSize}}>\n                        {loading &&\n                        <LoadingPlot width={width} height={height}/>}\n                        {showPlot(width, height)}\n                        {axisLabels && !plotType.hideAxisLabels && (\n                            <>\n                                <div className='x-axis'>\n                                    {xAxisLabel || 'Year'}\n                                </div>\n                                <div className='y-axis' style={{width: height}}>\n                                    {yAxisLabel}\n                                </div>\n                            </>\n                        )}\n                    </div>\n                )\n            }}\n        </ParentSize>\n    );\n};\n\nconst SideMenuItem = ({text, icon, children=null}) => {\n    const [open, setOpen] = React.useState(false);\n    return (\n        <>\n            <ListItem button onClick={() => setOpen(!open)}>\n                <ListItemIcon className='menu-item-icon'>{icon}</ListItemIcon>\n                <ListItemText primary={text} />\n                {children && (open ? <ExpandLess /> : <ExpandMore />)}\n            </ListItem>\n            {children && (\n                <Collapse in={open} timeout=\"auto\" unmountOnExit className='nested-menu'>\n                    {children}\n                </Collapse>\n            )}\n        </>\n    );\n};\n\nconst DumbDashboard = ({plotType, controls}) => {\n    const prefersDarkMode = useMediaQuery('(prefers-color-scheme: dark)');\n    const dispatch = useAppDispatch();\n\n    const computeXAxisLabel = () : string => {\n        switch (plotType.xAxisLabelSource) {\n            case AxisLabelSource.VAR: return controls.x.name;\n            case AxisLabelSource.COMPARE: return controls.compare.name;\n            case AxisLabelSource.YEAR: return 'Year'\n            default: return null;\n        }\n    };\n\n    const xAxisLabel = computeXAxisLabel();\n    const yAxisLabel = controls.y?.name;\n\n    const theme = React.useMemo(\n        () =>\n            createTheme({\n                palette: {\n                    mode: prefersDarkMode ? 'dark' : 'light',\n                    primary: {\n                        main: prefersDarkMode ? '#175391' : '#2278CF'\n                    }\n                },\n                breakpoints: {\n                    values: {\n                        xs: 360,\n                        sm: 640,\n                        md: 960,\n                        lg: 1080,\n                        xl: 1920,\n                    },\n                }\n            }),\n        [prefersDarkMode],\n    );\n\n    const Plot = ({axisLabels, showLabel = null, disableInteraction = false}) => {\n        const data = useAppSelector(selectCurrentDataset);\n        return controls.y && (\n            <PlotArea data={data}\n                      loading={!data}\n                      plotType={plotType}\n                      axisLabels={axisLabels}\n                      disableInteraction={disableInteraction}\n                      showLabel={showLabel}\n                      x={controls.x}\n                      y={controls.y}\n                      xAxisLabel={xAxisLabel}\n                      yAxisLabel={yAxisLabel}\n                      sizeVar={controls.size}\n            />\n        );\n    };\n\n    const SideMenu = () => {\n        const prefersDarkMode = useMediaQuery('(prefers-color-scheme: dark)');\n        const [drawerOpen, setDrawerOpen] = React.useState(false);\n        const [genImgOpen, setGenImgOpen] = React.useState(false);\n        const [shareOpen, setShareOpen] = React.useState(false);\n        const [showLabel, setShowLabel] = React.useState(null);\n\n        const drawer = (\n            <div className='side-menu'>\n                <Divider />\n                <List>\n                    <a href='/'>\n                        <SideMenuItem text='Statistpedia' icon={<HomeIcon />} />\n                    </a>\n                    <SideMenuItem text='Datasets' icon={<DataIcon />} />\n                    <SideMenuItem text='Presets' icon={<ChartIcon />}>\n                        <List>\n                            <ListItem button>\n                                <ListItemText>\n                                    Home prices vs rents\n                                </ListItemText>\n                            </ListItem>\n                            <ListItem button>\n                                <ListItemText>\n                                    Income by sex\n                                </ListItemText>\n                            </ListItem>\n                        </List>\n                    </SideMenuItem>\n                </List>\n                <Divider />\n            </div>\n        );\n        return (\n            <>\n                <nav>\n                    <Hidden lgUp>\n                        <Drawer\n                            variant=\"temporary\"\n                            open={drawerOpen}\n                            onClose={() => setDrawerOpen(false)}\n                            ModalProps={{\n                                keepMounted: true, // Better open performance on mobile.\n                            }}\n                        >\n                            {drawer}\n                        </Drawer>\n                    </Hidden>\n                    <Hidden lgDown>\n                        <Drawer\n                            variant=\"permanent\"\n                            open\n                        >\n                            {drawer}\n                        </Drawer>\n                    </Hidden>\n                </nav>\n                <AppBar className='top-bar'\n                        position=\"static\"\n                        elevation={prefersDarkMode ? 0 : 1}>\n                    <Toolbar variant=\"dense\">\n                        <IconButton edge=\"start\"\n                                    sx={{\n                                        marginRight: theme.spacing(2),\n                                        display: { xs: 'block', sm: 'none' }\n                                    }}\n                                    onClick={() => setDrawerOpen(!drawerOpen)}\n                                    color=\"inherit\"\n                                    aria-label=\"menu\">\n                            <MenuIcon />\n                        </IconButton>\n                        <Typography\n                            variant=\"h6\"\n                            sx={{\n                                display: { xs: 'none', sm: 'block' }\n                            }}\n                        >\n                            Statistipedia Explore\n                        </Typography>\n                        <div className=\"grow\" />\n                        <IconButton className='menu-btn'\n                                    onClick={() => setGenImgOpen(true)}\n                                    color=\"inherit\">\n                            <PhotoCameraIcon />\n                        </IconButton>\n                        <IconButton edge=\"end\"\n                                    className='menu-btn'\n                                    onClick={() => setShareOpen(true)}\n                                    color=\"inherit\">\n                            <ShareIcon />\n                        </IconButton>\n                    </Toolbar>\n                </AppBar>\n                {genImgOpen && <ImageDialog\n                                    setOpen={setGenImgOpen}\n                                    label={showLabel}\n                                    setLabel={setShowLabel}\n                                    compareByVar={controls.compare.name}\n                                    xAxisLabel={xAxisLabel}\n                                    yAxisLabel={yAxisLabel}\n                                    showAxisLabels={!plotType.hideAxisLabels}\n                                    plot={<Plot axisLabels={false}\n                                                disableInteraction={true}\n                                                showLabel={showLabel} />} />}\n                {shareOpen && <ShareDialog\n                                  compareByVar={controls.compare.name}\n                                  xAxisLabel={xAxisLabel}\n                                  yAxisLabel={yAxisLabel}\n                                  setOpen={setShareOpen} />}\n            </>\n        );\n    };\n\n    // useWhatChanged([data, state]);\n\n    return (\n        <ThemeProvider theme={theme}>\n            <CssBaseline />\n            <Box sx={{\n                boxSizing: 'border-box',\n                width: '100%',\n                height: '100%',\n                display: 'flex',\n                flexDirection: 'column',\n                paddingLeft: { xs: 0, lg: '270px' }\n            }}>\n                <SideMenu />\n                <div id=\"dashboard\">\n                    <main>\n                        <div className='plot-area'>\n                            <Card className='section'>\n                                <div id='inner-plot-container'>\n                                    <Plot axisLabels={true} />\n                                </div>\n                            </Card>\n                        </div>\n                        <div className='timeline'>\n                            <IconButton className='play' disabled={plotType.name === 'line'}>\n                                <PlayIcon />\n                            </IconButton>\n                            <YearSlider />\n                        </div>\n                    </main>\n                    <aside>\n                        <Controls />\n                    </aside>\n                </div>\n            </Box>\n        </ThemeProvider>\n    );\n};\n\nconst myHistory = {\n    // eslint-disable-next-line no-restricted-globals\n    push: (location: Location) => history.pushState({}, null, location.href),\n    // eslint-disable-next-line no-restricted-globals\n    replace: (location: Location) => history.replaceState({}, null, location.href),\n};\n\nconst Dashboard = ({area}: IDashboardProps) => {\n    const plotType = useAppSelector(selectPlotType);\n    const controls = useAppSelector(selectControlFields);\n    const controlsIsReady = allValuesNotNull(controls);\n    return (\n        <>\n            {\n                controlsIsReady && plotType &&\n                <DumbDashboard plotType={plotType} controls={controls} />\n            }\n            <DataManager />\n            <QueryParamProvider history={myHistory}>\n                <Url />\n            </QueryParamProvider>\n        </>\n    );\n}\n\nconst DashboardApp = () => (\n    <Provider store={store}>\n        <Dashboard />\n    </Provider>\n)\n\nexport default DashboardApp;\n","\nexport const zipmap = (arr1 ,arr2) => arr1.reduce((p,c,i) => {\n    p[c] = arr2[i];\n    return p;\n},{});\n\nexport const getUrlParams = () : any => {\n    const url = decodeURI(window.location.href);\n    const question = url.indexOf(\"?\");\n    let hash = url.indexOf(\"#\");\n    if (hash === -1 && question === -1) return {};\n    if (hash === -1) hash = url.length;\n    const query = question === -1 || hash === question + 1 ? url.substring(hash) :\n        url.substring(question+1,hash);\n    let result = {};\n    query.split(\"&\").forEach(function(part) {\n        if (!part) return;\n        part = part.split(\"+\").join(\" \"); // replace every + with space, regexp-free version\n        const eq = part.indexOf(\"=\");\n        let key = eq>-1 ? part.substr(0,eq) : part;\n        const val = eq>-1 ? decodeURIComponent(part.substr(eq + 1)) : \"\";\n        const from = key.indexOf(\"[\");\n        if (from === -1) result[decodeURIComponent(key)] = val;\n        else {\n            const to = key.indexOf(\"]\",from);\n            const index = decodeURIComponent(key.substring(from + 1,to));\n            key = decodeURIComponent(key.substring(0, from));\n            if (!result[key]) result[key] = [];\n            if (!index) result[key].push(val);\n            else result[key][index] = val;\n        }\n    });\n    return result;\n}\n"],"sourceRoot":""}